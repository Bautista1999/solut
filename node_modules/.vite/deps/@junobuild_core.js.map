{
  "version": 3,
  "sources": ["../../node_modules/base64-js/index.js", "../../node_modules/buffer/index.js", "../../@junobuild/core/dist/browser/node-modules-polyfills:crypto", "../../@junobuild/core/dist/browser/node-modules-polyfills-commonjs:crypto", "../../node_modules/tweetnacl/nacl-fast.js", "../../@junobuild/utils/src/utils/null.utils.ts", "../../@junobuild/utils/src/utils/did.utils.ts", "../../@junobuild/core/src/stores/store.ts", "../../@junobuild/core/src/stores/auth.store.ts", "../../@junobuild/core/src/utils/events.utils.ts", "../../@junobuild/core/src/constants/auth.constants.ts", "../../@junobuild/core/src/stores/env.store.ts", "../../@junobuild/core/src/utils/env.utils.ts", "../../@junobuild/core/src/utils/window.utils.ts", "../../@junobuild/core/src/providers/auth.providers.ts", "../../node_modules/@dfinity/agent/src/actor.ts", "../../node_modules/@dfinity/agent/src/agent/api.ts", "../../node_modules/@dfinity/agent/src/auth.ts", "../../node_modules/@dfinity/agent/src/agent/http/transforms.ts", "../../node_modules/@dfinity/agent/src/agent/http/types.ts", "../../node_modules/@dfinity/agent/src/agent/http/index.ts", "../../node_modules/@dfinity/agent/src/agent/proxy.ts", "../../node_modules/@dfinity/agent/src/agent/index.ts", "../../node_modules/@dfinity/agent/src/polling/strategy.ts", "../../node_modules/@dfinity/agent/src/polling/index.ts", "../../node_modules/@dfinity/agent/src/canisters/management_idl.ts", "../../node_modules/@dfinity/identity/src/identity/ed25519.ts", "../../node_modules/@dfinity/identity/src/buffer.ts", "../../node_modules/@dfinity/identity/src/identity/der.ts", "../../node_modules/@dfinity/identity/src/identity/ecdsa.ts", "../../node_modules/@dfinity/identity/src/identity/delegation.ts", "../../node_modules/@dfinity/identity/src/identity/webauthn.ts", "../../node_modules/@dfinity/auth-client/src/idleManager.ts", "../../node_modules/idb/build/wrap-idb-value.js", "../../node_modules/idb/build/index.js", "../../node_modules/@dfinity/auth-client/src/db.ts", "../../node_modules/@dfinity/auth-client/src/storage.ts", "../../node_modules/@dfinity/auth-client/src/index.ts", "../../@junobuild/core/src/utils/auth.utils.ts", "../../@junobuild/core/src/utils/data.utils.ts", "../../@junobuild/core/src/utils/list.utils.ts", "../../@junobuild/core/declarations/satellite/satellite.factory.did.js", "../../@junobuild/core/src/utils/actor.utils.ts", "../../@junobuild/core/src/api/actor.api.ts", "../../@junobuild/core/src/api/doc.api.ts", "../../@junobuild/core/src/services/identity.services.ts", "../../@junobuild/core/src/services/doc.services.ts", "../../@junobuild/core/src/services/user.services.ts", "../../@junobuild/core/src/services/auth.services.ts", "../../@junobuild/core/src/services/auth-timout.services.ts", "../../@junobuild/core/src/api/storage.api.ts", "../../@junobuild/core/src/utils/crypto.utils.ts", "../../@junobuild/core/src/utils/storage.utils.ts", "../../@junobuild/core/src/services/storage.services.ts", "../../@junobuild/core/src/index.ts"],
  "sourcesContent": ["'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n", "/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar customInspectSymbol =\n  (typeof Symbol === 'function' && typeof Symbol['for'] === 'function') // eslint-disable-line dot-notation\n    ? Symbol['for']('nodejs.util.inspect.custom') // eslint-disable-line dot-notation\n    : null\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\nvar K_MAX_LENGTH = 0x7fffffff\nexports.kMaxLength = K_MAX_LENGTH\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Print warning and recommend using `buffer` v4.x which has an Object\n *               implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * We report that the browser does not support typed arrays if the are not subclassable\n * using __proto__. Firefox 4-29 lacks support for adding new properties to `Uint8Array`\n * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438). IE 10 lacks support\n * for __proto__ and has a buggy typed array implementation.\n */\nBuffer.TYPED_ARRAY_SUPPORT = typedArraySupport()\n\nif (!Buffer.TYPED_ARRAY_SUPPORT && typeof console !== 'undefined' &&\n    typeof console.error === 'function') {\n  console.error(\n    'This browser lacks typed array (Uint8Array) support which is required by ' +\n    '`buffer` v5.x. Use `buffer` v4.x if you require old browser support.'\n  )\n}\n\nfunction typedArraySupport () {\n  // Can typed array instances can be augmented?\n  try {\n    var arr = new Uint8Array(1)\n    var proto = { foo: function () { return 42 } }\n    Object.setPrototypeOf(proto, Uint8Array.prototype)\n    Object.setPrototypeOf(arr, proto)\n    return arr.foo() === 42\n  } catch (e) {\n    return false\n  }\n}\n\nObject.defineProperty(Buffer.prototype, 'parent', {\n  enumerable: true,\n  get: function () {\n    if (!Buffer.isBuffer(this)) return undefined\n    return this.buffer\n  }\n})\n\nObject.defineProperty(Buffer.prototype, 'offset', {\n  enumerable: true,\n  get: function () {\n    if (!Buffer.isBuffer(this)) return undefined\n    return this.byteOffset\n  }\n})\n\nfunction createBuffer (length) {\n  if (length > K_MAX_LENGTH) {\n    throw new RangeError('The value \"' + length + '\" is invalid for option \"size\"')\n  }\n  // Return an augmented `Uint8Array` instance\n  var buf = new Uint8Array(length)\n  Object.setPrototypeOf(buf, Buffer.prototype)\n  return buf\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new TypeError(\n        'The \"string\" argument must be of type string. Received type number'\n      )\n    }\n    return allocUnsafe(arg)\n  }\n  return from(arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\nfunction from (value, encodingOrOffset, length) {\n  if (typeof value === 'string') {\n    return fromString(value, encodingOrOffset)\n  }\n\n  if (ArrayBuffer.isView(value)) {\n    return fromArrayView(value)\n  }\n\n  if (value == null) {\n    throw new TypeError(\n      'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +\n      'or Array-like Object. Received type ' + (typeof value)\n    )\n  }\n\n  if (isInstance(value, ArrayBuffer) ||\n      (value && isInstance(value.buffer, ArrayBuffer))) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof SharedArrayBuffer !== 'undefined' &&\n      (isInstance(value, SharedArrayBuffer) ||\n      (value && isInstance(value.buffer, SharedArrayBuffer)))) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'number') {\n    throw new TypeError(\n      'The \"value\" argument must not be of type number. Received type number'\n    )\n  }\n\n  var valueOf = value.valueOf && value.valueOf()\n  if (valueOf != null && valueOf !== value) {\n    return Buffer.from(valueOf, encodingOrOffset, length)\n  }\n\n  var b = fromObject(value)\n  if (b) return b\n\n  if (typeof Symbol !== 'undefined' && Symbol.toPrimitive != null &&\n      typeof value[Symbol.toPrimitive] === 'function') {\n    return Buffer.from(\n      value[Symbol.toPrimitive]('string'), encodingOrOffset, length\n    )\n  }\n\n  throw new TypeError(\n    'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +\n    'or Array-like Object. Received type ' + (typeof value)\n  )\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(value, encodingOrOffset, length)\n}\n\n// Note: Change prototype *after* Buffer.from is defined to workaround Chrome bug:\n// https://github.com/feross/buffer/pull/148\nObject.setPrototypeOf(Buffer.prototype, Uint8Array.prototype)\nObject.setPrototypeOf(Buffer, Uint8Array)\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be of type number')\n  } else if (size < 0) {\n    throw new RangeError('The value \"' + size + '\" is invalid for option \"size\"')\n  }\n}\n\nfunction alloc (size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpreted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(size).fill(fill, encoding)\n      : createBuffer(size).fill(fill)\n  }\n  return createBuffer(size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(size, fill, encoding)\n}\n\nfunction allocUnsafe (size) {\n  assertSize(size)\n  return createBuffer(size < 0 ? 0 : checked(size) | 0)\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(size)\n}\n\nfunction fromString (string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('Unknown encoding: ' + encoding)\n  }\n\n  var length = byteLength(string, encoding) | 0\n  var buf = createBuffer(length)\n\n  var actual = buf.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    buf = buf.slice(0, actual)\n  }\n\n  return buf\n}\n\nfunction fromArrayLike (array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  var buf = createBuffer(length)\n  for (var i = 0; i < length; i += 1) {\n    buf[i] = array[i] & 255\n  }\n  return buf\n}\n\nfunction fromArrayView (arrayView) {\n  if (isInstance(arrayView, Uint8Array)) {\n    var copy = new Uint8Array(arrayView)\n    return fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength)\n  }\n  return fromArrayLike(arrayView)\n}\n\nfunction fromArrayBuffer (array, byteOffset, length) {\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\"offset\" is outside of buffer bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\"length\" is outside of buffer bounds')\n  }\n\n  var buf\n  if (byteOffset === undefined && length === undefined) {\n    buf = new Uint8Array(array)\n  } else if (length === undefined) {\n    buf = new Uint8Array(array, byteOffset)\n  } else {\n    buf = new Uint8Array(array, byteOffset, length)\n  }\n\n  // Return an augmented `Uint8Array` instance\n  Object.setPrototypeOf(buf, Buffer.prototype)\n\n  return buf\n}\n\nfunction fromObject (obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    var buf = createBuffer(len)\n\n    if (buf.length === 0) {\n      return buf\n    }\n\n    obj.copy(buf, 0, 0, len)\n    return buf\n  }\n\n  if (obj.length !== undefined) {\n    if (typeof obj.length !== 'number' || numberIsNaN(obj.length)) {\n      return createBuffer(0)\n    }\n    return fromArrayLike(obj)\n  }\n\n  if (obj.type === 'Buffer' && Array.isArray(obj.data)) {\n    return fromArrayLike(obj.data)\n  }\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < K_MAX_LENGTH` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= K_MAX_LENGTH) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + K_MAX_LENGTH.toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return b != null && b._isBuffer === true &&\n    b !== Buffer.prototype // so Buffer.isBuffer(Buffer.prototype) will be false\n}\n\nBuffer.compare = function compare (a, b) {\n  if (isInstance(a, Uint8Array)) a = Buffer.from(a, a.offset, a.byteLength)\n  if (isInstance(b, Uint8Array)) b = Buffer.from(b, b.offset, b.byteLength)\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError(\n      'The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array'\n    )\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!Array.isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (isInstance(buf, Uint8Array)) {\n      if (pos + buf.length > buffer.length) {\n        Buffer.from(buf).copy(buffer, pos)\n      } else {\n        Uint8Array.prototype.set.call(\n          buffer,\n          buf,\n          pos\n        )\n      }\n    } else if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    } else {\n      buf.copy(buffer, pos)\n    }\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (ArrayBuffer.isView(string) || isInstance(string, ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    throw new TypeError(\n      'The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. ' +\n      'Received type ' + typeof string\n    )\n  }\n\n  var len = string.length\n  var mustMatch = (arguments.length > 2 && arguments[2] === true)\n  if (!mustMatch && len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) {\n          return mustMatch ? -1 : utf8ToBytes(string).length // assume utf8\n        }\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coercion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// This property is used by `Buffer.isBuffer` (and the `is-buffer` npm package)\n// to detect a Buffer instance. It's not possible to use `instanceof Buffer`\n// reliably in a browserify context because there could be multiple different\n// copies of the 'buffer' package in use. This method works even for Buffer\n// instances that were created from another copy of the `buffer` package.\n// See: https://github.com/feross/buffer/issues/154\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.toLocaleString = Buffer.prototype.toString\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  str = this.toString('hex', 0, max).replace(/(.{2})/g, '$1 ').trim()\n  if (this.length > max) str += ' ... '\n  return '<Buffer ' + str + '>'\n}\nif (customInspectSymbol) {\n  Buffer.prototype[customInspectSymbol] = Buffer.prototype.inspect\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (isInstance(target, Uint8Array)) {\n    target = Buffer.from(target, target.offset, target.byteLength)\n  }\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError(\n      'The \"target\" argument must be one of type Buffer or Uint8Array. ' +\n      'Received type ' + (typeof target)\n    )\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset // Coerce to Number.\n  if (numberIsNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [val], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  var strLen = string.length\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (numberIsNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset >>> 0\n    if (isFinite(length)) {\n      length = length >>> 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return asciiWrite(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF)\n      ? 4\n      : (firstByte > 0xDF)\n          ? 3\n          : (firstByte > 0xBF)\n              ? 2\n              : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += hexSliceLookupTable[buf[i]]\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  // If bytes.length is odd, the last 8 bits must be ignored (same as node.js)\n  for (var i = 0; i < bytes.length - 1; i += 2) {\n    res += String.fromCharCode(bytes[i] + (bytes[i + 1] * 256))\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf = this.subarray(start, end)\n  // Return an augmented `Uint8Array` instance\n  Object.setPrototypeOf(newBuf, Buffer.prototype)\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUintLE =\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUintBE =\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUint8 =\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUint16LE =\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUint16BE =\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUint32LE =\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUint32BE =\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUintLE =\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUintBE =\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUint8 =\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeUint16LE =\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  return offset + 2\n}\n\nBuffer.prototype.writeUint16BE =\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  this[offset] = (value >>> 8)\n  this[offset + 1] = (value & 0xff)\n  return offset + 2\n}\n\nBuffer.prototype.writeUint32LE =\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  this[offset + 3] = (value >>> 24)\n  this[offset + 2] = (value >>> 16)\n  this[offset + 1] = (value >>> 8)\n  this[offset] = (value & 0xff)\n  return offset + 4\n}\n\nBuffer.prototype.writeUint32BE =\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  this[offset] = (value >>> 24)\n  this[offset + 1] = (value >>> 16)\n  this[offset + 2] = (value >>> 8)\n  this[offset + 3] = (value & 0xff)\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    var limit = Math.pow(2, (8 * byteLength) - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    var limit = Math.pow(2, (8 * byteLength) - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  this[offset] = (value >>> 8)\n  this[offset + 1] = (value & 0xff)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  this[offset + 2] = (value >>> 16)\n  this[offset + 3] = (value >>> 24)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  this[offset] = (value >>> 24)\n  this[offset + 1] = (value >>> 16)\n  this[offset + 2] = (value >>> 8)\n  this[offset + 3] = (value & 0xff)\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!Buffer.isBuffer(target)) throw new TypeError('argument should be a Buffer')\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('Index out of range')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n\n  if (this === target && typeof Uint8Array.prototype.copyWithin === 'function') {\n    // Use built-in when available, missing from IE11\n    this.copyWithin(targetStart, start, end)\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, end),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if ((encoding === 'utf8' && code < 128) ||\n          encoding === 'latin1') {\n        // Fast path: If `val` fits into a single byte, use that numeric value.\n        val = code\n      }\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  } else if (typeof val === 'boolean') {\n    val = Number(val)\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : Buffer.from(val, encoding)\n    var len = bytes.length\n    if (len === 0) {\n      throw new TypeError('The value \"' + val +\n        '\" is invalid for argument \"value\"')\n    }\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node takes equal signs as end of the Base64 encoding\n  str = str.split('=')[0]\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = str.trim().replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\n// ArrayBuffer or Uint8Array objects from other contexts (i.e. iframes) do not pass\n// the `instanceof` check but they should be treated as of that type.\n// See: https://github.com/feross/buffer/issues/166\nfunction isInstance (obj, type) {\n  return obj instanceof type ||\n    (obj != null && obj.constructor != null && obj.constructor.name != null &&\n      obj.constructor.name === type.name)\n}\nfunction numberIsNaN (obj) {\n  // For IE11 support\n  return obj !== obj // eslint-disable-line no-self-compare\n}\n\n// Create lookup table for `toString('hex')`\n// See: https://github.com/feross/buffer/issues/219\nvar hexSliceLookupTable = (function () {\n  var alphabet = '0123456789abcdef'\n  var table = new Array(256)\n  for (var i = 0; i < 16; ++i) {\n    var i16 = i * 16\n    for (var j = 0; j < 16; ++j) {\n      table[i16 + j] = alphabet[i] + alphabet[j]\n    }\n  }\n  return table\n})()\n", "export default {};\n", "\nconst polyfill = require('crypto')\n\nif (polyfill && polyfill.default) {\n    module.exports = polyfill.default\n    for (let k in polyfill) {\n        module.exports[k] = polyfill[k]\n    }\n} else if (polyfill)  {\n    module.exports = polyfill\n}\n\n\n", "(function(nacl) {\n'use strict';\n\n// Ported in 2014 by Dmitry Chestnykh and Devi Mandiri.\n// Public domain.\n//\n// Implementation derived from TweetNaCl version 20140427.\n// See for details: http://tweetnacl.cr.yp.to/\n\nvar gf = function(init) {\n  var i, r = new Float64Array(16);\n  if (init) for (i = 0; i < init.length; i++) r[i] = init[i];\n  return r;\n};\n\n//  Pluggable, initialized in high-level API below.\nvar randombytes = function(/* x, n */) { throw new Error('no PRNG'); };\n\nvar _0 = new Uint8Array(16);\nvar _9 = new Uint8Array(32); _9[0] = 9;\n\nvar gf0 = gf(),\n    gf1 = gf([1]),\n    _121665 = gf([0xdb41, 1]),\n    D = gf([0x78a3, 0x1359, 0x4dca, 0x75eb, 0xd8ab, 0x4141, 0x0a4d, 0x0070, 0xe898, 0x7779, 0x4079, 0x8cc7, 0xfe73, 0x2b6f, 0x6cee, 0x5203]),\n    D2 = gf([0xf159, 0x26b2, 0x9b94, 0xebd6, 0xb156, 0x8283, 0x149a, 0x00e0, 0xd130, 0xeef3, 0x80f2, 0x198e, 0xfce7, 0x56df, 0xd9dc, 0x2406]),\n    X = gf([0xd51a, 0x8f25, 0x2d60, 0xc956, 0xa7b2, 0x9525, 0xc760, 0x692c, 0xdc5c, 0xfdd6, 0xe231, 0xc0a4, 0x53fe, 0xcd6e, 0x36d3, 0x2169]),\n    Y = gf([0x6658, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666]),\n    I = gf([0xa0b0, 0x4a0e, 0x1b27, 0xc4ee, 0xe478, 0xad2f, 0x1806, 0x2f43, 0xd7a7, 0x3dfb, 0x0099, 0x2b4d, 0xdf0b, 0x4fc1, 0x2480, 0x2b83]);\n\nfunction ts64(x, i, h, l) {\n  x[i]   = (h >> 24) & 0xff;\n  x[i+1] = (h >> 16) & 0xff;\n  x[i+2] = (h >>  8) & 0xff;\n  x[i+3] = h & 0xff;\n  x[i+4] = (l >> 24)  & 0xff;\n  x[i+5] = (l >> 16)  & 0xff;\n  x[i+6] = (l >>  8)  & 0xff;\n  x[i+7] = l & 0xff;\n}\n\nfunction vn(x, xi, y, yi, n) {\n  var i,d = 0;\n  for (i = 0; i < n; i++) d |= x[xi+i]^y[yi+i];\n  return (1 & ((d - 1) >>> 8)) - 1;\n}\n\nfunction crypto_verify_16(x, xi, y, yi) {\n  return vn(x,xi,y,yi,16);\n}\n\nfunction crypto_verify_32(x, xi, y, yi) {\n  return vn(x,xi,y,yi,32);\n}\n\nfunction core_salsa20(o, p, k, c) {\n  var j0  = c[ 0] & 0xff | (c[ 1] & 0xff)<<8 | (c[ 2] & 0xff)<<16 | (c[ 3] & 0xff)<<24,\n      j1  = k[ 0] & 0xff | (k[ 1] & 0xff)<<8 | (k[ 2] & 0xff)<<16 | (k[ 3] & 0xff)<<24,\n      j2  = k[ 4] & 0xff | (k[ 5] & 0xff)<<8 | (k[ 6] & 0xff)<<16 | (k[ 7] & 0xff)<<24,\n      j3  = k[ 8] & 0xff | (k[ 9] & 0xff)<<8 | (k[10] & 0xff)<<16 | (k[11] & 0xff)<<24,\n      j4  = k[12] & 0xff | (k[13] & 0xff)<<8 | (k[14] & 0xff)<<16 | (k[15] & 0xff)<<24,\n      j5  = c[ 4] & 0xff | (c[ 5] & 0xff)<<8 | (c[ 6] & 0xff)<<16 | (c[ 7] & 0xff)<<24,\n      j6  = p[ 0] & 0xff | (p[ 1] & 0xff)<<8 | (p[ 2] & 0xff)<<16 | (p[ 3] & 0xff)<<24,\n      j7  = p[ 4] & 0xff | (p[ 5] & 0xff)<<8 | (p[ 6] & 0xff)<<16 | (p[ 7] & 0xff)<<24,\n      j8  = p[ 8] & 0xff | (p[ 9] & 0xff)<<8 | (p[10] & 0xff)<<16 | (p[11] & 0xff)<<24,\n      j9  = p[12] & 0xff | (p[13] & 0xff)<<8 | (p[14] & 0xff)<<16 | (p[15] & 0xff)<<24,\n      j10 = c[ 8] & 0xff | (c[ 9] & 0xff)<<8 | (c[10] & 0xff)<<16 | (c[11] & 0xff)<<24,\n      j11 = k[16] & 0xff | (k[17] & 0xff)<<8 | (k[18] & 0xff)<<16 | (k[19] & 0xff)<<24,\n      j12 = k[20] & 0xff | (k[21] & 0xff)<<8 | (k[22] & 0xff)<<16 | (k[23] & 0xff)<<24,\n      j13 = k[24] & 0xff | (k[25] & 0xff)<<8 | (k[26] & 0xff)<<16 | (k[27] & 0xff)<<24,\n      j14 = k[28] & 0xff | (k[29] & 0xff)<<8 | (k[30] & 0xff)<<16 | (k[31] & 0xff)<<24,\n      j15 = c[12] & 0xff | (c[13] & 0xff)<<8 | (c[14] & 0xff)<<16 | (c[15] & 0xff)<<24;\n\n  var x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,\n      x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,\n      x15 = j15, u;\n\n  for (var i = 0; i < 20; i += 2) {\n    u = x0 + x12 | 0;\n    x4 ^= u<<7 | u>>>(32-7);\n    u = x4 + x0 | 0;\n    x8 ^= u<<9 | u>>>(32-9);\n    u = x8 + x4 | 0;\n    x12 ^= u<<13 | u>>>(32-13);\n    u = x12 + x8 | 0;\n    x0 ^= u<<18 | u>>>(32-18);\n\n    u = x5 + x1 | 0;\n    x9 ^= u<<7 | u>>>(32-7);\n    u = x9 + x5 | 0;\n    x13 ^= u<<9 | u>>>(32-9);\n    u = x13 + x9 | 0;\n    x1 ^= u<<13 | u>>>(32-13);\n    u = x1 + x13 | 0;\n    x5 ^= u<<18 | u>>>(32-18);\n\n    u = x10 + x6 | 0;\n    x14 ^= u<<7 | u>>>(32-7);\n    u = x14 + x10 | 0;\n    x2 ^= u<<9 | u>>>(32-9);\n    u = x2 + x14 | 0;\n    x6 ^= u<<13 | u>>>(32-13);\n    u = x6 + x2 | 0;\n    x10 ^= u<<18 | u>>>(32-18);\n\n    u = x15 + x11 | 0;\n    x3 ^= u<<7 | u>>>(32-7);\n    u = x3 + x15 | 0;\n    x7 ^= u<<9 | u>>>(32-9);\n    u = x7 + x3 | 0;\n    x11 ^= u<<13 | u>>>(32-13);\n    u = x11 + x7 | 0;\n    x15 ^= u<<18 | u>>>(32-18);\n\n    u = x0 + x3 | 0;\n    x1 ^= u<<7 | u>>>(32-7);\n    u = x1 + x0 | 0;\n    x2 ^= u<<9 | u>>>(32-9);\n    u = x2 + x1 | 0;\n    x3 ^= u<<13 | u>>>(32-13);\n    u = x3 + x2 | 0;\n    x0 ^= u<<18 | u>>>(32-18);\n\n    u = x5 + x4 | 0;\n    x6 ^= u<<7 | u>>>(32-7);\n    u = x6 + x5 | 0;\n    x7 ^= u<<9 | u>>>(32-9);\n    u = x7 + x6 | 0;\n    x4 ^= u<<13 | u>>>(32-13);\n    u = x4 + x7 | 0;\n    x5 ^= u<<18 | u>>>(32-18);\n\n    u = x10 + x9 | 0;\n    x11 ^= u<<7 | u>>>(32-7);\n    u = x11 + x10 | 0;\n    x8 ^= u<<9 | u>>>(32-9);\n    u = x8 + x11 | 0;\n    x9 ^= u<<13 | u>>>(32-13);\n    u = x9 + x8 | 0;\n    x10 ^= u<<18 | u>>>(32-18);\n\n    u = x15 + x14 | 0;\n    x12 ^= u<<7 | u>>>(32-7);\n    u = x12 + x15 | 0;\n    x13 ^= u<<9 | u>>>(32-9);\n    u = x13 + x12 | 0;\n    x14 ^= u<<13 | u>>>(32-13);\n    u = x14 + x13 | 0;\n    x15 ^= u<<18 | u>>>(32-18);\n  }\n   x0 =  x0 +  j0 | 0;\n   x1 =  x1 +  j1 | 0;\n   x2 =  x2 +  j2 | 0;\n   x3 =  x3 +  j3 | 0;\n   x4 =  x4 +  j4 | 0;\n   x5 =  x5 +  j5 | 0;\n   x6 =  x6 +  j6 | 0;\n   x7 =  x7 +  j7 | 0;\n   x8 =  x8 +  j8 | 0;\n   x9 =  x9 +  j9 | 0;\n  x10 = x10 + j10 | 0;\n  x11 = x11 + j11 | 0;\n  x12 = x12 + j12 | 0;\n  x13 = x13 + j13 | 0;\n  x14 = x14 + j14 | 0;\n  x15 = x15 + j15 | 0;\n\n  o[ 0] = x0 >>>  0 & 0xff;\n  o[ 1] = x0 >>>  8 & 0xff;\n  o[ 2] = x0 >>> 16 & 0xff;\n  o[ 3] = x0 >>> 24 & 0xff;\n\n  o[ 4] = x1 >>>  0 & 0xff;\n  o[ 5] = x1 >>>  8 & 0xff;\n  o[ 6] = x1 >>> 16 & 0xff;\n  o[ 7] = x1 >>> 24 & 0xff;\n\n  o[ 8] = x2 >>>  0 & 0xff;\n  o[ 9] = x2 >>>  8 & 0xff;\n  o[10] = x2 >>> 16 & 0xff;\n  o[11] = x2 >>> 24 & 0xff;\n\n  o[12] = x3 >>>  0 & 0xff;\n  o[13] = x3 >>>  8 & 0xff;\n  o[14] = x3 >>> 16 & 0xff;\n  o[15] = x3 >>> 24 & 0xff;\n\n  o[16] = x4 >>>  0 & 0xff;\n  o[17] = x4 >>>  8 & 0xff;\n  o[18] = x4 >>> 16 & 0xff;\n  o[19] = x4 >>> 24 & 0xff;\n\n  o[20] = x5 >>>  0 & 0xff;\n  o[21] = x5 >>>  8 & 0xff;\n  o[22] = x5 >>> 16 & 0xff;\n  o[23] = x5 >>> 24 & 0xff;\n\n  o[24] = x6 >>>  0 & 0xff;\n  o[25] = x6 >>>  8 & 0xff;\n  o[26] = x6 >>> 16 & 0xff;\n  o[27] = x6 >>> 24 & 0xff;\n\n  o[28] = x7 >>>  0 & 0xff;\n  o[29] = x7 >>>  8 & 0xff;\n  o[30] = x7 >>> 16 & 0xff;\n  o[31] = x7 >>> 24 & 0xff;\n\n  o[32] = x8 >>>  0 & 0xff;\n  o[33] = x8 >>>  8 & 0xff;\n  o[34] = x8 >>> 16 & 0xff;\n  o[35] = x8 >>> 24 & 0xff;\n\n  o[36] = x9 >>>  0 & 0xff;\n  o[37] = x9 >>>  8 & 0xff;\n  o[38] = x9 >>> 16 & 0xff;\n  o[39] = x9 >>> 24 & 0xff;\n\n  o[40] = x10 >>>  0 & 0xff;\n  o[41] = x10 >>>  8 & 0xff;\n  o[42] = x10 >>> 16 & 0xff;\n  o[43] = x10 >>> 24 & 0xff;\n\n  o[44] = x11 >>>  0 & 0xff;\n  o[45] = x11 >>>  8 & 0xff;\n  o[46] = x11 >>> 16 & 0xff;\n  o[47] = x11 >>> 24 & 0xff;\n\n  o[48] = x12 >>>  0 & 0xff;\n  o[49] = x12 >>>  8 & 0xff;\n  o[50] = x12 >>> 16 & 0xff;\n  o[51] = x12 >>> 24 & 0xff;\n\n  o[52] = x13 >>>  0 & 0xff;\n  o[53] = x13 >>>  8 & 0xff;\n  o[54] = x13 >>> 16 & 0xff;\n  o[55] = x13 >>> 24 & 0xff;\n\n  o[56] = x14 >>>  0 & 0xff;\n  o[57] = x14 >>>  8 & 0xff;\n  o[58] = x14 >>> 16 & 0xff;\n  o[59] = x14 >>> 24 & 0xff;\n\n  o[60] = x15 >>>  0 & 0xff;\n  o[61] = x15 >>>  8 & 0xff;\n  o[62] = x15 >>> 16 & 0xff;\n  o[63] = x15 >>> 24 & 0xff;\n}\n\nfunction core_hsalsa20(o,p,k,c) {\n  var j0  = c[ 0] & 0xff | (c[ 1] & 0xff)<<8 | (c[ 2] & 0xff)<<16 | (c[ 3] & 0xff)<<24,\n      j1  = k[ 0] & 0xff | (k[ 1] & 0xff)<<8 | (k[ 2] & 0xff)<<16 | (k[ 3] & 0xff)<<24,\n      j2  = k[ 4] & 0xff | (k[ 5] & 0xff)<<8 | (k[ 6] & 0xff)<<16 | (k[ 7] & 0xff)<<24,\n      j3  = k[ 8] & 0xff | (k[ 9] & 0xff)<<8 | (k[10] & 0xff)<<16 | (k[11] & 0xff)<<24,\n      j4  = k[12] & 0xff | (k[13] & 0xff)<<8 | (k[14] & 0xff)<<16 | (k[15] & 0xff)<<24,\n      j5  = c[ 4] & 0xff | (c[ 5] & 0xff)<<8 | (c[ 6] & 0xff)<<16 | (c[ 7] & 0xff)<<24,\n      j6  = p[ 0] & 0xff | (p[ 1] & 0xff)<<8 | (p[ 2] & 0xff)<<16 | (p[ 3] & 0xff)<<24,\n      j7  = p[ 4] & 0xff | (p[ 5] & 0xff)<<8 | (p[ 6] & 0xff)<<16 | (p[ 7] & 0xff)<<24,\n      j8  = p[ 8] & 0xff | (p[ 9] & 0xff)<<8 | (p[10] & 0xff)<<16 | (p[11] & 0xff)<<24,\n      j9  = p[12] & 0xff | (p[13] & 0xff)<<8 | (p[14] & 0xff)<<16 | (p[15] & 0xff)<<24,\n      j10 = c[ 8] & 0xff | (c[ 9] & 0xff)<<8 | (c[10] & 0xff)<<16 | (c[11] & 0xff)<<24,\n      j11 = k[16] & 0xff | (k[17] & 0xff)<<8 | (k[18] & 0xff)<<16 | (k[19] & 0xff)<<24,\n      j12 = k[20] & 0xff | (k[21] & 0xff)<<8 | (k[22] & 0xff)<<16 | (k[23] & 0xff)<<24,\n      j13 = k[24] & 0xff | (k[25] & 0xff)<<8 | (k[26] & 0xff)<<16 | (k[27] & 0xff)<<24,\n      j14 = k[28] & 0xff | (k[29] & 0xff)<<8 | (k[30] & 0xff)<<16 | (k[31] & 0xff)<<24,\n      j15 = c[12] & 0xff | (c[13] & 0xff)<<8 | (c[14] & 0xff)<<16 | (c[15] & 0xff)<<24;\n\n  var x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,\n      x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,\n      x15 = j15, u;\n\n  for (var i = 0; i < 20; i += 2) {\n    u = x0 + x12 | 0;\n    x4 ^= u<<7 | u>>>(32-7);\n    u = x4 + x0 | 0;\n    x8 ^= u<<9 | u>>>(32-9);\n    u = x8 + x4 | 0;\n    x12 ^= u<<13 | u>>>(32-13);\n    u = x12 + x8 | 0;\n    x0 ^= u<<18 | u>>>(32-18);\n\n    u = x5 + x1 | 0;\n    x9 ^= u<<7 | u>>>(32-7);\n    u = x9 + x5 | 0;\n    x13 ^= u<<9 | u>>>(32-9);\n    u = x13 + x9 | 0;\n    x1 ^= u<<13 | u>>>(32-13);\n    u = x1 + x13 | 0;\n    x5 ^= u<<18 | u>>>(32-18);\n\n    u = x10 + x6 | 0;\n    x14 ^= u<<7 | u>>>(32-7);\n    u = x14 + x10 | 0;\n    x2 ^= u<<9 | u>>>(32-9);\n    u = x2 + x14 | 0;\n    x6 ^= u<<13 | u>>>(32-13);\n    u = x6 + x2 | 0;\n    x10 ^= u<<18 | u>>>(32-18);\n\n    u = x15 + x11 | 0;\n    x3 ^= u<<7 | u>>>(32-7);\n    u = x3 + x15 | 0;\n    x7 ^= u<<9 | u>>>(32-9);\n    u = x7 + x3 | 0;\n    x11 ^= u<<13 | u>>>(32-13);\n    u = x11 + x7 | 0;\n    x15 ^= u<<18 | u>>>(32-18);\n\n    u = x0 + x3 | 0;\n    x1 ^= u<<7 | u>>>(32-7);\n    u = x1 + x0 | 0;\n    x2 ^= u<<9 | u>>>(32-9);\n    u = x2 + x1 | 0;\n    x3 ^= u<<13 | u>>>(32-13);\n    u = x3 + x2 | 0;\n    x0 ^= u<<18 | u>>>(32-18);\n\n    u = x5 + x4 | 0;\n    x6 ^= u<<7 | u>>>(32-7);\n    u = x6 + x5 | 0;\n    x7 ^= u<<9 | u>>>(32-9);\n    u = x7 + x6 | 0;\n    x4 ^= u<<13 | u>>>(32-13);\n    u = x4 + x7 | 0;\n    x5 ^= u<<18 | u>>>(32-18);\n\n    u = x10 + x9 | 0;\n    x11 ^= u<<7 | u>>>(32-7);\n    u = x11 + x10 | 0;\n    x8 ^= u<<9 | u>>>(32-9);\n    u = x8 + x11 | 0;\n    x9 ^= u<<13 | u>>>(32-13);\n    u = x9 + x8 | 0;\n    x10 ^= u<<18 | u>>>(32-18);\n\n    u = x15 + x14 | 0;\n    x12 ^= u<<7 | u>>>(32-7);\n    u = x12 + x15 | 0;\n    x13 ^= u<<9 | u>>>(32-9);\n    u = x13 + x12 | 0;\n    x14 ^= u<<13 | u>>>(32-13);\n    u = x14 + x13 | 0;\n    x15 ^= u<<18 | u>>>(32-18);\n  }\n\n  o[ 0] = x0 >>>  0 & 0xff;\n  o[ 1] = x0 >>>  8 & 0xff;\n  o[ 2] = x0 >>> 16 & 0xff;\n  o[ 3] = x0 >>> 24 & 0xff;\n\n  o[ 4] = x5 >>>  0 & 0xff;\n  o[ 5] = x5 >>>  8 & 0xff;\n  o[ 6] = x5 >>> 16 & 0xff;\n  o[ 7] = x5 >>> 24 & 0xff;\n\n  o[ 8] = x10 >>>  0 & 0xff;\n  o[ 9] = x10 >>>  8 & 0xff;\n  o[10] = x10 >>> 16 & 0xff;\n  o[11] = x10 >>> 24 & 0xff;\n\n  o[12] = x15 >>>  0 & 0xff;\n  o[13] = x15 >>>  8 & 0xff;\n  o[14] = x15 >>> 16 & 0xff;\n  o[15] = x15 >>> 24 & 0xff;\n\n  o[16] = x6 >>>  0 & 0xff;\n  o[17] = x6 >>>  8 & 0xff;\n  o[18] = x6 >>> 16 & 0xff;\n  o[19] = x6 >>> 24 & 0xff;\n\n  o[20] = x7 >>>  0 & 0xff;\n  o[21] = x7 >>>  8 & 0xff;\n  o[22] = x7 >>> 16 & 0xff;\n  o[23] = x7 >>> 24 & 0xff;\n\n  o[24] = x8 >>>  0 & 0xff;\n  o[25] = x8 >>>  8 & 0xff;\n  o[26] = x8 >>> 16 & 0xff;\n  o[27] = x8 >>> 24 & 0xff;\n\n  o[28] = x9 >>>  0 & 0xff;\n  o[29] = x9 >>>  8 & 0xff;\n  o[30] = x9 >>> 16 & 0xff;\n  o[31] = x9 >>> 24 & 0xff;\n}\n\nfunction crypto_core_salsa20(out,inp,k,c) {\n  core_salsa20(out,inp,k,c);\n}\n\nfunction crypto_core_hsalsa20(out,inp,k,c) {\n  core_hsalsa20(out,inp,k,c);\n}\n\nvar sigma = new Uint8Array([101, 120, 112, 97, 110, 100, 32, 51, 50, 45, 98, 121, 116, 101, 32, 107]);\n            // \"expand 32-byte k\"\n\nfunction crypto_stream_salsa20_xor(c,cpos,m,mpos,b,n,k) {\n  var z = new Uint8Array(16), x = new Uint8Array(64);\n  var u, i;\n  for (i = 0; i < 16; i++) z[i] = 0;\n  for (i = 0; i < 8; i++) z[i] = n[i];\n  while (b >= 64) {\n    crypto_core_salsa20(x,z,k,sigma);\n    for (i = 0; i < 64; i++) c[cpos+i] = m[mpos+i] ^ x[i];\n    u = 1;\n    for (i = 8; i < 16; i++) {\n      u = u + (z[i] & 0xff) | 0;\n      z[i] = u & 0xff;\n      u >>>= 8;\n    }\n    b -= 64;\n    cpos += 64;\n    mpos += 64;\n  }\n  if (b > 0) {\n    crypto_core_salsa20(x,z,k,sigma);\n    for (i = 0; i < b; i++) c[cpos+i] = m[mpos+i] ^ x[i];\n  }\n  return 0;\n}\n\nfunction crypto_stream_salsa20(c,cpos,b,n,k) {\n  var z = new Uint8Array(16), x = new Uint8Array(64);\n  var u, i;\n  for (i = 0; i < 16; i++) z[i] = 0;\n  for (i = 0; i < 8; i++) z[i] = n[i];\n  while (b >= 64) {\n    crypto_core_salsa20(x,z,k,sigma);\n    for (i = 0; i < 64; i++) c[cpos+i] = x[i];\n    u = 1;\n    for (i = 8; i < 16; i++) {\n      u = u + (z[i] & 0xff) | 0;\n      z[i] = u & 0xff;\n      u >>>= 8;\n    }\n    b -= 64;\n    cpos += 64;\n  }\n  if (b > 0) {\n    crypto_core_salsa20(x,z,k,sigma);\n    for (i = 0; i < b; i++) c[cpos+i] = x[i];\n  }\n  return 0;\n}\n\nfunction crypto_stream(c,cpos,d,n,k) {\n  var s = new Uint8Array(32);\n  crypto_core_hsalsa20(s,n,k,sigma);\n  var sn = new Uint8Array(8);\n  for (var i = 0; i < 8; i++) sn[i] = n[i+16];\n  return crypto_stream_salsa20(c,cpos,d,sn,s);\n}\n\nfunction crypto_stream_xor(c,cpos,m,mpos,d,n,k) {\n  var s = new Uint8Array(32);\n  crypto_core_hsalsa20(s,n,k,sigma);\n  var sn = new Uint8Array(8);\n  for (var i = 0; i < 8; i++) sn[i] = n[i+16];\n  return crypto_stream_salsa20_xor(c,cpos,m,mpos,d,sn,s);\n}\n\n/*\n* Port of Andrew Moon's Poly1305-donna-16. Public domain.\n* https://github.com/floodyberry/poly1305-donna\n*/\n\nvar poly1305 = function(key) {\n  this.buffer = new Uint8Array(16);\n  this.r = new Uint16Array(10);\n  this.h = new Uint16Array(10);\n  this.pad = new Uint16Array(8);\n  this.leftover = 0;\n  this.fin = 0;\n\n  var t0, t1, t2, t3, t4, t5, t6, t7;\n\n  t0 = key[ 0] & 0xff | (key[ 1] & 0xff) << 8; this.r[0] = ( t0                     ) & 0x1fff;\n  t1 = key[ 2] & 0xff | (key[ 3] & 0xff) << 8; this.r[1] = ((t0 >>> 13) | (t1 <<  3)) & 0x1fff;\n  t2 = key[ 4] & 0xff | (key[ 5] & 0xff) << 8; this.r[2] = ((t1 >>> 10) | (t2 <<  6)) & 0x1f03;\n  t3 = key[ 6] & 0xff | (key[ 7] & 0xff) << 8; this.r[3] = ((t2 >>>  7) | (t3 <<  9)) & 0x1fff;\n  t4 = key[ 8] & 0xff | (key[ 9] & 0xff) << 8; this.r[4] = ((t3 >>>  4) | (t4 << 12)) & 0x00ff;\n  this.r[5] = ((t4 >>>  1)) & 0x1ffe;\n  t5 = key[10] & 0xff | (key[11] & 0xff) << 8; this.r[6] = ((t4 >>> 14) | (t5 <<  2)) & 0x1fff;\n  t6 = key[12] & 0xff | (key[13] & 0xff) << 8; this.r[7] = ((t5 >>> 11) | (t6 <<  5)) & 0x1f81;\n  t7 = key[14] & 0xff | (key[15] & 0xff) << 8; this.r[8] = ((t6 >>>  8) | (t7 <<  8)) & 0x1fff;\n  this.r[9] = ((t7 >>>  5)) & 0x007f;\n\n  this.pad[0] = key[16] & 0xff | (key[17] & 0xff) << 8;\n  this.pad[1] = key[18] & 0xff | (key[19] & 0xff) << 8;\n  this.pad[2] = key[20] & 0xff | (key[21] & 0xff) << 8;\n  this.pad[3] = key[22] & 0xff | (key[23] & 0xff) << 8;\n  this.pad[4] = key[24] & 0xff | (key[25] & 0xff) << 8;\n  this.pad[5] = key[26] & 0xff | (key[27] & 0xff) << 8;\n  this.pad[6] = key[28] & 0xff | (key[29] & 0xff) << 8;\n  this.pad[7] = key[30] & 0xff | (key[31] & 0xff) << 8;\n};\n\npoly1305.prototype.blocks = function(m, mpos, bytes) {\n  var hibit = this.fin ? 0 : (1 << 11);\n  var t0, t1, t2, t3, t4, t5, t6, t7, c;\n  var d0, d1, d2, d3, d4, d5, d6, d7, d8, d9;\n\n  var h0 = this.h[0],\n      h1 = this.h[1],\n      h2 = this.h[2],\n      h3 = this.h[3],\n      h4 = this.h[4],\n      h5 = this.h[5],\n      h6 = this.h[6],\n      h7 = this.h[7],\n      h8 = this.h[8],\n      h9 = this.h[9];\n\n  var r0 = this.r[0],\n      r1 = this.r[1],\n      r2 = this.r[2],\n      r3 = this.r[3],\n      r4 = this.r[4],\n      r5 = this.r[5],\n      r6 = this.r[6],\n      r7 = this.r[7],\n      r8 = this.r[8],\n      r9 = this.r[9];\n\n  while (bytes >= 16) {\n    t0 = m[mpos+ 0] & 0xff | (m[mpos+ 1] & 0xff) << 8; h0 += ( t0                     ) & 0x1fff;\n    t1 = m[mpos+ 2] & 0xff | (m[mpos+ 3] & 0xff) << 8; h1 += ((t0 >>> 13) | (t1 <<  3)) & 0x1fff;\n    t2 = m[mpos+ 4] & 0xff | (m[mpos+ 5] & 0xff) << 8; h2 += ((t1 >>> 10) | (t2 <<  6)) & 0x1fff;\n    t3 = m[mpos+ 6] & 0xff | (m[mpos+ 7] & 0xff) << 8; h3 += ((t2 >>>  7) | (t3 <<  9)) & 0x1fff;\n    t4 = m[mpos+ 8] & 0xff | (m[mpos+ 9] & 0xff) << 8; h4 += ((t3 >>>  4) | (t4 << 12)) & 0x1fff;\n    h5 += ((t4 >>>  1)) & 0x1fff;\n    t5 = m[mpos+10] & 0xff | (m[mpos+11] & 0xff) << 8; h6 += ((t4 >>> 14) | (t5 <<  2)) & 0x1fff;\n    t6 = m[mpos+12] & 0xff | (m[mpos+13] & 0xff) << 8; h7 += ((t5 >>> 11) | (t6 <<  5)) & 0x1fff;\n    t7 = m[mpos+14] & 0xff | (m[mpos+15] & 0xff) << 8; h8 += ((t6 >>>  8) | (t7 <<  8)) & 0x1fff;\n    h9 += ((t7 >>> 5)) | hibit;\n\n    c = 0;\n\n    d0 = c;\n    d0 += h0 * r0;\n    d0 += h1 * (5 * r9);\n    d0 += h2 * (5 * r8);\n    d0 += h3 * (5 * r7);\n    d0 += h4 * (5 * r6);\n    c = (d0 >>> 13); d0 &= 0x1fff;\n    d0 += h5 * (5 * r5);\n    d0 += h6 * (5 * r4);\n    d0 += h7 * (5 * r3);\n    d0 += h8 * (5 * r2);\n    d0 += h9 * (5 * r1);\n    c += (d0 >>> 13); d0 &= 0x1fff;\n\n    d1 = c;\n    d1 += h0 * r1;\n    d1 += h1 * r0;\n    d1 += h2 * (5 * r9);\n    d1 += h3 * (5 * r8);\n    d1 += h4 * (5 * r7);\n    c = (d1 >>> 13); d1 &= 0x1fff;\n    d1 += h5 * (5 * r6);\n    d1 += h6 * (5 * r5);\n    d1 += h7 * (5 * r4);\n    d1 += h8 * (5 * r3);\n    d1 += h9 * (5 * r2);\n    c += (d1 >>> 13); d1 &= 0x1fff;\n\n    d2 = c;\n    d2 += h0 * r2;\n    d2 += h1 * r1;\n    d2 += h2 * r0;\n    d2 += h3 * (5 * r9);\n    d2 += h4 * (5 * r8);\n    c = (d2 >>> 13); d2 &= 0x1fff;\n    d2 += h5 * (5 * r7);\n    d2 += h6 * (5 * r6);\n    d2 += h7 * (5 * r5);\n    d2 += h8 * (5 * r4);\n    d2 += h9 * (5 * r3);\n    c += (d2 >>> 13); d2 &= 0x1fff;\n\n    d3 = c;\n    d3 += h0 * r3;\n    d3 += h1 * r2;\n    d3 += h2 * r1;\n    d3 += h3 * r0;\n    d3 += h4 * (5 * r9);\n    c = (d3 >>> 13); d3 &= 0x1fff;\n    d3 += h5 * (5 * r8);\n    d3 += h6 * (5 * r7);\n    d3 += h7 * (5 * r6);\n    d3 += h8 * (5 * r5);\n    d3 += h9 * (5 * r4);\n    c += (d3 >>> 13); d3 &= 0x1fff;\n\n    d4 = c;\n    d4 += h0 * r4;\n    d4 += h1 * r3;\n    d4 += h2 * r2;\n    d4 += h3 * r1;\n    d4 += h4 * r0;\n    c = (d4 >>> 13); d4 &= 0x1fff;\n    d4 += h5 * (5 * r9);\n    d4 += h6 * (5 * r8);\n    d4 += h7 * (5 * r7);\n    d4 += h8 * (5 * r6);\n    d4 += h9 * (5 * r5);\n    c += (d4 >>> 13); d4 &= 0x1fff;\n\n    d5 = c;\n    d5 += h0 * r5;\n    d5 += h1 * r4;\n    d5 += h2 * r3;\n    d5 += h3 * r2;\n    d5 += h4 * r1;\n    c = (d5 >>> 13); d5 &= 0x1fff;\n    d5 += h5 * r0;\n    d5 += h6 * (5 * r9);\n    d5 += h7 * (5 * r8);\n    d5 += h8 * (5 * r7);\n    d5 += h9 * (5 * r6);\n    c += (d5 >>> 13); d5 &= 0x1fff;\n\n    d6 = c;\n    d6 += h0 * r6;\n    d6 += h1 * r5;\n    d6 += h2 * r4;\n    d6 += h3 * r3;\n    d6 += h4 * r2;\n    c = (d6 >>> 13); d6 &= 0x1fff;\n    d6 += h5 * r1;\n    d6 += h6 * r0;\n    d6 += h7 * (5 * r9);\n    d6 += h8 * (5 * r8);\n    d6 += h9 * (5 * r7);\n    c += (d6 >>> 13); d6 &= 0x1fff;\n\n    d7 = c;\n    d7 += h0 * r7;\n    d7 += h1 * r6;\n    d7 += h2 * r5;\n    d7 += h3 * r4;\n    d7 += h4 * r3;\n    c = (d7 >>> 13); d7 &= 0x1fff;\n    d7 += h5 * r2;\n    d7 += h6 * r1;\n    d7 += h7 * r0;\n    d7 += h8 * (5 * r9);\n    d7 += h9 * (5 * r8);\n    c += (d7 >>> 13); d7 &= 0x1fff;\n\n    d8 = c;\n    d8 += h0 * r8;\n    d8 += h1 * r7;\n    d8 += h2 * r6;\n    d8 += h3 * r5;\n    d8 += h4 * r4;\n    c = (d8 >>> 13); d8 &= 0x1fff;\n    d8 += h5 * r3;\n    d8 += h6 * r2;\n    d8 += h7 * r1;\n    d8 += h8 * r0;\n    d8 += h9 * (5 * r9);\n    c += (d8 >>> 13); d8 &= 0x1fff;\n\n    d9 = c;\n    d9 += h0 * r9;\n    d9 += h1 * r8;\n    d9 += h2 * r7;\n    d9 += h3 * r6;\n    d9 += h4 * r5;\n    c = (d9 >>> 13); d9 &= 0x1fff;\n    d9 += h5 * r4;\n    d9 += h6 * r3;\n    d9 += h7 * r2;\n    d9 += h8 * r1;\n    d9 += h9 * r0;\n    c += (d9 >>> 13); d9 &= 0x1fff;\n\n    c = (((c << 2) + c)) | 0;\n    c = (c + d0) | 0;\n    d0 = c & 0x1fff;\n    c = (c >>> 13);\n    d1 += c;\n\n    h0 = d0;\n    h1 = d1;\n    h2 = d2;\n    h3 = d3;\n    h4 = d4;\n    h5 = d5;\n    h6 = d6;\n    h7 = d7;\n    h8 = d8;\n    h9 = d9;\n\n    mpos += 16;\n    bytes -= 16;\n  }\n  this.h[0] = h0;\n  this.h[1] = h1;\n  this.h[2] = h2;\n  this.h[3] = h3;\n  this.h[4] = h4;\n  this.h[5] = h5;\n  this.h[6] = h6;\n  this.h[7] = h7;\n  this.h[8] = h8;\n  this.h[9] = h9;\n};\n\npoly1305.prototype.finish = function(mac, macpos) {\n  var g = new Uint16Array(10);\n  var c, mask, f, i;\n\n  if (this.leftover) {\n    i = this.leftover;\n    this.buffer[i++] = 1;\n    for (; i < 16; i++) this.buffer[i] = 0;\n    this.fin = 1;\n    this.blocks(this.buffer, 0, 16);\n  }\n\n  c = this.h[1] >>> 13;\n  this.h[1] &= 0x1fff;\n  for (i = 2; i < 10; i++) {\n    this.h[i] += c;\n    c = this.h[i] >>> 13;\n    this.h[i] &= 0x1fff;\n  }\n  this.h[0] += (c * 5);\n  c = this.h[0] >>> 13;\n  this.h[0] &= 0x1fff;\n  this.h[1] += c;\n  c = this.h[1] >>> 13;\n  this.h[1] &= 0x1fff;\n  this.h[2] += c;\n\n  g[0] = this.h[0] + 5;\n  c = g[0] >>> 13;\n  g[0] &= 0x1fff;\n  for (i = 1; i < 10; i++) {\n    g[i] = this.h[i] + c;\n    c = g[i] >>> 13;\n    g[i] &= 0x1fff;\n  }\n  g[9] -= (1 << 13);\n\n  mask = (c ^ 1) - 1;\n  for (i = 0; i < 10; i++) g[i] &= mask;\n  mask = ~mask;\n  for (i = 0; i < 10; i++) this.h[i] = (this.h[i] & mask) | g[i];\n\n  this.h[0] = ((this.h[0]       ) | (this.h[1] << 13)                    ) & 0xffff;\n  this.h[1] = ((this.h[1] >>>  3) | (this.h[2] << 10)                    ) & 0xffff;\n  this.h[2] = ((this.h[2] >>>  6) | (this.h[3] <<  7)                    ) & 0xffff;\n  this.h[3] = ((this.h[3] >>>  9) | (this.h[4] <<  4)                    ) & 0xffff;\n  this.h[4] = ((this.h[4] >>> 12) | (this.h[5] <<  1) | (this.h[6] << 14)) & 0xffff;\n  this.h[5] = ((this.h[6] >>>  2) | (this.h[7] << 11)                    ) & 0xffff;\n  this.h[6] = ((this.h[7] >>>  5) | (this.h[8] <<  8)                    ) & 0xffff;\n  this.h[7] = ((this.h[8] >>>  8) | (this.h[9] <<  5)                    ) & 0xffff;\n\n  f = this.h[0] + this.pad[0];\n  this.h[0] = f & 0xffff;\n  for (i = 1; i < 8; i++) {\n    f = (((this.h[i] + this.pad[i]) | 0) + (f >>> 16)) | 0;\n    this.h[i] = f & 0xffff;\n  }\n\n  mac[macpos+ 0] = (this.h[0] >>> 0) & 0xff;\n  mac[macpos+ 1] = (this.h[0] >>> 8) & 0xff;\n  mac[macpos+ 2] = (this.h[1] >>> 0) & 0xff;\n  mac[macpos+ 3] = (this.h[1] >>> 8) & 0xff;\n  mac[macpos+ 4] = (this.h[2] >>> 0) & 0xff;\n  mac[macpos+ 5] = (this.h[2] >>> 8) & 0xff;\n  mac[macpos+ 6] = (this.h[3] >>> 0) & 0xff;\n  mac[macpos+ 7] = (this.h[3] >>> 8) & 0xff;\n  mac[macpos+ 8] = (this.h[4] >>> 0) & 0xff;\n  mac[macpos+ 9] = (this.h[4] >>> 8) & 0xff;\n  mac[macpos+10] = (this.h[5] >>> 0) & 0xff;\n  mac[macpos+11] = (this.h[5] >>> 8) & 0xff;\n  mac[macpos+12] = (this.h[6] >>> 0) & 0xff;\n  mac[macpos+13] = (this.h[6] >>> 8) & 0xff;\n  mac[macpos+14] = (this.h[7] >>> 0) & 0xff;\n  mac[macpos+15] = (this.h[7] >>> 8) & 0xff;\n};\n\npoly1305.prototype.update = function(m, mpos, bytes) {\n  var i, want;\n\n  if (this.leftover) {\n    want = (16 - this.leftover);\n    if (want > bytes)\n      want = bytes;\n    for (i = 0; i < want; i++)\n      this.buffer[this.leftover + i] = m[mpos+i];\n    bytes -= want;\n    mpos += want;\n    this.leftover += want;\n    if (this.leftover < 16)\n      return;\n    this.blocks(this.buffer, 0, 16);\n    this.leftover = 0;\n  }\n\n  if (bytes >= 16) {\n    want = bytes - (bytes % 16);\n    this.blocks(m, mpos, want);\n    mpos += want;\n    bytes -= want;\n  }\n\n  if (bytes) {\n    for (i = 0; i < bytes; i++)\n      this.buffer[this.leftover + i] = m[mpos+i];\n    this.leftover += bytes;\n  }\n};\n\nfunction crypto_onetimeauth(out, outpos, m, mpos, n, k) {\n  var s = new poly1305(k);\n  s.update(m, mpos, n);\n  s.finish(out, outpos);\n  return 0;\n}\n\nfunction crypto_onetimeauth_verify(h, hpos, m, mpos, n, k) {\n  var x = new Uint8Array(16);\n  crypto_onetimeauth(x,0,m,mpos,n,k);\n  return crypto_verify_16(h,hpos,x,0);\n}\n\nfunction crypto_secretbox(c,m,d,n,k) {\n  var i;\n  if (d < 32) return -1;\n  crypto_stream_xor(c,0,m,0,d,n,k);\n  crypto_onetimeauth(c, 16, c, 32, d - 32, c);\n  for (i = 0; i < 16; i++) c[i] = 0;\n  return 0;\n}\n\nfunction crypto_secretbox_open(m,c,d,n,k) {\n  var i;\n  var x = new Uint8Array(32);\n  if (d < 32) return -1;\n  crypto_stream(x,0,32,n,k);\n  if (crypto_onetimeauth_verify(c, 16,c, 32,d - 32,x) !== 0) return -1;\n  crypto_stream_xor(m,0,c,0,d,n,k);\n  for (i = 0; i < 32; i++) m[i] = 0;\n  return 0;\n}\n\nfunction set25519(r, a) {\n  var i;\n  for (i = 0; i < 16; i++) r[i] = a[i]|0;\n}\n\nfunction car25519(o) {\n  var i, v, c = 1;\n  for (i = 0; i < 16; i++) {\n    v = o[i] + c + 65535;\n    c = Math.floor(v / 65536);\n    o[i] = v - c * 65536;\n  }\n  o[0] += c-1 + 37 * (c-1);\n}\n\nfunction sel25519(p, q, b) {\n  var t, c = ~(b-1);\n  for (var i = 0; i < 16; i++) {\n    t = c & (p[i] ^ q[i]);\n    p[i] ^= t;\n    q[i] ^= t;\n  }\n}\n\nfunction pack25519(o, n) {\n  var i, j, b;\n  var m = gf(), t = gf();\n  for (i = 0; i < 16; i++) t[i] = n[i];\n  car25519(t);\n  car25519(t);\n  car25519(t);\n  for (j = 0; j < 2; j++) {\n    m[0] = t[0] - 0xffed;\n    for (i = 1; i < 15; i++) {\n      m[i] = t[i] - 0xffff - ((m[i-1]>>16) & 1);\n      m[i-1] &= 0xffff;\n    }\n    m[15] = t[15] - 0x7fff - ((m[14]>>16) & 1);\n    b = (m[15]>>16) & 1;\n    m[14] &= 0xffff;\n    sel25519(t, m, 1-b);\n  }\n  for (i = 0; i < 16; i++) {\n    o[2*i] = t[i] & 0xff;\n    o[2*i+1] = t[i]>>8;\n  }\n}\n\nfunction neq25519(a, b) {\n  var c = new Uint8Array(32), d = new Uint8Array(32);\n  pack25519(c, a);\n  pack25519(d, b);\n  return crypto_verify_32(c, 0, d, 0);\n}\n\nfunction par25519(a) {\n  var d = new Uint8Array(32);\n  pack25519(d, a);\n  return d[0] & 1;\n}\n\nfunction unpack25519(o, n) {\n  var i;\n  for (i = 0; i < 16; i++) o[i] = n[2*i] + (n[2*i+1] << 8);\n  o[15] &= 0x7fff;\n}\n\nfunction A(o, a, b) {\n  for (var i = 0; i < 16; i++) o[i] = a[i] + b[i];\n}\n\nfunction Z(o, a, b) {\n  for (var i = 0; i < 16; i++) o[i] = a[i] - b[i];\n}\n\nfunction M(o, a, b) {\n  var v, c,\n     t0 = 0,  t1 = 0,  t2 = 0,  t3 = 0,  t4 = 0,  t5 = 0,  t6 = 0,  t7 = 0,\n     t8 = 0,  t9 = 0, t10 = 0, t11 = 0, t12 = 0, t13 = 0, t14 = 0, t15 = 0,\n    t16 = 0, t17 = 0, t18 = 0, t19 = 0, t20 = 0, t21 = 0, t22 = 0, t23 = 0,\n    t24 = 0, t25 = 0, t26 = 0, t27 = 0, t28 = 0, t29 = 0, t30 = 0,\n    b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3],\n    b4 = b[4],\n    b5 = b[5],\n    b6 = b[6],\n    b7 = b[7],\n    b8 = b[8],\n    b9 = b[9],\n    b10 = b[10],\n    b11 = b[11],\n    b12 = b[12],\n    b13 = b[13],\n    b14 = b[14],\n    b15 = b[15];\n\n  v = a[0];\n  t0 += v * b0;\n  t1 += v * b1;\n  t2 += v * b2;\n  t3 += v * b3;\n  t4 += v * b4;\n  t5 += v * b5;\n  t6 += v * b6;\n  t7 += v * b7;\n  t8 += v * b8;\n  t9 += v * b9;\n  t10 += v * b10;\n  t11 += v * b11;\n  t12 += v * b12;\n  t13 += v * b13;\n  t14 += v * b14;\n  t15 += v * b15;\n  v = a[1];\n  t1 += v * b0;\n  t2 += v * b1;\n  t3 += v * b2;\n  t4 += v * b3;\n  t5 += v * b4;\n  t6 += v * b5;\n  t7 += v * b6;\n  t8 += v * b7;\n  t9 += v * b8;\n  t10 += v * b9;\n  t11 += v * b10;\n  t12 += v * b11;\n  t13 += v * b12;\n  t14 += v * b13;\n  t15 += v * b14;\n  t16 += v * b15;\n  v = a[2];\n  t2 += v * b0;\n  t3 += v * b1;\n  t4 += v * b2;\n  t5 += v * b3;\n  t6 += v * b4;\n  t7 += v * b5;\n  t8 += v * b6;\n  t9 += v * b7;\n  t10 += v * b8;\n  t11 += v * b9;\n  t12 += v * b10;\n  t13 += v * b11;\n  t14 += v * b12;\n  t15 += v * b13;\n  t16 += v * b14;\n  t17 += v * b15;\n  v = a[3];\n  t3 += v * b0;\n  t4 += v * b1;\n  t5 += v * b2;\n  t6 += v * b3;\n  t7 += v * b4;\n  t8 += v * b5;\n  t9 += v * b6;\n  t10 += v * b7;\n  t11 += v * b8;\n  t12 += v * b9;\n  t13 += v * b10;\n  t14 += v * b11;\n  t15 += v * b12;\n  t16 += v * b13;\n  t17 += v * b14;\n  t18 += v * b15;\n  v = a[4];\n  t4 += v * b0;\n  t5 += v * b1;\n  t6 += v * b2;\n  t7 += v * b3;\n  t8 += v * b4;\n  t9 += v * b5;\n  t10 += v * b6;\n  t11 += v * b7;\n  t12 += v * b8;\n  t13 += v * b9;\n  t14 += v * b10;\n  t15 += v * b11;\n  t16 += v * b12;\n  t17 += v * b13;\n  t18 += v * b14;\n  t19 += v * b15;\n  v = a[5];\n  t5 += v * b0;\n  t6 += v * b1;\n  t7 += v * b2;\n  t8 += v * b3;\n  t9 += v * b4;\n  t10 += v * b5;\n  t11 += v * b6;\n  t12 += v * b7;\n  t13 += v * b8;\n  t14 += v * b9;\n  t15 += v * b10;\n  t16 += v * b11;\n  t17 += v * b12;\n  t18 += v * b13;\n  t19 += v * b14;\n  t20 += v * b15;\n  v = a[6];\n  t6 += v * b0;\n  t7 += v * b1;\n  t8 += v * b2;\n  t9 += v * b3;\n  t10 += v * b4;\n  t11 += v * b5;\n  t12 += v * b6;\n  t13 += v * b7;\n  t14 += v * b8;\n  t15 += v * b9;\n  t16 += v * b10;\n  t17 += v * b11;\n  t18 += v * b12;\n  t19 += v * b13;\n  t20 += v * b14;\n  t21 += v * b15;\n  v = a[7];\n  t7 += v * b0;\n  t8 += v * b1;\n  t9 += v * b2;\n  t10 += v * b3;\n  t11 += v * b4;\n  t12 += v * b5;\n  t13 += v * b6;\n  t14 += v * b7;\n  t15 += v * b8;\n  t16 += v * b9;\n  t17 += v * b10;\n  t18 += v * b11;\n  t19 += v * b12;\n  t20 += v * b13;\n  t21 += v * b14;\n  t22 += v * b15;\n  v = a[8];\n  t8 += v * b0;\n  t9 += v * b1;\n  t10 += v * b2;\n  t11 += v * b3;\n  t12 += v * b4;\n  t13 += v * b5;\n  t14 += v * b6;\n  t15 += v * b7;\n  t16 += v * b8;\n  t17 += v * b9;\n  t18 += v * b10;\n  t19 += v * b11;\n  t20 += v * b12;\n  t21 += v * b13;\n  t22 += v * b14;\n  t23 += v * b15;\n  v = a[9];\n  t9 += v * b0;\n  t10 += v * b1;\n  t11 += v * b2;\n  t12 += v * b3;\n  t13 += v * b4;\n  t14 += v * b5;\n  t15 += v * b6;\n  t16 += v * b7;\n  t17 += v * b8;\n  t18 += v * b9;\n  t19 += v * b10;\n  t20 += v * b11;\n  t21 += v * b12;\n  t22 += v * b13;\n  t23 += v * b14;\n  t24 += v * b15;\n  v = a[10];\n  t10 += v * b0;\n  t11 += v * b1;\n  t12 += v * b2;\n  t13 += v * b3;\n  t14 += v * b4;\n  t15 += v * b5;\n  t16 += v * b6;\n  t17 += v * b7;\n  t18 += v * b8;\n  t19 += v * b9;\n  t20 += v * b10;\n  t21 += v * b11;\n  t22 += v * b12;\n  t23 += v * b13;\n  t24 += v * b14;\n  t25 += v * b15;\n  v = a[11];\n  t11 += v * b0;\n  t12 += v * b1;\n  t13 += v * b2;\n  t14 += v * b3;\n  t15 += v * b4;\n  t16 += v * b5;\n  t17 += v * b6;\n  t18 += v * b7;\n  t19 += v * b8;\n  t20 += v * b9;\n  t21 += v * b10;\n  t22 += v * b11;\n  t23 += v * b12;\n  t24 += v * b13;\n  t25 += v * b14;\n  t26 += v * b15;\n  v = a[12];\n  t12 += v * b0;\n  t13 += v * b1;\n  t14 += v * b2;\n  t15 += v * b3;\n  t16 += v * b4;\n  t17 += v * b5;\n  t18 += v * b6;\n  t19 += v * b7;\n  t20 += v * b8;\n  t21 += v * b9;\n  t22 += v * b10;\n  t23 += v * b11;\n  t24 += v * b12;\n  t25 += v * b13;\n  t26 += v * b14;\n  t27 += v * b15;\n  v = a[13];\n  t13 += v * b0;\n  t14 += v * b1;\n  t15 += v * b2;\n  t16 += v * b3;\n  t17 += v * b4;\n  t18 += v * b5;\n  t19 += v * b6;\n  t20 += v * b7;\n  t21 += v * b8;\n  t22 += v * b9;\n  t23 += v * b10;\n  t24 += v * b11;\n  t25 += v * b12;\n  t26 += v * b13;\n  t27 += v * b14;\n  t28 += v * b15;\n  v = a[14];\n  t14 += v * b0;\n  t15 += v * b1;\n  t16 += v * b2;\n  t17 += v * b3;\n  t18 += v * b4;\n  t19 += v * b5;\n  t20 += v * b6;\n  t21 += v * b7;\n  t22 += v * b8;\n  t23 += v * b9;\n  t24 += v * b10;\n  t25 += v * b11;\n  t26 += v * b12;\n  t27 += v * b13;\n  t28 += v * b14;\n  t29 += v * b15;\n  v = a[15];\n  t15 += v * b0;\n  t16 += v * b1;\n  t17 += v * b2;\n  t18 += v * b3;\n  t19 += v * b4;\n  t20 += v * b5;\n  t21 += v * b6;\n  t22 += v * b7;\n  t23 += v * b8;\n  t24 += v * b9;\n  t25 += v * b10;\n  t26 += v * b11;\n  t27 += v * b12;\n  t28 += v * b13;\n  t29 += v * b14;\n  t30 += v * b15;\n\n  t0  += 38 * t16;\n  t1  += 38 * t17;\n  t2  += 38 * t18;\n  t3  += 38 * t19;\n  t4  += 38 * t20;\n  t5  += 38 * t21;\n  t6  += 38 * t22;\n  t7  += 38 * t23;\n  t8  += 38 * t24;\n  t9  += 38 * t25;\n  t10 += 38 * t26;\n  t11 += 38 * t27;\n  t12 += 38 * t28;\n  t13 += 38 * t29;\n  t14 += 38 * t30;\n  // t15 left as is\n\n  // first car\n  c = 1;\n  v =  t0 + c + 65535; c = Math.floor(v / 65536);  t0 = v - c * 65536;\n  v =  t1 + c + 65535; c = Math.floor(v / 65536);  t1 = v - c * 65536;\n  v =  t2 + c + 65535; c = Math.floor(v / 65536);  t2 = v - c * 65536;\n  v =  t3 + c + 65535; c = Math.floor(v / 65536);  t3 = v - c * 65536;\n  v =  t4 + c + 65535; c = Math.floor(v / 65536);  t4 = v - c * 65536;\n  v =  t5 + c + 65535; c = Math.floor(v / 65536);  t5 = v - c * 65536;\n  v =  t6 + c + 65535; c = Math.floor(v / 65536);  t6 = v - c * 65536;\n  v =  t7 + c + 65535; c = Math.floor(v / 65536);  t7 = v - c * 65536;\n  v =  t8 + c + 65535; c = Math.floor(v / 65536);  t8 = v - c * 65536;\n  v =  t9 + c + 65535; c = Math.floor(v / 65536);  t9 = v - c * 65536;\n  v = t10 + c + 65535; c = Math.floor(v / 65536); t10 = v - c * 65536;\n  v = t11 + c + 65535; c = Math.floor(v / 65536); t11 = v - c * 65536;\n  v = t12 + c + 65535; c = Math.floor(v / 65536); t12 = v - c * 65536;\n  v = t13 + c + 65535; c = Math.floor(v / 65536); t13 = v - c * 65536;\n  v = t14 + c + 65535; c = Math.floor(v / 65536); t14 = v - c * 65536;\n  v = t15 + c + 65535; c = Math.floor(v / 65536); t15 = v - c * 65536;\n  t0 += c-1 + 37 * (c-1);\n\n  // second car\n  c = 1;\n  v =  t0 + c + 65535; c = Math.floor(v / 65536);  t0 = v - c * 65536;\n  v =  t1 + c + 65535; c = Math.floor(v / 65536);  t1 = v - c * 65536;\n  v =  t2 + c + 65535; c = Math.floor(v / 65536);  t2 = v - c * 65536;\n  v =  t3 + c + 65535; c = Math.floor(v / 65536);  t3 = v - c * 65536;\n  v =  t4 + c + 65535; c = Math.floor(v / 65536);  t4 = v - c * 65536;\n  v =  t5 + c + 65535; c = Math.floor(v / 65536);  t5 = v - c * 65536;\n  v =  t6 + c + 65535; c = Math.floor(v / 65536);  t6 = v - c * 65536;\n  v =  t7 + c + 65535; c = Math.floor(v / 65536);  t7 = v - c * 65536;\n  v =  t8 + c + 65535; c = Math.floor(v / 65536);  t8 = v - c * 65536;\n  v =  t9 + c + 65535; c = Math.floor(v / 65536);  t9 = v - c * 65536;\n  v = t10 + c + 65535; c = Math.floor(v / 65536); t10 = v - c * 65536;\n  v = t11 + c + 65535; c = Math.floor(v / 65536); t11 = v - c * 65536;\n  v = t12 + c + 65535; c = Math.floor(v / 65536); t12 = v - c * 65536;\n  v = t13 + c + 65535; c = Math.floor(v / 65536); t13 = v - c * 65536;\n  v = t14 + c + 65535; c = Math.floor(v / 65536); t14 = v - c * 65536;\n  v = t15 + c + 65535; c = Math.floor(v / 65536); t15 = v - c * 65536;\n  t0 += c-1 + 37 * (c-1);\n\n  o[ 0] = t0;\n  o[ 1] = t1;\n  o[ 2] = t2;\n  o[ 3] = t3;\n  o[ 4] = t4;\n  o[ 5] = t5;\n  o[ 6] = t6;\n  o[ 7] = t7;\n  o[ 8] = t8;\n  o[ 9] = t9;\n  o[10] = t10;\n  o[11] = t11;\n  o[12] = t12;\n  o[13] = t13;\n  o[14] = t14;\n  o[15] = t15;\n}\n\nfunction S(o, a) {\n  M(o, a, a);\n}\n\nfunction inv25519(o, i) {\n  var c = gf();\n  var a;\n  for (a = 0; a < 16; a++) c[a] = i[a];\n  for (a = 253; a >= 0; a--) {\n    S(c, c);\n    if(a !== 2 && a !== 4) M(c, c, i);\n  }\n  for (a = 0; a < 16; a++) o[a] = c[a];\n}\n\nfunction pow2523(o, i) {\n  var c = gf();\n  var a;\n  for (a = 0; a < 16; a++) c[a] = i[a];\n  for (a = 250; a >= 0; a--) {\n      S(c, c);\n      if(a !== 1) M(c, c, i);\n  }\n  for (a = 0; a < 16; a++) o[a] = c[a];\n}\n\nfunction crypto_scalarmult(q, n, p) {\n  var z = new Uint8Array(32);\n  var x = new Float64Array(80), r, i;\n  var a = gf(), b = gf(), c = gf(),\n      d = gf(), e = gf(), f = gf();\n  for (i = 0; i < 31; i++) z[i] = n[i];\n  z[31]=(n[31]&127)|64;\n  z[0]&=248;\n  unpack25519(x,p);\n  for (i = 0; i < 16; i++) {\n    b[i]=x[i];\n    d[i]=a[i]=c[i]=0;\n  }\n  a[0]=d[0]=1;\n  for (i=254; i>=0; --i) {\n    r=(z[i>>>3]>>>(i&7))&1;\n    sel25519(a,b,r);\n    sel25519(c,d,r);\n    A(e,a,c);\n    Z(a,a,c);\n    A(c,b,d);\n    Z(b,b,d);\n    S(d,e);\n    S(f,a);\n    M(a,c,a);\n    M(c,b,e);\n    A(e,a,c);\n    Z(a,a,c);\n    S(b,a);\n    Z(c,d,f);\n    M(a,c,_121665);\n    A(a,a,d);\n    M(c,c,a);\n    M(a,d,f);\n    M(d,b,x);\n    S(b,e);\n    sel25519(a,b,r);\n    sel25519(c,d,r);\n  }\n  for (i = 0; i < 16; i++) {\n    x[i+16]=a[i];\n    x[i+32]=c[i];\n    x[i+48]=b[i];\n    x[i+64]=d[i];\n  }\n  var x32 = x.subarray(32);\n  var x16 = x.subarray(16);\n  inv25519(x32,x32);\n  M(x16,x16,x32);\n  pack25519(q,x16);\n  return 0;\n}\n\nfunction crypto_scalarmult_base(q, n) {\n  return crypto_scalarmult(q, n, _9);\n}\n\nfunction crypto_box_keypair(y, x) {\n  randombytes(x, 32);\n  return crypto_scalarmult_base(y, x);\n}\n\nfunction crypto_box_beforenm(k, y, x) {\n  var s = new Uint8Array(32);\n  crypto_scalarmult(s, x, y);\n  return crypto_core_hsalsa20(k, _0, s, sigma);\n}\n\nvar crypto_box_afternm = crypto_secretbox;\nvar crypto_box_open_afternm = crypto_secretbox_open;\n\nfunction crypto_box(c, m, d, n, y, x) {\n  var k = new Uint8Array(32);\n  crypto_box_beforenm(k, y, x);\n  return crypto_box_afternm(c, m, d, n, k);\n}\n\nfunction crypto_box_open(m, c, d, n, y, x) {\n  var k = new Uint8Array(32);\n  crypto_box_beforenm(k, y, x);\n  return crypto_box_open_afternm(m, c, d, n, k);\n}\n\nvar K = [\n  0x428a2f98, 0xd728ae22, 0x71374491, 0x23ef65cd,\n  0xb5c0fbcf, 0xec4d3b2f, 0xe9b5dba5, 0x8189dbbc,\n  0x3956c25b, 0xf348b538, 0x59f111f1, 0xb605d019,\n  0x923f82a4, 0xaf194f9b, 0xab1c5ed5, 0xda6d8118,\n  0xd807aa98, 0xa3030242, 0x12835b01, 0x45706fbe,\n  0x243185be, 0x4ee4b28c, 0x550c7dc3, 0xd5ffb4e2,\n  0x72be5d74, 0xf27b896f, 0x80deb1fe, 0x3b1696b1,\n  0x9bdc06a7, 0x25c71235, 0xc19bf174, 0xcf692694,\n  0xe49b69c1, 0x9ef14ad2, 0xefbe4786, 0x384f25e3,\n  0x0fc19dc6, 0x8b8cd5b5, 0x240ca1cc, 0x77ac9c65,\n  0x2de92c6f, 0x592b0275, 0x4a7484aa, 0x6ea6e483,\n  0x5cb0a9dc, 0xbd41fbd4, 0x76f988da, 0x831153b5,\n  0x983e5152, 0xee66dfab, 0xa831c66d, 0x2db43210,\n  0xb00327c8, 0x98fb213f, 0xbf597fc7, 0xbeef0ee4,\n  0xc6e00bf3, 0x3da88fc2, 0xd5a79147, 0x930aa725,\n  0x06ca6351, 0xe003826f, 0x14292967, 0x0a0e6e70,\n  0x27b70a85, 0x46d22ffc, 0x2e1b2138, 0x5c26c926,\n  0x4d2c6dfc, 0x5ac42aed, 0x53380d13, 0x9d95b3df,\n  0x650a7354, 0x8baf63de, 0x766a0abb, 0x3c77b2a8,\n  0x81c2c92e, 0x47edaee6, 0x92722c85, 0x1482353b,\n  0xa2bfe8a1, 0x4cf10364, 0xa81a664b, 0xbc423001,\n  0xc24b8b70, 0xd0f89791, 0xc76c51a3, 0x0654be30,\n  0xd192e819, 0xd6ef5218, 0xd6990624, 0x5565a910,\n  0xf40e3585, 0x5771202a, 0x106aa070, 0x32bbd1b8,\n  0x19a4c116, 0xb8d2d0c8, 0x1e376c08, 0x5141ab53,\n  0x2748774c, 0xdf8eeb99, 0x34b0bcb5, 0xe19b48a8,\n  0x391c0cb3, 0xc5c95a63, 0x4ed8aa4a, 0xe3418acb,\n  0x5b9cca4f, 0x7763e373, 0x682e6ff3, 0xd6b2b8a3,\n  0x748f82ee, 0x5defb2fc, 0x78a5636f, 0x43172f60,\n  0x84c87814, 0xa1f0ab72, 0x8cc70208, 0x1a6439ec,\n  0x90befffa, 0x23631e28, 0xa4506ceb, 0xde82bde9,\n  0xbef9a3f7, 0xb2c67915, 0xc67178f2, 0xe372532b,\n  0xca273ece, 0xea26619c, 0xd186b8c7, 0x21c0c207,\n  0xeada7dd6, 0xcde0eb1e, 0xf57d4f7f, 0xee6ed178,\n  0x06f067aa, 0x72176fba, 0x0a637dc5, 0xa2c898a6,\n  0x113f9804, 0xbef90dae, 0x1b710b35, 0x131c471b,\n  0x28db77f5, 0x23047d84, 0x32caab7b, 0x40c72493,\n  0x3c9ebe0a, 0x15c9bebc, 0x431d67c4, 0x9c100d4c,\n  0x4cc5d4be, 0xcb3e42b6, 0x597f299c, 0xfc657e2a,\n  0x5fcb6fab, 0x3ad6faec, 0x6c44198c, 0x4a475817\n];\n\nfunction crypto_hashblocks_hl(hh, hl, m, n) {\n  var wh = new Int32Array(16), wl = new Int32Array(16),\n      bh0, bh1, bh2, bh3, bh4, bh5, bh6, bh7,\n      bl0, bl1, bl2, bl3, bl4, bl5, bl6, bl7,\n      th, tl, i, j, h, l, a, b, c, d;\n\n  var ah0 = hh[0],\n      ah1 = hh[1],\n      ah2 = hh[2],\n      ah3 = hh[3],\n      ah4 = hh[4],\n      ah5 = hh[5],\n      ah6 = hh[6],\n      ah7 = hh[7],\n\n      al0 = hl[0],\n      al1 = hl[1],\n      al2 = hl[2],\n      al3 = hl[3],\n      al4 = hl[4],\n      al5 = hl[5],\n      al6 = hl[6],\n      al7 = hl[7];\n\n  var pos = 0;\n  while (n >= 128) {\n    for (i = 0; i < 16; i++) {\n      j = 8 * i + pos;\n      wh[i] = (m[j+0] << 24) | (m[j+1] << 16) | (m[j+2] << 8) | m[j+3];\n      wl[i] = (m[j+4] << 24) | (m[j+5] << 16) | (m[j+6] << 8) | m[j+7];\n    }\n    for (i = 0; i < 80; i++) {\n      bh0 = ah0;\n      bh1 = ah1;\n      bh2 = ah2;\n      bh3 = ah3;\n      bh4 = ah4;\n      bh5 = ah5;\n      bh6 = ah6;\n      bh7 = ah7;\n\n      bl0 = al0;\n      bl1 = al1;\n      bl2 = al2;\n      bl3 = al3;\n      bl4 = al4;\n      bl5 = al5;\n      bl6 = al6;\n      bl7 = al7;\n\n      // add\n      h = ah7;\n      l = al7;\n\n      a = l & 0xffff; b = l >>> 16;\n      c = h & 0xffff; d = h >>> 16;\n\n      // Sigma1\n      h = ((ah4 >>> 14) | (al4 << (32-14))) ^ ((ah4 >>> 18) | (al4 << (32-18))) ^ ((al4 >>> (41-32)) | (ah4 << (32-(41-32))));\n      l = ((al4 >>> 14) | (ah4 << (32-14))) ^ ((al4 >>> 18) | (ah4 << (32-18))) ^ ((ah4 >>> (41-32)) | (al4 << (32-(41-32))));\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      // Ch\n      h = (ah4 & ah5) ^ (~ah4 & ah6);\n      l = (al4 & al5) ^ (~al4 & al6);\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      // K\n      h = K[i*2];\n      l = K[i*2+1];\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      // w\n      h = wh[i%16];\n      l = wl[i%16];\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      b += a >>> 16;\n      c += b >>> 16;\n      d += c >>> 16;\n\n      th = c & 0xffff | d << 16;\n      tl = a & 0xffff | b << 16;\n\n      // add\n      h = th;\n      l = tl;\n\n      a = l & 0xffff; b = l >>> 16;\n      c = h & 0xffff; d = h >>> 16;\n\n      // Sigma0\n      h = ((ah0 >>> 28) | (al0 << (32-28))) ^ ((al0 >>> (34-32)) | (ah0 << (32-(34-32)))) ^ ((al0 >>> (39-32)) | (ah0 << (32-(39-32))));\n      l = ((al0 >>> 28) | (ah0 << (32-28))) ^ ((ah0 >>> (34-32)) | (al0 << (32-(34-32)))) ^ ((ah0 >>> (39-32)) | (al0 << (32-(39-32))));\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      // Maj\n      h = (ah0 & ah1) ^ (ah0 & ah2) ^ (ah1 & ah2);\n      l = (al0 & al1) ^ (al0 & al2) ^ (al1 & al2);\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      b += a >>> 16;\n      c += b >>> 16;\n      d += c >>> 16;\n\n      bh7 = (c & 0xffff) | (d << 16);\n      bl7 = (a & 0xffff) | (b << 16);\n\n      // add\n      h = bh3;\n      l = bl3;\n\n      a = l & 0xffff; b = l >>> 16;\n      c = h & 0xffff; d = h >>> 16;\n\n      h = th;\n      l = tl;\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      b += a >>> 16;\n      c += b >>> 16;\n      d += c >>> 16;\n\n      bh3 = (c & 0xffff) | (d << 16);\n      bl3 = (a & 0xffff) | (b << 16);\n\n      ah1 = bh0;\n      ah2 = bh1;\n      ah3 = bh2;\n      ah4 = bh3;\n      ah5 = bh4;\n      ah6 = bh5;\n      ah7 = bh6;\n      ah0 = bh7;\n\n      al1 = bl0;\n      al2 = bl1;\n      al3 = bl2;\n      al4 = bl3;\n      al5 = bl4;\n      al6 = bl5;\n      al7 = bl6;\n      al0 = bl7;\n\n      if (i%16 === 15) {\n        for (j = 0; j < 16; j++) {\n          // add\n          h = wh[j];\n          l = wl[j];\n\n          a = l & 0xffff; b = l >>> 16;\n          c = h & 0xffff; d = h >>> 16;\n\n          h = wh[(j+9)%16];\n          l = wl[(j+9)%16];\n\n          a += l & 0xffff; b += l >>> 16;\n          c += h & 0xffff; d += h >>> 16;\n\n          // sigma0\n          th = wh[(j+1)%16];\n          tl = wl[(j+1)%16];\n          h = ((th >>> 1) | (tl << (32-1))) ^ ((th >>> 8) | (tl << (32-8))) ^ (th >>> 7);\n          l = ((tl >>> 1) | (th << (32-1))) ^ ((tl >>> 8) | (th << (32-8))) ^ ((tl >>> 7) | (th << (32-7)));\n\n          a += l & 0xffff; b += l >>> 16;\n          c += h & 0xffff; d += h >>> 16;\n\n          // sigma1\n          th = wh[(j+14)%16];\n          tl = wl[(j+14)%16];\n          h = ((th >>> 19) | (tl << (32-19))) ^ ((tl >>> (61-32)) | (th << (32-(61-32)))) ^ (th >>> 6);\n          l = ((tl >>> 19) | (th << (32-19))) ^ ((th >>> (61-32)) | (tl << (32-(61-32)))) ^ ((tl >>> 6) | (th << (32-6)));\n\n          a += l & 0xffff; b += l >>> 16;\n          c += h & 0xffff; d += h >>> 16;\n\n          b += a >>> 16;\n          c += b >>> 16;\n          d += c >>> 16;\n\n          wh[j] = (c & 0xffff) | (d << 16);\n          wl[j] = (a & 0xffff) | (b << 16);\n        }\n      }\n    }\n\n    // add\n    h = ah0;\n    l = al0;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[0];\n    l = hl[0];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[0] = ah0 = (c & 0xffff) | (d << 16);\n    hl[0] = al0 = (a & 0xffff) | (b << 16);\n\n    h = ah1;\n    l = al1;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[1];\n    l = hl[1];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[1] = ah1 = (c & 0xffff) | (d << 16);\n    hl[1] = al1 = (a & 0xffff) | (b << 16);\n\n    h = ah2;\n    l = al2;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[2];\n    l = hl[2];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[2] = ah2 = (c & 0xffff) | (d << 16);\n    hl[2] = al2 = (a & 0xffff) | (b << 16);\n\n    h = ah3;\n    l = al3;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[3];\n    l = hl[3];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[3] = ah3 = (c & 0xffff) | (d << 16);\n    hl[3] = al3 = (a & 0xffff) | (b << 16);\n\n    h = ah4;\n    l = al4;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[4];\n    l = hl[4];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[4] = ah4 = (c & 0xffff) | (d << 16);\n    hl[4] = al4 = (a & 0xffff) | (b << 16);\n\n    h = ah5;\n    l = al5;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[5];\n    l = hl[5];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[5] = ah5 = (c & 0xffff) | (d << 16);\n    hl[5] = al5 = (a & 0xffff) | (b << 16);\n\n    h = ah6;\n    l = al6;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[6];\n    l = hl[6];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[6] = ah6 = (c & 0xffff) | (d << 16);\n    hl[6] = al6 = (a & 0xffff) | (b << 16);\n\n    h = ah7;\n    l = al7;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[7];\n    l = hl[7];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[7] = ah7 = (c & 0xffff) | (d << 16);\n    hl[7] = al7 = (a & 0xffff) | (b << 16);\n\n    pos += 128;\n    n -= 128;\n  }\n\n  return n;\n}\n\nfunction crypto_hash(out, m, n) {\n  var hh = new Int32Array(8),\n      hl = new Int32Array(8),\n      x = new Uint8Array(256),\n      i, b = n;\n\n  hh[0] = 0x6a09e667;\n  hh[1] = 0xbb67ae85;\n  hh[2] = 0x3c6ef372;\n  hh[3] = 0xa54ff53a;\n  hh[4] = 0x510e527f;\n  hh[5] = 0x9b05688c;\n  hh[6] = 0x1f83d9ab;\n  hh[7] = 0x5be0cd19;\n\n  hl[0] = 0xf3bcc908;\n  hl[1] = 0x84caa73b;\n  hl[2] = 0xfe94f82b;\n  hl[3] = 0x5f1d36f1;\n  hl[4] = 0xade682d1;\n  hl[5] = 0x2b3e6c1f;\n  hl[6] = 0xfb41bd6b;\n  hl[7] = 0x137e2179;\n\n  crypto_hashblocks_hl(hh, hl, m, n);\n  n %= 128;\n\n  for (i = 0; i < n; i++) x[i] = m[b-n+i];\n  x[n] = 128;\n\n  n = 256-128*(n<112?1:0);\n  x[n-9] = 0;\n  ts64(x, n-8,  (b / 0x20000000) | 0, b << 3);\n  crypto_hashblocks_hl(hh, hl, x, n);\n\n  for (i = 0; i < 8; i++) ts64(out, 8*i, hh[i], hl[i]);\n\n  return 0;\n}\n\nfunction add(p, q) {\n  var a = gf(), b = gf(), c = gf(),\n      d = gf(), e = gf(), f = gf(),\n      g = gf(), h = gf(), t = gf();\n\n  Z(a, p[1], p[0]);\n  Z(t, q[1], q[0]);\n  M(a, a, t);\n  A(b, p[0], p[1]);\n  A(t, q[0], q[1]);\n  M(b, b, t);\n  M(c, p[3], q[3]);\n  M(c, c, D2);\n  M(d, p[2], q[2]);\n  A(d, d, d);\n  Z(e, b, a);\n  Z(f, d, c);\n  A(g, d, c);\n  A(h, b, a);\n\n  M(p[0], e, f);\n  M(p[1], h, g);\n  M(p[2], g, f);\n  M(p[3], e, h);\n}\n\nfunction cswap(p, q, b) {\n  var i;\n  for (i = 0; i < 4; i++) {\n    sel25519(p[i], q[i], b);\n  }\n}\n\nfunction pack(r, p) {\n  var tx = gf(), ty = gf(), zi = gf();\n  inv25519(zi, p[2]);\n  M(tx, p[0], zi);\n  M(ty, p[1], zi);\n  pack25519(r, ty);\n  r[31] ^= par25519(tx) << 7;\n}\n\nfunction scalarmult(p, q, s) {\n  var b, i;\n  set25519(p[0], gf0);\n  set25519(p[1], gf1);\n  set25519(p[2], gf1);\n  set25519(p[3], gf0);\n  for (i = 255; i >= 0; --i) {\n    b = (s[(i/8)|0] >> (i&7)) & 1;\n    cswap(p, q, b);\n    add(q, p);\n    add(p, p);\n    cswap(p, q, b);\n  }\n}\n\nfunction scalarbase(p, s) {\n  var q = [gf(), gf(), gf(), gf()];\n  set25519(q[0], X);\n  set25519(q[1], Y);\n  set25519(q[2], gf1);\n  M(q[3], X, Y);\n  scalarmult(p, q, s);\n}\n\nfunction crypto_sign_keypair(pk, sk, seeded) {\n  var d = new Uint8Array(64);\n  var p = [gf(), gf(), gf(), gf()];\n  var i;\n\n  if (!seeded) randombytes(sk, 32);\n  crypto_hash(d, sk, 32);\n  d[0] &= 248;\n  d[31] &= 127;\n  d[31] |= 64;\n\n  scalarbase(p, d);\n  pack(pk, p);\n\n  for (i = 0; i < 32; i++) sk[i+32] = pk[i];\n  return 0;\n}\n\nvar L = new Float64Array([0xed, 0xd3, 0xf5, 0x5c, 0x1a, 0x63, 0x12, 0x58, 0xd6, 0x9c, 0xf7, 0xa2, 0xde, 0xf9, 0xde, 0x14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x10]);\n\nfunction modL(r, x) {\n  var carry, i, j, k;\n  for (i = 63; i >= 32; --i) {\n    carry = 0;\n    for (j = i - 32, k = i - 12; j < k; ++j) {\n      x[j] += carry - 16 * x[i] * L[j - (i - 32)];\n      carry = Math.floor((x[j] + 128) / 256);\n      x[j] -= carry * 256;\n    }\n    x[j] += carry;\n    x[i] = 0;\n  }\n  carry = 0;\n  for (j = 0; j < 32; j++) {\n    x[j] += carry - (x[31] >> 4) * L[j];\n    carry = x[j] >> 8;\n    x[j] &= 255;\n  }\n  for (j = 0; j < 32; j++) x[j] -= carry * L[j];\n  for (i = 0; i < 32; i++) {\n    x[i+1] += x[i] >> 8;\n    r[i] = x[i] & 255;\n  }\n}\n\nfunction reduce(r) {\n  var x = new Float64Array(64), i;\n  for (i = 0; i < 64; i++) x[i] = r[i];\n  for (i = 0; i < 64; i++) r[i] = 0;\n  modL(r, x);\n}\n\n// Note: difference from C - smlen returned, not passed as argument.\nfunction crypto_sign(sm, m, n, sk) {\n  var d = new Uint8Array(64), h = new Uint8Array(64), r = new Uint8Array(64);\n  var i, j, x = new Float64Array(64);\n  var p = [gf(), gf(), gf(), gf()];\n\n  crypto_hash(d, sk, 32);\n  d[0] &= 248;\n  d[31] &= 127;\n  d[31] |= 64;\n\n  var smlen = n + 64;\n  for (i = 0; i < n; i++) sm[64 + i] = m[i];\n  for (i = 0; i < 32; i++) sm[32 + i] = d[32 + i];\n\n  crypto_hash(r, sm.subarray(32), n+32);\n  reduce(r);\n  scalarbase(p, r);\n  pack(sm, p);\n\n  for (i = 32; i < 64; i++) sm[i] = sk[i];\n  crypto_hash(h, sm, n + 64);\n  reduce(h);\n\n  for (i = 0; i < 64; i++) x[i] = 0;\n  for (i = 0; i < 32; i++) x[i] = r[i];\n  for (i = 0; i < 32; i++) {\n    for (j = 0; j < 32; j++) {\n      x[i+j] += h[i] * d[j];\n    }\n  }\n\n  modL(sm.subarray(32), x);\n  return smlen;\n}\n\nfunction unpackneg(r, p) {\n  var t = gf(), chk = gf(), num = gf(),\n      den = gf(), den2 = gf(), den4 = gf(),\n      den6 = gf();\n\n  set25519(r[2], gf1);\n  unpack25519(r[1], p);\n  S(num, r[1]);\n  M(den, num, D);\n  Z(num, num, r[2]);\n  A(den, r[2], den);\n\n  S(den2, den);\n  S(den4, den2);\n  M(den6, den4, den2);\n  M(t, den6, num);\n  M(t, t, den);\n\n  pow2523(t, t);\n  M(t, t, num);\n  M(t, t, den);\n  M(t, t, den);\n  M(r[0], t, den);\n\n  S(chk, r[0]);\n  M(chk, chk, den);\n  if (neq25519(chk, num)) M(r[0], r[0], I);\n\n  S(chk, r[0]);\n  M(chk, chk, den);\n  if (neq25519(chk, num)) return -1;\n\n  if (par25519(r[0]) === (p[31]>>7)) Z(r[0], gf0, r[0]);\n\n  M(r[3], r[0], r[1]);\n  return 0;\n}\n\nfunction crypto_sign_open(m, sm, n, pk) {\n  var i;\n  var t = new Uint8Array(32), h = new Uint8Array(64);\n  var p = [gf(), gf(), gf(), gf()],\n      q = [gf(), gf(), gf(), gf()];\n\n  if (n < 64) return -1;\n\n  if (unpackneg(q, pk)) return -1;\n\n  for (i = 0; i < n; i++) m[i] = sm[i];\n  for (i = 0; i < 32; i++) m[i+32] = pk[i];\n  crypto_hash(h, m, n);\n  reduce(h);\n  scalarmult(p, q, h);\n\n  scalarbase(q, sm.subarray(32));\n  add(p, q);\n  pack(t, p);\n\n  n -= 64;\n  if (crypto_verify_32(sm, 0, t, 0)) {\n    for (i = 0; i < n; i++) m[i] = 0;\n    return -1;\n  }\n\n  for (i = 0; i < n; i++) m[i] = sm[i + 64];\n  return n;\n}\n\nvar crypto_secretbox_KEYBYTES = 32,\n    crypto_secretbox_NONCEBYTES = 24,\n    crypto_secretbox_ZEROBYTES = 32,\n    crypto_secretbox_BOXZEROBYTES = 16,\n    crypto_scalarmult_BYTES = 32,\n    crypto_scalarmult_SCALARBYTES = 32,\n    crypto_box_PUBLICKEYBYTES = 32,\n    crypto_box_SECRETKEYBYTES = 32,\n    crypto_box_BEFORENMBYTES = 32,\n    crypto_box_NONCEBYTES = crypto_secretbox_NONCEBYTES,\n    crypto_box_ZEROBYTES = crypto_secretbox_ZEROBYTES,\n    crypto_box_BOXZEROBYTES = crypto_secretbox_BOXZEROBYTES,\n    crypto_sign_BYTES = 64,\n    crypto_sign_PUBLICKEYBYTES = 32,\n    crypto_sign_SECRETKEYBYTES = 64,\n    crypto_sign_SEEDBYTES = 32,\n    crypto_hash_BYTES = 64;\n\nnacl.lowlevel = {\n  crypto_core_hsalsa20: crypto_core_hsalsa20,\n  crypto_stream_xor: crypto_stream_xor,\n  crypto_stream: crypto_stream,\n  crypto_stream_salsa20_xor: crypto_stream_salsa20_xor,\n  crypto_stream_salsa20: crypto_stream_salsa20,\n  crypto_onetimeauth: crypto_onetimeauth,\n  crypto_onetimeauth_verify: crypto_onetimeauth_verify,\n  crypto_verify_16: crypto_verify_16,\n  crypto_verify_32: crypto_verify_32,\n  crypto_secretbox: crypto_secretbox,\n  crypto_secretbox_open: crypto_secretbox_open,\n  crypto_scalarmult: crypto_scalarmult,\n  crypto_scalarmult_base: crypto_scalarmult_base,\n  crypto_box_beforenm: crypto_box_beforenm,\n  crypto_box_afternm: crypto_box_afternm,\n  crypto_box: crypto_box,\n  crypto_box_open: crypto_box_open,\n  crypto_box_keypair: crypto_box_keypair,\n  crypto_hash: crypto_hash,\n  crypto_sign: crypto_sign,\n  crypto_sign_keypair: crypto_sign_keypair,\n  crypto_sign_open: crypto_sign_open,\n\n  crypto_secretbox_KEYBYTES: crypto_secretbox_KEYBYTES,\n  crypto_secretbox_NONCEBYTES: crypto_secretbox_NONCEBYTES,\n  crypto_secretbox_ZEROBYTES: crypto_secretbox_ZEROBYTES,\n  crypto_secretbox_BOXZEROBYTES: crypto_secretbox_BOXZEROBYTES,\n  crypto_scalarmult_BYTES: crypto_scalarmult_BYTES,\n  crypto_scalarmult_SCALARBYTES: crypto_scalarmult_SCALARBYTES,\n  crypto_box_PUBLICKEYBYTES: crypto_box_PUBLICKEYBYTES,\n  crypto_box_SECRETKEYBYTES: crypto_box_SECRETKEYBYTES,\n  crypto_box_BEFORENMBYTES: crypto_box_BEFORENMBYTES,\n  crypto_box_NONCEBYTES: crypto_box_NONCEBYTES,\n  crypto_box_ZEROBYTES: crypto_box_ZEROBYTES,\n  crypto_box_BOXZEROBYTES: crypto_box_BOXZEROBYTES,\n  crypto_sign_BYTES: crypto_sign_BYTES,\n  crypto_sign_PUBLICKEYBYTES: crypto_sign_PUBLICKEYBYTES,\n  crypto_sign_SECRETKEYBYTES: crypto_sign_SECRETKEYBYTES,\n  crypto_sign_SEEDBYTES: crypto_sign_SEEDBYTES,\n  crypto_hash_BYTES: crypto_hash_BYTES,\n\n  gf: gf,\n  D: D,\n  L: L,\n  pack25519: pack25519,\n  unpack25519: unpack25519,\n  M: M,\n  A: A,\n  S: S,\n  Z: Z,\n  pow2523: pow2523,\n  add: add,\n  set25519: set25519,\n  modL: modL,\n  scalarmult: scalarmult,\n  scalarbase: scalarbase,\n};\n\n/* High-level API */\n\nfunction checkLengths(k, n) {\n  if (k.length !== crypto_secretbox_KEYBYTES) throw new Error('bad key size');\n  if (n.length !== crypto_secretbox_NONCEBYTES) throw new Error('bad nonce size');\n}\n\nfunction checkBoxLengths(pk, sk) {\n  if (pk.length !== crypto_box_PUBLICKEYBYTES) throw new Error('bad public key size');\n  if (sk.length !== crypto_box_SECRETKEYBYTES) throw new Error('bad secret key size');\n}\n\nfunction checkArrayTypes() {\n  for (var i = 0; i < arguments.length; i++) {\n    if (!(arguments[i] instanceof Uint8Array))\n      throw new TypeError('unexpected type, use Uint8Array');\n  }\n}\n\nfunction cleanup(arr) {\n  for (var i = 0; i < arr.length; i++) arr[i] = 0;\n}\n\nnacl.randomBytes = function(n) {\n  var b = new Uint8Array(n);\n  randombytes(b, n);\n  return b;\n};\n\nnacl.secretbox = function(msg, nonce, key) {\n  checkArrayTypes(msg, nonce, key);\n  checkLengths(key, nonce);\n  var m = new Uint8Array(crypto_secretbox_ZEROBYTES + msg.length);\n  var c = new Uint8Array(m.length);\n  for (var i = 0; i < msg.length; i++) m[i+crypto_secretbox_ZEROBYTES] = msg[i];\n  crypto_secretbox(c, m, m.length, nonce, key);\n  return c.subarray(crypto_secretbox_BOXZEROBYTES);\n};\n\nnacl.secretbox.open = function(box, nonce, key) {\n  checkArrayTypes(box, nonce, key);\n  checkLengths(key, nonce);\n  var c = new Uint8Array(crypto_secretbox_BOXZEROBYTES + box.length);\n  var m = new Uint8Array(c.length);\n  for (var i = 0; i < box.length; i++) c[i+crypto_secretbox_BOXZEROBYTES] = box[i];\n  if (c.length < 32) return null;\n  if (crypto_secretbox_open(m, c, c.length, nonce, key) !== 0) return null;\n  return m.subarray(crypto_secretbox_ZEROBYTES);\n};\n\nnacl.secretbox.keyLength = crypto_secretbox_KEYBYTES;\nnacl.secretbox.nonceLength = crypto_secretbox_NONCEBYTES;\nnacl.secretbox.overheadLength = crypto_secretbox_BOXZEROBYTES;\n\nnacl.scalarMult = function(n, p) {\n  checkArrayTypes(n, p);\n  if (n.length !== crypto_scalarmult_SCALARBYTES) throw new Error('bad n size');\n  if (p.length !== crypto_scalarmult_BYTES) throw new Error('bad p size');\n  var q = new Uint8Array(crypto_scalarmult_BYTES);\n  crypto_scalarmult(q, n, p);\n  return q;\n};\n\nnacl.scalarMult.base = function(n) {\n  checkArrayTypes(n);\n  if (n.length !== crypto_scalarmult_SCALARBYTES) throw new Error('bad n size');\n  var q = new Uint8Array(crypto_scalarmult_BYTES);\n  crypto_scalarmult_base(q, n);\n  return q;\n};\n\nnacl.scalarMult.scalarLength = crypto_scalarmult_SCALARBYTES;\nnacl.scalarMult.groupElementLength = crypto_scalarmult_BYTES;\n\nnacl.box = function(msg, nonce, publicKey, secretKey) {\n  var k = nacl.box.before(publicKey, secretKey);\n  return nacl.secretbox(msg, nonce, k);\n};\n\nnacl.box.before = function(publicKey, secretKey) {\n  checkArrayTypes(publicKey, secretKey);\n  checkBoxLengths(publicKey, secretKey);\n  var k = new Uint8Array(crypto_box_BEFORENMBYTES);\n  crypto_box_beforenm(k, publicKey, secretKey);\n  return k;\n};\n\nnacl.box.after = nacl.secretbox;\n\nnacl.box.open = function(msg, nonce, publicKey, secretKey) {\n  var k = nacl.box.before(publicKey, secretKey);\n  return nacl.secretbox.open(msg, nonce, k);\n};\n\nnacl.box.open.after = nacl.secretbox.open;\n\nnacl.box.keyPair = function() {\n  var pk = new Uint8Array(crypto_box_PUBLICKEYBYTES);\n  var sk = new Uint8Array(crypto_box_SECRETKEYBYTES);\n  crypto_box_keypair(pk, sk);\n  return {publicKey: pk, secretKey: sk};\n};\n\nnacl.box.keyPair.fromSecretKey = function(secretKey) {\n  checkArrayTypes(secretKey);\n  if (secretKey.length !== crypto_box_SECRETKEYBYTES)\n    throw new Error('bad secret key size');\n  var pk = new Uint8Array(crypto_box_PUBLICKEYBYTES);\n  crypto_scalarmult_base(pk, secretKey);\n  return {publicKey: pk, secretKey: new Uint8Array(secretKey)};\n};\n\nnacl.box.publicKeyLength = crypto_box_PUBLICKEYBYTES;\nnacl.box.secretKeyLength = crypto_box_SECRETKEYBYTES;\nnacl.box.sharedKeyLength = crypto_box_BEFORENMBYTES;\nnacl.box.nonceLength = crypto_box_NONCEBYTES;\nnacl.box.overheadLength = nacl.secretbox.overheadLength;\n\nnacl.sign = function(msg, secretKey) {\n  checkArrayTypes(msg, secretKey);\n  if (secretKey.length !== crypto_sign_SECRETKEYBYTES)\n    throw new Error('bad secret key size');\n  var signedMsg = new Uint8Array(crypto_sign_BYTES+msg.length);\n  crypto_sign(signedMsg, msg, msg.length, secretKey);\n  return signedMsg;\n};\n\nnacl.sign.open = function(signedMsg, publicKey) {\n  checkArrayTypes(signedMsg, publicKey);\n  if (publicKey.length !== crypto_sign_PUBLICKEYBYTES)\n    throw new Error('bad public key size');\n  var tmp = new Uint8Array(signedMsg.length);\n  var mlen = crypto_sign_open(tmp, signedMsg, signedMsg.length, publicKey);\n  if (mlen < 0) return null;\n  var m = new Uint8Array(mlen);\n  for (var i = 0; i < m.length; i++) m[i] = tmp[i];\n  return m;\n};\n\nnacl.sign.detached = function(msg, secretKey) {\n  var signedMsg = nacl.sign(msg, secretKey);\n  var sig = new Uint8Array(crypto_sign_BYTES);\n  for (var i = 0; i < sig.length; i++) sig[i] = signedMsg[i];\n  return sig;\n};\n\nnacl.sign.detached.verify = function(msg, sig, publicKey) {\n  checkArrayTypes(msg, sig, publicKey);\n  if (sig.length !== crypto_sign_BYTES)\n    throw new Error('bad signature size');\n  if (publicKey.length !== crypto_sign_PUBLICKEYBYTES)\n    throw new Error('bad public key size');\n  var sm = new Uint8Array(crypto_sign_BYTES + msg.length);\n  var m = new Uint8Array(crypto_sign_BYTES + msg.length);\n  var i;\n  for (i = 0; i < crypto_sign_BYTES; i++) sm[i] = sig[i];\n  for (i = 0; i < msg.length; i++) sm[i+crypto_sign_BYTES] = msg[i];\n  return (crypto_sign_open(m, sm, sm.length, publicKey) >= 0);\n};\n\nnacl.sign.keyPair = function() {\n  var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);\n  var sk = new Uint8Array(crypto_sign_SECRETKEYBYTES);\n  crypto_sign_keypair(pk, sk);\n  return {publicKey: pk, secretKey: sk};\n};\n\nnacl.sign.keyPair.fromSecretKey = function(secretKey) {\n  checkArrayTypes(secretKey);\n  if (secretKey.length !== crypto_sign_SECRETKEYBYTES)\n    throw new Error('bad secret key size');\n  var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);\n  for (var i = 0; i < pk.length; i++) pk[i] = secretKey[32+i];\n  return {publicKey: pk, secretKey: new Uint8Array(secretKey)};\n};\n\nnacl.sign.keyPair.fromSeed = function(seed) {\n  checkArrayTypes(seed);\n  if (seed.length !== crypto_sign_SEEDBYTES)\n    throw new Error('bad seed size');\n  var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);\n  var sk = new Uint8Array(crypto_sign_SECRETKEYBYTES);\n  for (var i = 0; i < 32; i++) sk[i] = seed[i];\n  crypto_sign_keypair(pk, sk, true);\n  return {publicKey: pk, secretKey: sk};\n};\n\nnacl.sign.publicKeyLength = crypto_sign_PUBLICKEYBYTES;\nnacl.sign.secretKeyLength = crypto_sign_SECRETKEYBYTES;\nnacl.sign.seedLength = crypto_sign_SEEDBYTES;\nnacl.sign.signatureLength = crypto_sign_BYTES;\n\nnacl.hash = function(msg) {\n  checkArrayTypes(msg);\n  var h = new Uint8Array(crypto_hash_BYTES);\n  crypto_hash(h, msg, msg.length);\n  return h;\n};\n\nnacl.hash.hashLength = crypto_hash_BYTES;\n\nnacl.verify = function(x, y) {\n  checkArrayTypes(x, y);\n  // Zero length arguments are considered not equal.\n  if (x.length === 0 || y.length === 0) return false;\n  if (x.length !== y.length) return false;\n  return (vn(x, 0, y, 0, x.length) === 0) ? true : false;\n};\n\nnacl.setPRNG = function(fn) {\n  randombytes = fn;\n};\n\n(function() {\n  // Initialize PRNG if environment provides CSPRNG.\n  // If not, methods calling randombytes will throw.\n  var crypto = typeof self !== 'undefined' ? (self.crypto || self.msCrypto) : null;\n  if (crypto && crypto.getRandomValues) {\n    // Browsers.\n    var QUOTA = 65536;\n    nacl.setPRNG(function(x, n) {\n      var i, v = new Uint8Array(n);\n      for (i = 0; i < n; i += QUOTA) {\n        crypto.getRandomValues(v.subarray(i, i + Math.min(n - i, QUOTA)));\n      }\n      for (i = 0; i < n; i++) x[i] = v[i];\n      cleanup(v);\n    });\n  } else if (typeof require !== 'undefined') {\n    // Node.js.\n    crypto = require('crypto');\n    if (crypto && crypto.randomBytes) {\n      nacl.setPRNG(function(x, n) {\n        var i, v = crypto.randomBytes(n);\n        for (i = 0; i < n; i++) x[i] = v[i];\n        cleanup(v);\n      });\n    }\n  }\n})();\n\n})(typeof module !== 'undefined' && module.exports ? module.exports : (self.nacl = self.nacl || {}));\n", "/** Is null or undefined */\nexport const isNullish = <T>(argument: T | undefined | null): argument is undefined | null =>\n  argument === null || argument === undefined;\n\n/** Not null and not undefined */\nexport const nonNullish = <T>(argument: T | undefined | null): argument is NonNullable<T> =>\n  !isNullish(argument);\n\nexport class NullishError extends Error {}\n\nexport const assertNonNullish: <T>(\n  value: T,\n  message?: string\n) => asserts value is NonNullable<T> = <T>(value: T, message?: string): void => {\n  if (isNullish(value)) {\n    throw new NullishError(message);\n  }\n};\n", "import {nonNullish} from './null.utils';\n\nexport const toNullable = <T>(value?: T): [] | [T] => {\n  return nonNullish(value) ? [value] : [];\n};\n\nexport const fromNullable = <T>(value: [] | [T]): T | undefined => {\n  return value?.[0];\n};\n\nexport const toArray = async <T>(data: T): Promise<Uint8Array> => {\n  const blob: Blob = new Blob([JSON.stringify(data)], {\n    type: 'application/json; charset=utf-8'\n  });\n  return new Uint8Array(await blob.arrayBuffer());\n};\n\nexport const fromArray = async <T>(data: Uint8Array | number[]): Promise<T> => {\n  const blob: Blob = new Blob([data instanceof Uint8Array ? data : new Uint8Array(data)], {\n    type: 'application/json; charset=utf-8'\n  });\n  return JSON.parse(await blob.text());\n};\n", "export abstract class Store<T> {\n  private callbacks: {id: symbol; callback: (data: T | null) => void}[] = [];\n\n  protected populate(data: T | null) {\n    this.callbacks.forEach(({callback}: {id: symbol; callback: (data: T | null) => void}) =>\n      callback(data)\n    );\n  }\n\n  subscribe(callback: (data: T | null) => void): () => void {\n    const callbackId = Symbol();\n    this.callbacks.push({id: callbackId, callback});\n\n    return () =>\n      (this.callbacks = this.callbacks.filter(\n        ({id}: {id: symbol; callback: (data: T | null) => void}) => id !== callbackId\n      ));\n  }\n}\n", "import type {User} from '../types/auth.types';\nimport type {Unsubscribe} from '../types/subscription.types';\nimport {Store} from './store';\n\nexport class AuthStore extends Store<User | null> {\n  private static instance: AuthStore;\n\n  private authUser: User | null = null;\n\n  private constructor() {\n    super();\n  }\n\n  static getInstance() {\n    if (!AuthStore.instance) {\n      AuthStore.instance = new AuthStore();\n    }\n    return AuthStore.instance;\n  }\n\n  set(authUser: User | null) {\n    this.authUser = authUser;\n\n    this.populate(authUser);\n  }\n\n  get(): User | null {\n    return this.authUser;\n  }\n\n  override subscribe(callback: (data: User | null) => void): Unsubscribe {\n    const unsubscribe: () => void = super.subscribe(callback);\n\n    callback(this.authUser);\n\n    return unsubscribe;\n  }\n\n  reset() {\n    this.authUser = null;\n\n    this.populate(this.authUser);\n  }\n}\n", "export const emit = <T>({message, detail}: {message: string; detail?: T | undefined}) => {\n  const $event: CustomEvent<T> = new CustomEvent<T>(message, {detail, bubbles: true});\n  document.dispatchEvent($event);\n};\n", "// How long the delegation identity should remain valid?\n// e.g. BigInt(7 * 24 * 60 * 60 * 1000 * 1000 * 1000) = 7 days in nanoseconds\n// For Juno: 4 hours\nexport const DELEGATION_IDENTITY_EXPIRATION = BigInt(4 * 60 * 60 * 1000 * 1000 * 1000);\n\nexport const II_POPUP: {width: number; height: number} = {width: 576, height: 576};\nexport const NFID_POPUP: {width: number; height: number} = {width: 505, height: 705};\n\nexport const INTERNET_COMPUTER_ORG = 'internetcomputer.org';\n\n// Worker\nexport const AUTH_TIMER_INTERVAL = 1000;\n", "import type {Environment} from '../types/env.types';\nimport {Store} from './store';\n\nexport class EnvStore extends Store<Environment | undefined> {\n  private static instance: EnvStore;\n\n  private env: Environment | undefined;\n\n  private constructor() {\n    super();\n  }\n\n  static getInstance() {\n    if (!EnvStore.instance) {\n      EnvStore.instance = new EnvStore();\n    }\n    return EnvStore.instance;\n  }\n\n  set(env: Environment | undefined) {\n    this.env = env;\n\n    this.populate(env);\n  }\n\n  get(): Environment | undefined {\n    return this.env;\n  }\n\n  localIdentity(): boolean {\n    return this.get()?.localIdentityCanisterId !== undefined;\n  }\n\n  override subscribe(callback: (data: Environment | null | undefined) => void): () => void {\n    const unsubscribe: () => void = super.subscribe(callback);\n\n    callback(this.env);\n\n    return unsubscribe;\n  }\n}\n", "import {EnvStore} from '../stores/env.store';\n\nexport const isBrowser = () => typeof window !== `undefined`;\n\nexport const satelliteUrl = (): string => {\n  const satelliteId: string = EnvStore.getInstance().get()?.satelliteId ?? 'unknown';\n\n  if (EnvStore.getInstance().localIdentity()) {\n    return `http://${satelliteId}.localhost:8000`;\n  }\n\n  return `https://${satelliteId}.icp0.io`;\n};\n", "import {isNullish} from '@junobuild/utils';\nimport {isBrowser} from './env.utils';\n\nexport const popupCenter = ({\n  width,\n  height\n}: {\n  width: number;\n  height: number;\n}): string | undefined => {\n  if (!isBrowser()) {\n    return undefined;\n  }\n\n  if (isNullish(window) || isNullish(window.top)) {\n    return undefined;\n  }\n\n  const {\n    top: {innerWidth, innerHeight}\n  } = window;\n\n  const y = innerHeight / 2 + screenY - height / 2;\n  const x = innerWidth / 2 + screenX - width / 2;\n\n  return `toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=no, copyhistory=no, width=${width}, height=${height}, top=${y}, left=${x}`;\n};\n", "import {II_POPUP, INTERNET_COMPUTER_ORG, NFID_POPUP} from '../constants/auth.constants';\nimport {EnvStore} from '../stores/env.store';\nimport type {Provider, SignInOptions} from '../types/auth.types';\nimport {popupCenter} from '../utils/window.utils';\n\nexport interface AuthProvider {\n  readonly id: Provider;\n  signInOptions: (options: Pick<SignInOptions, 'windowed'>) => {\n    identityProvider: string;\n    windowOpenerFeatures?: string;\n  };\n}\n\nexport class InternetIdentityProvider implements AuthProvider {\n  #domain?: 'internetcomputer.org' | 'ic0.app';\n\n  constructor({domain}: {domain?: 'internetcomputer.org' | 'ic0.app'}) {\n    this.#domain = domain;\n  }\n\n  get id(): Provider {\n    return 'internet_identity';\n  }\n\n  signInOptions({windowed}: Pick<SignInOptions, 'windowed'>): {\n    identityProvider: string;\n    windowOpenerFeatures?: string;\n  } {\n    const identityProvider = EnvStore.getInstance().localIdentity()\n      ? `http://${EnvStore.getInstance().get()?.localIdentityCanisterId}.localhost:8000`\n      : `https://identity.${this.#domain ?? INTERNET_COMPUTER_ORG}`;\n\n    return {\n      ...(windowed !== false && {\n        windowOpenerFeatures: popupCenter(II_POPUP)\n      }),\n      identityProvider\n    };\n  }\n}\n\nexport class NFIDProvider implements AuthProvider {\n  #appName: string;\n  #logoUrl: string;\n\n  constructor({appName, logoUrl}: {appName: string; logoUrl: string}) {\n    this.#appName = appName;\n    this.#logoUrl = logoUrl;\n  }\n\n  get id(): Provider {\n    return 'nfid';\n  }\n\n  signInOptions({windowed}: Pick<SignInOptions, 'windowed'>): {\n    identityProvider: string;\n    windowOpenerFeatures?: string;\n  } {\n    return {\n      ...(windowed !== false && {\n        windowOpenerFeatures: popupCenter(NFID_POPUP)\n      }),\n      identityProvider: `https://nfid.one/authenticate/?applicationName=${encodeURI(\n        this.#appName\n      )}&applicationLogo=${encodeURI(this.#logoUrl)}`\n    };\n  }\n}\n", "import { Buffer } from 'buffer/';\nimport {\n  Agent,\n  getDefaultAgent,\n  QueryResponseRejected,\n  QueryResponseStatus,\n  ReplicaRejectCode,\n  SubmitResponse,\n} from './agent';\nimport { AgentError } from './errors';\nimport { IDL } from '@dfinity/candid';\nimport { pollForResponse, PollStrategyFactory, strategy } from './polling';\nimport { Principal } from '@dfinity/principal';\nimport { RequestId } from './request_id';\nimport { toHex } from './utils/buffer';\nimport { CreateCertificateOptions } from './certificate';\nimport managementCanisterIdl from './canisters/management_idl';\nimport _SERVICE from './canisters/management_service';\n\nexport class ActorCallError extends AgentError {\n  constructor(\n    public readonly canisterId: Principal,\n    public readonly methodName: string,\n    public readonly type: 'query' | 'update',\n    public readonly props: Record<string, string>,\n  ) {\n    super(\n      [\n        `Call failed:`,\n        `  Canister: ${canisterId.toText()}`,\n        `  Method: ${methodName} (${type})`,\n        ...Object.getOwnPropertyNames(props).map(n => `  \"${n}\": ${JSON.stringify(props[n])}`),\n      ].join('\\n'),\n    );\n  }\n}\n\nexport class QueryCallRejectedError extends ActorCallError {\n  constructor(\n    canisterId: Principal,\n    methodName: string,\n    public readonly result: QueryResponseRejected,\n  ) {\n    super(canisterId, methodName, 'query', {\n      Status: result.status,\n      Code: ReplicaRejectCode[result.reject_code] ?? `Unknown Code \"${result.reject_code}\"`,\n      Message: result.reject_message,\n    });\n  }\n}\n\nexport class UpdateCallRejectedError extends ActorCallError {\n  constructor(\n    canisterId: Principal,\n    methodName: string,\n    public readonly requestId: RequestId,\n    public readonly response: SubmitResponse['response'],\n  ) {\n    super(canisterId, methodName, 'update', {\n      'Request ID': toHex(requestId),\n      'HTTP status code': response.status.toString(),\n      'HTTP status text': response.statusText,\n    });\n  }\n}\n\n/**\n * Configuration to make calls to the Replica.\n */\nexport interface CallConfig {\n  /**\n   * An agent to use in this call, otherwise the actor or call will try to discover the\n   * agent to use.\n   */\n  agent?: Agent;\n\n  /**\n   * A polling strategy factory that dictates how much and often we should poll the\n   * read_state endpoint to get the result of an update call.\n   */\n  pollingStrategyFactory?: PollStrategyFactory;\n\n  /**\n   * The canister ID of this Actor.\n   */\n  canisterId?: string | Principal;\n\n  /**\n   * The effective canister ID. This should almost always be ignored.\n   */\n  effectiveCanisterId?: Principal;\n}\n\n/**\n * Configuration that can be passed to customize the Actor behaviour.\n */\nexport interface ActorConfig extends CallConfig {\n  /**\n   * The Canister ID of this Actor. This is required for an Actor.\n   */\n  canisterId: string | Principal;\n\n  /**\n   * An override function for update calls' CallConfig. This will be called on every calls.\n   */\n  callTransform?(\n    methodName: string,\n    args: unknown[],\n    callConfig: CallConfig,\n  ): Partial<CallConfig> | void;\n\n  /**\n   * An override function for query calls' CallConfig. This will be called on every query.\n   */\n  queryTransform?(\n    methodName: string,\n    args: unknown[],\n    callConfig: CallConfig,\n  ): Partial<CallConfig> | void;\n\n  /**\n   * Polyfill for BLS Certificate verification in case wasm is not supported\n   */\n  blsVerify?: CreateCertificateOptions['blsVerify'];\n}\n\n// TODO: move this to proper typing when Candid support TypeScript.\n/**\n * A subclass of an actor. Actor class itself is meant to be a based class.\n */\nexport type ActorSubclass<T = Record<string, ActorMethod>> = Actor & T;\n\n/**\n * An actor method type, defined for each methods of the actor service.\n */\nexport interface ActorMethod<Args extends unknown[] = unknown[], Ret extends unknown = unknown> {\n  (...args: Args): Promise<Ret>;\n  withOptions(options: CallConfig): (...args: Args) => Promise<Ret>;\n}\n\n/**\n * The mode used when installing a canister.\n */\nexport enum CanisterInstallMode {\n  Install = 'install',\n  Reinstall = 'reinstall',\n  Upgrade = 'upgrade',\n}\n\n/**\n * Internal metadata for actors. It's an enhanced version of ActorConfig with\n * some fields marked as required (as they are defaulted) and canisterId as\n * a Principal type.\n */\ninterface ActorMetadata {\n  service: IDL.ServiceClass;\n  agent?: Agent;\n  config: ActorConfig;\n}\n\nconst metadataSymbol = Symbol.for('ic-agent-metadata');\n\n/**\n * An actor base class. An actor is an object containing only functions that will\n * return a promise. These functions are derived from the IDL definition.\n */\nexport class Actor {\n  /**\n   * Get the Agent class this Actor would call, or undefined if the Actor would use\n   * the default agent (global.ic.agent).\n   * @param actor The actor to get the agent of.\n   */\n  public static agentOf(actor: Actor): Agent | undefined {\n    return actor[metadataSymbol].config.agent;\n  }\n\n  /**\n   * Get the interface of an actor, in the form of an instance of a Service.\n   * @param actor The actor to get the interface of.\n   */\n  public static interfaceOf(actor: Actor): IDL.ServiceClass {\n    return actor[metadataSymbol].service;\n  }\n\n  public static canisterIdOf(actor: Actor): Principal {\n    return Principal.from(actor[metadataSymbol].config.canisterId);\n  }\n\n  public static async install(\n    fields: {\n      module: ArrayBuffer;\n      mode?: CanisterInstallMode;\n      arg?: ArrayBuffer;\n    },\n    config: ActorConfig,\n  ): Promise<void> {\n    const mode = fields.mode === undefined ? CanisterInstallMode.Install : fields.mode;\n    // Need to transform the arg into a number array.\n    const arg = fields.arg ? [...new Uint8Array(fields.arg)] : [];\n    // Same for module.\n    const wasmModule = [...new Uint8Array(fields.module)];\n    const canisterId =\n      typeof config.canisterId === 'string'\n        ? Principal.fromText(config.canisterId)\n        : config.canisterId;\n\n    await getManagementCanister(config).install_code({\n      mode: { [mode]: null } as any,\n      arg,\n      wasm_module: wasmModule,\n      canister_id: canisterId,\n    });\n  }\n\n  public static async createCanister(config?: CallConfig): Promise<Principal> {\n    const { canister_id: canisterId } = await getManagementCanister(\n      config || {},\n    ).provisional_create_canister_with_cycles({ amount: [], settings: [] });\n\n    return canisterId;\n  }\n\n  public static async createAndInstallCanister(\n    interfaceFactory: IDL.InterfaceFactory,\n    fields: {\n      module: ArrayBuffer;\n      arg?: ArrayBuffer;\n    },\n    config?: CallConfig,\n  ): Promise<ActorSubclass> {\n    const canisterId = await this.createCanister(config);\n    await this.install(\n      {\n        ...fields,\n      },\n      { ...config, canisterId },\n    );\n\n    return this.createActor(interfaceFactory, { ...config, canisterId });\n  }\n\n  public static createActorClass(interfaceFactory: IDL.InterfaceFactory): ActorConstructor {\n    const service = interfaceFactory({ IDL });\n\n    class CanisterActor extends Actor {\n      [x: string]: ActorMethod;\n\n      constructor(config: ActorConfig) {\n        const canisterId =\n          typeof config.canisterId === 'string'\n            ? Principal.fromText(config.canisterId)\n            : config.canisterId;\n\n        super({\n          config: {\n            ...DEFAULT_ACTOR_CONFIG,\n            ...config,\n            canisterId,\n          },\n          service,\n        });\n\n        for (const [methodName, func] of service._fields) {\n          this[methodName] = _createActorMethod(this, methodName, func, config.blsVerify);\n        }\n      }\n    }\n\n    return CanisterActor;\n  }\n\n  public static createActor<T = Record<string, ActorMethod>>(\n    interfaceFactory: IDL.InterfaceFactory,\n    configuration: ActorConfig,\n  ): ActorSubclass<T> {\n    return new (this.createActorClass(interfaceFactory))(\n      configuration,\n    ) as unknown as ActorSubclass<T>;\n  }\n\n  private [metadataSymbol]: ActorMetadata;\n\n  protected constructor(metadata: ActorMetadata) {\n    this[metadataSymbol] = Object.freeze(metadata);\n  }\n}\n\n// IDL functions can have multiple return values, so decoding always\n// produces an array. Ensure that functions with single or zero return\n// values behave as expected.\nfunction decodeReturnValue(types: IDL.Type[], msg: ArrayBuffer) {\n  const returnValues = IDL.decode(types, Buffer.from(msg));\n  switch (returnValues.length) {\n    case 0:\n      return undefined;\n    case 1:\n      return returnValues[0];\n    default:\n      return returnValues;\n  }\n}\n\nconst DEFAULT_ACTOR_CONFIG = {\n  pollingStrategyFactory: strategy.defaultStrategy,\n};\n\nexport type ActorConstructor = new (config: ActorConfig) => ActorSubclass;\n\nfunction _createActorMethod(\n  actor: Actor,\n  methodName: string,\n  func: IDL.FuncClass,\n  blsVerify?: CreateCertificateOptions['blsVerify'],\n): ActorMethod {\n  let caller: (options: CallConfig, ...args: unknown[]) => Promise<unknown>;\n  if (func.annotations.includes('query')) {\n    caller = async (options, ...args) => {\n      // First, if there's a config transformation, call it.\n      options = {\n        ...options,\n        ...actor[metadataSymbol].config.queryTransform?.(methodName, args, {\n          ...actor[metadataSymbol].config,\n          ...options,\n        }),\n      };\n\n      const agent = options.agent || actor[metadataSymbol].config.agent || getDefaultAgent();\n      const cid = Principal.from(options.canisterId || actor[metadataSymbol].config.canisterId);\n      const arg = IDL.encode(func.argTypes, args);\n\n      const result = await agent.query(cid, { methodName, arg });\n\n      switch (result.status) {\n        case QueryResponseStatus.Rejected:\n          throw new QueryCallRejectedError(cid, methodName, result);\n\n        case QueryResponseStatus.Replied:\n          return decodeReturnValue(func.retTypes, result.reply.arg);\n      }\n    };\n  } else {\n    caller = async (options, ...args) => {\n      // First, if there's a config transformation, call it.\n      options = {\n        ...options,\n        ...actor[metadataSymbol].config.callTransform?.(methodName, args, {\n          ...actor[metadataSymbol].config,\n          ...options,\n        }),\n      };\n\n      const agent = options.agent || actor[metadataSymbol].config.agent || getDefaultAgent();\n      const { canisterId, effectiveCanisterId, pollingStrategyFactory } = {\n        ...DEFAULT_ACTOR_CONFIG,\n        ...actor[metadataSymbol].config,\n        ...options,\n      };\n      const cid = Principal.from(canisterId);\n      const ecid = effectiveCanisterId !== undefined ? Principal.from(effectiveCanisterId) : cid;\n      const arg = IDL.encode(func.argTypes, args);\n      const { requestId, response } = await agent.call(cid, {\n        methodName,\n        arg,\n        effectiveCanisterId: ecid,\n      });\n\n      if (!response.ok) {\n        throw new UpdateCallRejectedError(cid, methodName, requestId, response);\n      }\n\n      const pollStrategy = pollingStrategyFactory();\n      const responseBytes = await pollForResponse(agent, ecid, requestId, pollStrategy, blsVerify);\n\n      if (responseBytes !== undefined) {\n        return decodeReturnValue(func.retTypes, responseBytes);\n      } else if (func.retTypes.length === 0) {\n        return undefined;\n      } else {\n        throw new Error(`Call was returned undefined, but type [${func.retTypes.join(',')}].`);\n      }\n    };\n  }\n\n  const handler = (...args: unknown[]) => caller({}, ...args);\n  handler.withOptions =\n    (options: CallConfig) =>\n    (...args: unknown[]) =>\n      caller(options, ...args);\n  return handler as ActorMethod;\n}\n\nexport type ManagementCanisterRecord = _SERVICE;\n\n/**\n * Create a management canister actor\n * @param config\n */\nexport function getManagementCanister(config: CallConfig): ActorSubclass<ManagementCanisterRecord> {\n  function transform(_methodName: string, args: unknown[], _callConfig: CallConfig) {\n    const first = args[0] as any;\n    let effectiveCanisterId = Principal.fromHex('');\n    if (first && typeof first === 'object' && first.canister_id) {\n      effectiveCanisterId = Principal.from(first.canister_id as unknown);\n    }\n    return { effectiveCanisterId };\n  }\n\n  return Actor.createActor<ManagementCanisterRecord>(managementCanisterIdl, {\n    ...config,\n    canisterId: Principal.fromHex(''),\n    ...{\n      callTransform: transform,\n      queryTransform: transform,\n    },\n  });\n}\n", "import { Principal } from '@dfinity/principal';\nimport { RequestId } from '../request_id';\nimport { JsonObject } from '@dfinity/candid';\nimport { Identity } from '../auth';\n\n/**\n * Codes used by the replica for rejecting a message.\n * See {@link https://sdk.dfinity.org/docs/interface-spec/#reject-codes | the interface spec}.\n */\nexport enum ReplicaRejectCode {\n  SysFatal = 1,\n  SysTransient = 2,\n  DestinationInvalid = 3,\n  CanisterReject = 4,\n  CanisterError = 5,\n}\n\n/**\n * Options when doing a {@link Agent.readState} call.\n */\nexport interface ReadStateOptions {\n  /**\n   * A list of paths to read the state of.\n   */\n  paths: ArrayBuffer[][];\n}\n\n/**\n *\n */\nexport type QueryResponse = QueryResponseReplied | QueryResponseRejected;\n\nexport const enum QueryResponseStatus {\n  Replied = 'replied',\n  Rejected = 'rejected',\n}\n\nexport interface QueryResponseBase {\n  status: QueryResponseStatus;\n}\n\nexport interface QueryResponseReplied extends QueryResponseBase {\n  status: QueryResponseStatus.Replied;\n  reply: { arg: ArrayBuffer };\n}\n\nexport interface QueryResponseRejected extends QueryResponseBase {\n  status: QueryResponseStatus.Rejected;\n  reject_code: ReplicaRejectCode;\n  reject_message: string;\n}\n\n/**\n * Options when doing a {@link Agent.query} call.\n */\nexport interface QueryFields {\n  /**\n   * The method name to call.\n   */\n  methodName: string;\n\n  /**\n   * A binary encoded argument. This is already encoded and will be sent as is.\n   */\n  arg: ArrayBuffer;\n}\n\n/**\n * Options when doing a {@link Agent.call} call.\n */\nexport interface CallOptions {\n  /**\n   * The method name to call.\n   */\n  methodName: string;\n\n  /**\n   * A binary encoded argument. This is already encoded and will be sent as is.\n   */\n  arg: ArrayBuffer;\n\n  /**\n   * An effective canister ID, used for routing. This should only be mentioned if\n   * it's different from the canister ID.\n   */\n  effectiveCanisterId: Principal | string;\n}\n\nexport interface ReadStateResponse {\n  certificate: ArrayBuffer;\n}\n\nexport interface SubmitResponse {\n  requestId: RequestId;\n  response: {\n    ok: boolean;\n    status: number;\n    statusText: string;\n  };\n}\n\n/**\n * An Agent able to make calls and queries to a Replica.\n */\nexport interface Agent {\n  readonly rootKey: ArrayBuffer | null;\n  /**\n   * Returns the principal ID associated with this agent (by default). It only shows\n   * the principal of the default identity in the agent, which is the principal used\n   * when calls don't specify it.\n   */\n  getPrincipal(): Promise<Principal>;\n\n  /**\n   * Create the request for the read state call.\n   * `readState` uses this internally.\n   * Useful to avoid signing the same request multiple times.\n   */\n  createReadStateRequest?(\n    options: ReadStateOptions,\n    identity?: Identity,\n    // eslint-disable-next-line  @typescript-eslint/no-explicit-any\n  ): Promise<any>;\n\n  /**\n   * Send a read state query to the replica. This includes a list of paths to return,\n   * and will return a Certificate. This will only reject on communication errors,\n   * but the certificate might contain less information than requested.\n   * @param effectiveCanisterId A Canister ID related to this call.\n   * @param options The options for this call.\n   * @param identity Identity for the call. If not specified, uses the instance identity.\n   * @param request The request to send in case it has already been created.\n   */\n  readState(\n    effectiveCanisterId: Principal | string,\n    options: ReadStateOptions,\n    identity?: Identity,\n    // eslint-disable-next-line  @typescript-eslint/no-explicit-any\n    request?: any,\n  ): Promise<ReadStateResponse>;\n\n  call(canisterId: Principal | string, fields: CallOptions): Promise<SubmitResponse>;\n\n  /**\n   * Query the status endpoint of the replica. This normally has a few fields that\n   * corresponds to the version of the replica, its root public key, and any other\n   * information made public.\n   * @returns A JsonObject that is essentially a record of fields from the status\n   *     endpoint.\n   */\n  status(): Promise<JsonObject>;\n\n  /**\n   * Send a query call to a canister. See\n   * {@link https://sdk.dfinity.org/docs/interface-spec/#http-query | the interface spec}.\n   * @param canisterId The Principal of the Canister to send the query to. Sending a query to\n   *     the management canister is not supported (as it has no meaning from an agent).\n   * @param options Options to use to create and send the query.\n   * @returns The response from the replica. The Promise will only reject when the communication\n   *     failed. If the query itself failed but no protocol errors happened, the response will\n   *     be of type QueryResponseRejected.\n   */\n  query(canisterId: Principal | string, options: QueryFields): Promise<QueryResponse>;\n\n  /**\n   * By default, the agent is configured to talk to the main Internet Computer,\n   * and verifies responses using a hard-coded public key.\n   *\n   * This function will instruct the agent to ask the endpoint for its public\n   * key, and use that instead. This is required when talking to a local test\n   * instance, for example.\n   *\n   * Only use this when you are  _not_ talking to the main Internet Computer,\n   * otherwise you are prone to man-in-the-middle attacks! Do not call this\n   * function by default.\n   */\n  fetchRootKey(): Promise<ArrayBuffer>;\n  /**\n   * If an application needs to invalidate an identity under certain conditions, an `Agent` may expose an `invalidateIdentity` method.\n   * Invoking this method will set the inner identity used by the `Agent` to `null`.\n   *\n   * A use case for this would be - after a certain period of inactivity, a secure application chooses to invalidate the identity of any `HttpAgent` instances. An invalid identity can be replaced by `Agent.replaceIdentity`\n   */\n  invalidateIdentity?(): void;\n  /**\n   * If an application needs to replace an identity under certain conditions, an `Agent` may expose a `replaceIdentity` method.\n   * Invoking this method will set the inner identity used by the `Agent` to a newly provided identity.\n   *\n   * A use case for this would be - after authenticating using `@dfinity/auth-client`, you can replace the `AnonymousIdentity` of your `Actor` with a `DelegationIdentity`.\n   *\n   * ```Actor.agentOf(defaultActor).replaceIdentity(await authClient.getIdentity());```\n   */\n  replaceIdentity?(identity: Identity): void;\n}\n", "import { Principal } from '@dfinity/principal';\nimport { HttpAgentRequest } from './agent/http/types';\nimport { requestIdOf } from './request_id';\nimport { concat, toHex } from './utils/buffer';\n\nconst domainSeparator = new TextEncoder().encode('\\x0Aic-request');\n\n/**\n * A Key Pair, containing a secret and public key.\n */\nexport interface KeyPair {\n  secretKey: ArrayBuffer;\n  publicKey: PublicKey;\n}\n\n/**\n * A public key that is DER encoded. This is a branded ArrayBuffer.\n */\nexport type DerEncodedPublicKey = ArrayBuffer & { __derEncodedPublicKey__?: void };\n\n/**\n * A signature array buffer.\n */\nexport type Signature = ArrayBuffer & { __signature__: void };\n\n/**\n * A Public Key implementation.\n */\nexport interface PublicKey {\n  // Get the public key bytes encoded with DER.\n  toDer(): DerEncodedPublicKey;\n}\n\n/**\n * A General Identity object. This does not have to be a private key (for example,\n * the Anonymous identity), but it must be able to transform request.\n */\nexport interface Identity {\n  /**\n   * Get the principal represented by this identity. Normally should be a\n   * `Principal.selfAuthenticating()`.\n   */\n  getPrincipal(): Principal;\n\n  /**\n   * Transform a request into a signed version of the request. This is done last\n   * after the transforms on the body of a request. The returned object can be\n   * anything, but must be serializable to CBOR.\n   */\n  transformRequest(request: HttpAgentRequest): Promise<unknown>;\n}\n\n/**\n * An Identity that can sign blobs.\n */\nexport abstract class SignIdentity implements Identity {\n  protected _principal: Principal | undefined;\n\n  /**\n   * Returns the public key that would match this identity's signature.\n   */\n  public abstract getPublicKey(): PublicKey;\n\n  /**\n   * Signs a blob of data, with this identity's private key.\n   */\n  public abstract sign(blob: ArrayBuffer): Promise<Signature>;\n\n  /**\n   * Get the principal represented by this identity. Normally should be a\n   * `Principal.selfAuthenticating()`.\n   */\n  public getPrincipal(): Principal {\n    if (!this._principal) {\n      this._principal = Principal.selfAuthenticating(new Uint8Array(this.getPublicKey().toDer()));\n    }\n    return this._principal;\n  }\n\n  /**\n   * Transform a request into a signed version of the request. This is done last\n   * after the transforms on the body of a request. The returned object can be\n   * anything, but must be serializable to CBOR.\n   * @param request - internet computer request to transform\n   */\n  public async transformRequest(request: HttpAgentRequest): Promise<unknown> {\n    const { body, ...fields } = request;\n    const requestId = await requestIdOf(body);\n    return {\n      ...fields,\n      body: {\n        content: body,\n        sender_pubkey: this.getPublicKey().toDer(),\n        sender_sig: await this.sign(concat(domainSeparator, requestId)),\n      },\n    };\n  }\n}\n\nexport class AnonymousIdentity implements Identity {\n  public getPrincipal(): Principal {\n    return Principal.anonymous();\n  }\n\n  public async transformRequest(request: HttpAgentRequest): Promise<unknown> {\n    return {\n      ...request,\n      body: { content: request.body },\n    };\n  }\n}\n\n/*\n * We need to communicate with other agents on the page about identities,\n * but those messages may need to go across boundaries where it's not possible to\n * serialize/deserialize object prototypes easily.\n * So these are lightweight, serializable objects that contain enough information to recreate\n * SignIdentities, but don't commit to having all methods of SignIdentity.\n *\n * Use Case:\n * * DOM Events that let differently-versioned components communicate to one another about\n *   Identities, even if they're using slightly different versions of agent packages to\n *   create/interpret them.\n */\nexport interface AnonymousIdentityDescriptor {\n  type: 'AnonymousIdentity';\n}\nexport interface PublicKeyIdentityDescriptor {\n  type: 'PublicKeyIdentity';\n  publicKey: string;\n}\nexport type IdentityDescriptor = AnonymousIdentityDescriptor | PublicKeyIdentityDescriptor;\n\n/**\n * Create an IdentityDescriptor from a @dfinity/identity Identity\n * @param identity - identity describe in returned descriptor\n */\nexport function createIdentityDescriptor(\n  identity: SignIdentity | AnonymousIdentity,\n): IdentityDescriptor {\n  const identityIndicator: IdentityDescriptor =\n    'getPublicKey' in identity\n      ? { type: 'PublicKeyIdentity', publicKey: toHex(identity.getPublicKey().toDer()) }\n      : { type: 'AnonymousIdentity' };\n  return identityIndicator;\n}\n", "import { lebEncode } from '@dfinity/candid';\nimport * as cbor from 'simple-cbor';\nimport { Endpoint, HttpAgentRequest, HttpAgentRequestTransformFn, makeNonce, Nonce } from './types';\nimport { toHex } from '../../utils/buffer';\n\nconst NANOSECONDS_PER_MILLISECONDS = BigInt(1_000_000);\n\nconst REPLICA_PERMITTED_DRIFT_MILLISECONDS = BigInt(60 * 1000);\n\nexport class Expiry {\n  private readonly _value: bigint;\n\n  constructor(deltaInMSec: number) {\n    // Use bigint because it can overflow the maximum number allowed in a double float.\n    this._value =\n      (BigInt(Date.now()) + BigInt(deltaInMSec) - REPLICA_PERMITTED_DRIFT_MILLISECONDS) *\n      NANOSECONDS_PER_MILLISECONDS;\n  }\n\n  public toCBOR(): cbor.CborValue {\n    // TODO: change this to take the minimum amount of space (it always takes 8 bytes now).\n    return cbor.value.u64(this._value.toString(16), 16);\n  }\n\n  public toHash(): ArrayBuffer {\n    return lebEncode(this._value);\n  }\n}\n\n/**\n * Create a Nonce transform, which takes a function that returns a Buffer, and adds it\n * as the nonce to every call requests.\n * @param nonceFn A function that returns a buffer. By default uses a semi-random method.\n */\nexport function makeNonceTransform(nonceFn: () => Nonce = makeNonce): HttpAgentRequestTransformFn {\n  return async (request: HttpAgentRequest) => {\n    const nonce = nonceFn();\n    // Nonce needs to be inserted into the header for all requests, to enable logs to be correlated with requests.\n    const headers = request.request.headers ? new Headers(request.request.headers) : new Headers();\n    // TODO: uncomment this when the http proxy supports it.\n    // headers.set('X-IC-Request-ID', toHex(new Uint8Array(nonce)));\n    request.request.headers = headers;\n\n    // Nonce only needs to be inserted into the body for async calls, to prevent replay attacks.\n    if (request.endpoint === Endpoint.Call) {\n      request.body.nonce = nonceFn();\n    }\n  };\n}\n\n/**\n * Create a transform that adds a delay (by default 5 minutes) to the expiry.\n *\n * @param delayInMilliseconds The delay to add to the call time, in milliseconds.\n */\nexport function makeExpiryTransform(delayInMilliseconds: number): HttpAgentRequestTransformFn {\n  return async (request: HttpAgentRequest) => {\n    request.body.ingress_expiry = new Expiry(delayInMilliseconds);\n  };\n}\n", "import type { Principal } from '@dfinity/principal';\nimport { Expiry } from './transforms';\nimport { lebEncode } from '@dfinity/candid';\n\n/**\n * @internal\n */\nexport const enum Endpoint {\n  Query = 'read',\n  ReadState = 'read_state',\n  Call = 'call',\n}\n\n// An HttpAgent request, before it gets encoded and sent to the server.\n// We create an empty request that we will fill later.\nexport type HttpAgentRequest =\n  | HttpAgentQueryRequest\n  | HttpAgentSubmitRequest\n  | HttpAgentReadStateRequest;\n\nexport interface HttpAgentBaseRequest {\n  readonly endpoint: Endpoint;\n  request: RequestInit;\n}\n\nexport interface HttpAgentSubmitRequest extends HttpAgentBaseRequest {\n  readonly endpoint: Endpoint.Call;\n  body: CallRequest;\n}\n\nexport interface HttpAgentQueryRequest extends HttpAgentBaseRequest {\n  readonly endpoint: Endpoint.Query;\n  body: ReadRequest;\n}\n\nexport interface HttpAgentReadStateRequest extends HttpAgentBaseRequest {\n  readonly endpoint: Endpoint.ReadState;\n  body: ReadRequest;\n}\n\nexport interface Signed<T> {\n  content: T;\n  sender_pubkey: ArrayBuffer;\n  sender_sig: ArrayBuffer;\n}\n\nexport interface UnSigned<T> {\n  content: T;\n}\n\nexport type Envelope<T> = Signed<T> | UnSigned<T>;\n\nexport interface HttpAgentRequestTransformFn {\n  (args: HttpAgentRequest): Promise<HttpAgentRequest | undefined | void>;\n  priority?: number;\n}\n\n// The fields in a \"call\" submit request.\n// tslint:disable:camel-case\nexport interface CallRequest extends Record<string, any> {\n  request_type: SubmitRequestType.Call;\n  canister_id: Principal;\n  method_name: string;\n  arg: ArrayBuffer;\n  sender: Uint8Array | Principal;\n  ingress_expiry: Expiry;\n}\n// tslint:enable:camel-case\n\n// The types of values allowed in the `request_type` field for submit requests.\nexport enum SubmitRequestType {\n  Call = 'call',\n}\n\n// The types of values allowed in the `request_type` field for read requests.\nexport const enum ReadRequestType {\n  Query = 'query',\n  ReadState = 'read_state',\n}\n\n// The fields in a \"query\" read request.\nexport interface QueryRequest extends Record<string, any> {\n  request_type: ReadRequestType.Query;\n  canister_id: Principal;\n  method_name: string;\n  arg: ArrayBuffer;\n  sender: Uint8Array | Principal;\n  ingress_expiry: Expiry;\n}\n\nexport interface ReadStateRequest extends Record<string, any> {\n  request_type: ReadRequestType.ReadState;\n  paths: ArrayBuffer[][];\n  ingress_expiry: Expiry;\n  sender: Uint8Array | Principal;\n}\n\nexport type ReadRequest = QueryRequest | ReadStateRequest;\n\n// A Nonce that can be used for calls.\nexport type Nonce = Uint8Array & { __nonce__: void };\n\n/**\n * Create a random Nonce, based on date and a random suffix.\n */\nexport function makeNonce(): Nonce {\n  // Encode 128 bits.\n  const buffer = new ArrayBuffer(16);\n  const view = new DataView(buffer);\n  const now = BigInt(+Date.now());\n  const randHi = Math.floor(Math.random() * 0xffffffff);\n  const randLo = Math.floor(Math.random() * 0xffffffff);\n  // Fix for IOS < 14.8 setBigUint64 absence\n  if (typeof view.setBigUint64 === 'function') {\n    view.setBigUint64(0, now);\n  } else {\n    const TWO_TO_THE_32 = BigInt(1) << BigInt(32);\n    view.setUint32(0, Number(now >> BigInt(32)));\n    view.setUint32(4, Number(now % TWO_TO_THE_32));\n  }\n  view.setUint32(8, randHi);\n  view.setUint32(12, randLo);\n\n  return buffer as Nonce;\n}\n", "import { JsonObject } from '@dfinity/candid';\nimport { Principal } from '@dfinity/principal';\nimport { AgentError } from '../../errors';\nimport { AnonymousIdentity, Identity } from '../../auth';\nimport * as cbor from '../../cbor';\nimport { RequestId, requestIdOf } from '../../request_id';\nimport { fromHex } from '../../utils/buffer';\nimport {\n  Agent,\n  QueryFields,\n  QueryResponse,\n  ReadStateOptions,\n  ReadStateResponse,\n  SubmitResponse,\n} from '../api';\nimport { Expiry, makeNonceTransform } from './transforms';\nimport {\n  CallRequest,\n  Endpoint,\n  HttpAgentRequest,\n  HttpAgentRequestTransformFn,\n  HttpAgentSubmitRequest,\n  makeNonce,\n  QueryRequest,\n  ReadRequestType,\n  SubmitRequestType,\n} from './types';\n\nexport * from './transforms';\nexport { Nonce, makeNonce } from './types';\n\nexport enum RequestStatusResponseStatus {\n  Received = 'received',\n  Processing = 'processing',\n  Replied = 'replied',\n  Rejected = 'rejected',\n  Unknown = 'unknown',\n  Done = 'done',\n}\n\n// Default delta for ingress expiry is 5 minutes.\nconst DEFAULT_INGRESS_EXPIRY_DELTA_IN_MSECS = 5 * 60 * 1000;\n\n// Root public key for the IC, encoded as hex\nconst IC_ROOT_KEY =\n  '308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814' +\n  'c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d968' +\n  '5f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484' +\n  'b01291091c5f87b98883463f98091a0baaae';\n\n// IC0 domain info\nconst IC0_DOMAIN = 'ic0.app';\nconst IC0_SUB_DOMAIN = '.ic0.app';\n\nconst ICP0_DOMAIN = 'icp0.io';\nconst ICP0_SUB_DOMAIN = '.icp0.io';\n\nconst ICP_API_DOMAIN = 'icp-api.io';\nconst ICP_API_SUB_DOMAIN = '.icp-api.io';\n\nclass HttpDefaultFetchError extends AgentError {\n  constructor(public readonly message: string) {\n    super(message);\n  }\n}\nexport class IdentityInvalidError extends AgentError {\n  constructor(public readonly message: string) {\n    super(message);\n  }\n}\n\n// HttpAgent options that can be used at construction.\nexport interface HttpAgentOptions {\n  // Another HttpAgent to inherit configuration (pipeline and fetch) of. This\n  // is only used at construction.\n  source?: HttpAgent;\n\n  // A surrogate to the global fetch function. Useful for testing.\n  fetch?: typeof fetch;\n\n  // Additional options to pass along to fetch. Will not override fields that\n  // the agent already needs to set\n  // Should follow the RequestInit interface, but we intentially support non-standard fields\n  fetchOptions?: Record<string, unknown>;\n\n  // Additional options to pass along to fetch for the call API.\n  callOptions?: Record<string, unknown>;\n\n  // The host to use for the client. By default, uses the same host as\n  // the current page.\n  host?: string;\n\n  // The principal used to send messages. This cannot be empty at the request\n  // time (will throw).\n  identity?: Identity | Promise<Identity>;\n\n  credentials?: {\n    name: string;\n    password?: string;\n  };\n  /**\n   * Prevents the agent from providing a unique {@link Nonce} with each call.\n   * Enabling may cause rate limiting of identical requests\n   * at the boundary nodes.\n   *\n   * To add your own nonce generation logic, you can use the following:\n   * @example\n   * import {makeNonceTransform, makeNonce} from '@dfinity/agent';\n   * const agent = new HttpAgent({ disableNonce: true });\n   * agent.addTransform(makeNonceTransform(makeNonce);\n   * @default false\n   */\n  disableNonce?: boolean;\n  /**\n   * Number of times to retry requests before throwing an error\n   * @default 3\n   */\n  retryTimes?: number;\n}\n\nfunction getDefaultFetch(): typeof fetch {\n  let defaultFetch;\n\n  if (typeof window !== 'undefined') {\n    // Browser context\n    if (window.fetch) {\n      defaultFetch = window.fetch.bind(window);\n    } else {\n      throw new HttpDefaultFetchError(\n        'Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present.',\n      );\n    }\n  } else if (typeof global !== 'undefined') {\n    // Node context\n    if (global.fetch) {\n      defaultFetch = global.fetch.bind(global);\n    } else {\n      throw new HttpDefaultFetchError(\n        'Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available.',\n      );\n    }\n  } else if (typeof self !== 'undefined') {\n    if (self.fetch) {\n      defaultFetch = self.fetch.bind(self);\n    }\n  }\n\n  if (defaultFetch) {\n    return defaultFetch;\n  }\n  throw new HttpDefaultFetchError(\n    'Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context.',\n  );\n}\n\ntype _RequestResponse = {\n  requestId: RequestId;\n  response: {\n    ok: Response['ok'];\n    status: Response['status'];\n    statusText: Response['statusText'];\n  };\n};\n\n// A HTTP agent allows users to interact with a client of the internet computer\n// using the available methods. It exposes an API that closely follows the\n// public view of the internet computer, and is not intended to be exposed\n// directly to the majority of users due to its low-level interface.\n//\n// There is a pipeline to apply transformations to the request before sending\n// it to the client. This is to decouple signature, nonce generation and\n// other computations so that this class can stay as simple as possible while\n// allowing extensions.\nexport class HttpAgent implements Agent {\n  public rootKey = fromHex(IC_ROOT_KEY);\n  private readonly _pipeline: HttpAgentRequestTransformFn[] = [];\n  private _identity: Promise<Identity> | null;\n  private readonly _fetch: typeof fetch;\n  private readonly _fetchOptions?: Record<string, unknown>;\n  private readonly _callOptions?: Record<string, unknown>;\n  private _timeDiffMsecs = 0;\n  private readonly _host: URL;\n  private readonly _credentials: string | undefined;\n  private _rootKeyFetched = false;\n  private _retryTimes = 3; // Retry requests 3 times before erroring by default\n  public readonly _isAgent = true;\n\n  constructor(options: HttpAgentOptions = {}) {\n    if (options.source) {\n      if (!(options.source instanceof HttpAgent)) {\n        throw new Error(\"An Agent's source can only be another HttpAgent\");\n      }\n      this._pipeline = [...options.source._pipeline];\n      this._identity = options.source._identity;\n      this._fetch = options.source._fetch;\n      this._host = options.source._host;\n      this._credentials = options.source._credentials;\n    } else {\n      this._fetch = options.fetch || getDefaultFetch() || fetch.bind(global);\n      this._fetchOptions = options.fetchOptions;\n      this._callOptions = options.callOptions;\n    }\n    if (options.host !== undefined) {\n      if (!options.host.match(/^[a-z]+:/) && typeof window !== 'undefined') {\n        this._host = new URL(window.location.protocol + '//' + options.host);\n      } else {\n        this._host = new URL(options.host);\n      }\n    } else if (options.source !== undefined) {\n      // Safe to ignore here.\n      this._host = options.source._host;\n    } else {\n      const location = typeof window !== 'undefined' ? window.location : undefined;\n      if (!location) {\n        throw new Error('Must specify a host to connect to.');\n      }\n      this._host = new URL(location + '');\n    }\n    // Default is 3, only set if option is provided\n    if (options.retryTimes !== undefined) {\n      this._retryTimes = options.retryTimes;\n    }\n    // Rewrite to avoid redirects\n    if (this._host.hostname.endsWith(IC0_SUB_DOMAIN)) {\n      this._host.hostname = IC0_DOMAIN;\n    } else if (this._host.hostname.endsWith(ICP0_SUB_DOMAIN)) {\n      this._host.hostname = ICP0_DOMAIN;\n    } else if (this._host.hostname.endsWith(ICP_API_SUB_DOMAIN)) {\n      this._host.hostname = ICP_API_DOMAIN;\n    }\n\n    if (options.credentials) {\n      const { name, password } = options.credentials;\n      this._credentials = `${name}${password ? ':' + password : ''}`;\n    }\n    this._identity = Promise.resolve(options.identity || new AnonymousIdentity());\n\n    // Add a nonce transform to ensure calls are unique\n    if (!options.disableNonce) {\n      this.addTransform(makeNonceTransform(makeNonce));\n    }\n  }\n\n  public isLocal(): boolean {\n    const hostname = this._host.hostname;\n    return hostname === '127.0.0.1' || hostname.endsWith('localhost');\n  }\n\n  public addTransform(fn: HttpAgentRequestTransformFn, priority = fn.priority || 0): void {\n    // Keep the pipeline sorted at all time, by priority.\n    const i = this._pipeline.findIndex(x => (x.priority || 0) < priority);\n    this._pipeline.splice(i >= 0 ? i : this._pipeline.length, 0, Object.assign(fn, { priority }));\n  }\n\n  public async getPrincipal(): Promise<Principal> {\n    if (!this._identity) {\n      throw new IdentityInvalidError(\n        \"This identity has expired due this application's security policy. Please refresh your authentication.\",\n      );\n    }\n    return (await this._identity).getPrincipal();\n  }\n\n  public async call(\n    canisterId: Principal | string,\n    options: {\n      methodName: string;\n      arg: ArrayBuffer;\n      effectiveCanisterId?: Principal | string;\n    },\n    identity?: Identity | Promise<Identity>,\n  ): Promise<SubmitResponse> {\n    const id = await (identity !== undefined ? await identity : await this._identity);\n    if (!id) {\n      throw new IdentityInvalidError(\n        \"This identity has expired due this application's security policy. Please refresh your authentication.\",\n      );\n    }\n    const canister = Principal.from(canisterId);\n    const ecid = options.effectiveCanisterId\n      ? Principal.from(options.effectiveCanisterId)\n      : canister;\n\n    const sender: Principal = id.getPrincipal() || Principal.anonymous();\n\n    let ingress_expiry = new Expiry(DEFAULT_INGRESS_EXPIRY_DELTA_IN_MSECS);\n\n    // If the value is off by more than 30 seconds, reconcile system time with the network\n    if (Math.abs(this._timeDiffMsecs) > 1_000 * 30) {\n      ingress_expiry = new Expiry(DEFAULT_INGRESS_EXPIRY_DELTA_IN_MSECS + this._timeDiffMsecs);\n    }\n\n    const submit: CallRequest = {\n      request_type: SubmitRequestType.Call,\n      canister_id: canister,\n      method_name: options.methodName,\n      arg: options.arg,\n      sender,\n      ingress_expiry,\n    };\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let transformedRequest: any = (await this._transform({\n      request: {\n        body: null,\n        method: 'POST',\n        headers: new Headers({\n          'Content-Type': 'application/cbor',\n          ...(this._credentials ? { Authorization: 'Basic ' + btoa(this._credentials) } : {}),\n        }),\n      },\n      endpoint: Endpoint.Call,\n      body: submit,\n    })) as HttpAgentSubmitRequest;\n\n    // Apply transform for identity.\n    transformedRequest = await id.transformRequest(transformedRequest);\n\n    const body = cbor.encode(transformedRequest.body);\n\n    // Run both in parallel. The fetch is quite expensive, so we have plenty of time to\n    // calculate the requestId locally.\n\n    const request = this._requestAndRetry(() =>\n      this._fetch('' + new URL(`/api/v2/canister/${ecid.toText()}/call`, this._host), {\n        ...this._callOptions,\n        ...transformedRequest.request,\n        body,\n      }),\n    );\n\n    const [response, requestId] = await Promise.all([request, requestIdOf(submit)]);\n\n    return {\n      requestId,\n      response: {\n        ok: response.ok,\n        status: response.status,\n        statusText: response.statusText,\n      },\n    };\n  }\n\n  private async _requestAndRetry(request: () => Promise<Response>, tries = 0): Promise<Response> {\n    if (tries > this._retryTimes && this._retryTimes !== 0) {\n      throw new Error(\n        `AgentError: Exceeded configured limit of ${this._retryTimes} retry attempts. Please check your network connection or try again in a few moments`,\n      );\n    }\n    const response = await request();\n    if (!response.ok) {\n      const responseText = await response.clone().text();\n      const errorMessage =\n        `Server returned an error:\\n` +\n        `  Code: ${response.status} (${response.statusText})\\n` +\n        `  Body: ${responseText}\\n`;\n      if (this._retryTimes > tries) {\n        console.warn(errorMessage + `  Retrying request.`);\n        return await this._requestAndRetry(request, tries + 1);\n      } else {\n        throw new Error(errorMessage);\n      }\n    }\n\n    return response;\n  }\n\n  public async query(\n    canisterId: Principal | string,\n    fields: QueryFields,\n    identity?: Identity | Promise<Identity>,\n  ): Promise<QueryResponse> {\n    const id = await (identity !== undefined ? await identity : await this._identity);\n    if (!id) {\n      throw new IdentityInvalidError(\n        \"This identity has expired due this application's security policy. Please refresh your authentication.\",\n      );\n    }\n\n    const canister = typeof canisterId === 'string' ? Principal.fromText(canisterId) : canisterId;\n    const sender = id?.getPrincipal() || Principal.anonymous();\n\n    const request: QueryRequest = {\n      request_type: ReadRequestType.Query,\n      canister_id: canister,\n      method_name: fields.methodName,\n      arg: fields.arg,\n      sender,\n      ingress_expiry: new Expiry(DEFAULT_INGRESS_EXPIRY_DELTA_IN_MSECS),\n    };\n\n    // TODO: remove this any. This can be a Signed or UnSigned request.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let transformedRequest: any = await this._transform({\n      request: {\n        method: 'POST',\n        headers: new Headers({\n          'Content-Type': 'application/cbor',\n          ...(this._credentials ? { Authorization: 'Basic ' + btoa(this._credentials) } : {}),\n        }),\n      },\n      endpoint: Endpoint.Query,\n      body: request,\n    });\n\n    // Apply transform for identity.\n    transformedRequest = await id?.transformRequest(transformedRequest);\n\n    const body = cbor.encode(transformedRequest.body);\n    const response = await this._requestAndRetry(() =>\n      this._fetch('' + new URL(`/api/v2/canister/${canister.toText()}/query`, this._host), {\n        ...this._fetchOptions,\n        ...transformedRequest.request,\n        body,\n      }),\n    );\n\n    return cbor.decode(await response.arrayBuffer());\n  }\n\n  public async createReadStateRequest(\n    fields: ReadStateOptions,\n    identity?: Identity | Promise<Identity>,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): Promise<any> {\n    const id = await (identity !== undefined ? await identity : await this._identity);\n    if (!id) {\n      throw new IdentityInvalidError(\n        \"This identity has expired due this application's security policy. Please refresh your authentication.\",\n      );\n    }\n    const sender = id?.getPrincipal() || Principal.anonymous();\n\n    // TODO: remove this any. This can be a Signed or UnSigned request.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const transformedRequest: any = await this._transform({\n      request: {\n        method: 'POST',\n        headers: new Headers({\n          'Content-Type': 'application/cbor',\n          ...(this._credentials ? { Authorization: 'Basic ' + btoa(this._credentials) } : {}),\n        }),\n      },\n      endpoint: Endpoint.ReadState,\n      body: {\n        request_type: ReadRequestType.ReadState,\n        paths: fields.paths,\n        sender,\n        ingress_expiry: new Expiry(DEFAULT_INGRESS_EXPIRY_DELTA_IN_MSECS),\n      },\n    });\n\n    // Apply transform for identity.\n    return id?.transformRequest(transformedRequest);\n  }\n\n  public async readState(\n    canisterId: Principal | string,\n    fields: ReadStateOptions,\n    identity?: Identity | Promise<Identity>,\n    // eslint-disable-next-line\n    request?: any,\n  ): Promise<ReadStateResponse> {\n    const canister = typeof canisterId === 'string' ? Principal.fromText(canisterId) : canisterId;\n\n    const transformedRequest = request ?? (await this.createReadStateRequest(fields, identity));\n    const body = cbor.encode(transformedRequest.body);\n\n    // TODO - https://dfinity.atlassian.net/browse/SDK-1092\n    const response = await this._requestAndRetry(() =>\n      this._fetch('' + new URL(`/api/v2/canister/${canister}/read_state`, this._host), {\n        ...this._fetchOptions,\n        ...transformedRequest.request,\n        body,\n      }),\n    );\n\n    if (!response.ok) {\n      throw new Error(\n        `Server returned an error:\\n` +\n          `  Code: ${response.status} (${response.statusText})\\n` +\n          `  Body: ${await response.text()}\\n`,\n      );\n    }\n    return cbor.decode(await response.arrayBuffer());\n  }\n\n  /**\n   * Allows agent to sync its time with the network. Can be called during intialization or mid-lifecycle if the device's clock has drifted away from the network time. This is necessary to set the Expiry for a request\n   * @param {PrincipalLike} canisterId - Pass a canister ID if you need to sync the time with a particular replica. Uses the management canister by default\n   */\n  public async syncTime(canisterId?: Principal): Promise<void> {\n    const CanisterStatus = await import('../../canisterStatus');\n    const callTime = Date.now();\n    try {\n      if (!canisterId) {\n        console.log(\n          'Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai',\n        );\n      }\n      const status = await CanisterStatus.request({\n        // Fall back with canisterId of the ICP Ledger\n        canisterId: canisterId ?? Principal.from('ryjl3-tyaaa-aaaaa-aaaba-cai'),\n        agent: this,\n        paths: ['time'],\n      });\n\n      const replicaTime = status.get('time');\n      if (replicaTime) {\n        this._timeDiffMsecs = Number(replicaTime as any) - Number(callTime);\n      }\n    } catch (error) {\n      console.error('Caught exception while attempting to sync time:', error);\n    }\n  }\n\n  public async status(): Promise<JsonObject> {\n    const headers: Record<string, string> = this._credentials\n      ? {\n          Authorization: 'Basic ' + btoa(this._credentials),\n        }\n      : {};\n\n    const response = await this._requestAndRetry(() =>\n      this._fetch('' + new URL(`/api/v2/status`, this._host), { headers, ...this._fetchOptions }),\n    );\n\n    return cbor.decode(await response.arrayBuffer());\n  }\n\n  public async fetchRootKey(): Promise<ArrayBuffer> {\n    if (!this._rootKeyFetched) {\n      // Hex-encoded version of the replica root key\n      this.rootKey = ((await this.status()) as any).root_key;\n      this._rootKeyFetched = true;\n    }\n    return this.rootKey;\n  }\n\n  public invalidateIdentity(): void {\n    this._identity = null;\n  }\n\n  public replaceIdentity(identity: Identity): void {\n    this._identity = Promise.resolve(identity);\n  }\n\n  protected _transform(request: HttpAgentRequest): Promise<HttpAgentRequest> {\n    let p = Promise.resolve(request);\n\n    for (const fn of this._pipeline) {\n      p = p.then(r => fn(r).then(r2 => r2 || r));\n    }\n\n    return p;\n  }\n}\n", "import { JsonObject } from '@dfinity/candid';\nimport {\n  Agent,\n  CallOptions,\n  QueryFields,\n  QueryResponse,\n  ReadStateOptions,\n  ReadStateResponse,\n  SubmitResponse,\n} from './api';\nimport { Principal } from '@dfinity/principal';\n\nexport enum ProxyMessageKind {\n  Error = 'err',\n  GetPrincipal = 'gp',\n  GetPrincipalResponse = 'gpr',\n  Query = 'q',\n  QueryResponse = 'qr',\n  Call = 'c',\n  CallResponse = 'cr',\n  ReadState = 'rs',\n  ReadStateResponse = 'rsr',\n  Status = 's',\n  StatusResponse = 'sr',\n}\n\nexport interface ProxyMessageBase {\n  id: number;\n  type: ProxyMessageKind;\n}\n\nexport interface ProxyMessageError extends ProxyMessageBase {\n  type: ProxyMessageKind.Error;\n  error: any;\n}\n\nexport interface ProxyMessageGetPrincipal extends ProxyMessageBase {\n  type: ProxyMessageKind.GetPrincipal;\n}\n\nexport interface ProxyMessageGetPrincipalResponse extends ProxyMessageBase {\n  type: ProxyMessageKind.GetPrincipalResponse;\n  response: string;\n}\n\nexport interface ProxyMessageQuery extends ProxyMessageBase {\n  type: ProxyMessageKind.Query;\n  args: [string, QueryFields];\n}\n\nexport interface ProxyMessageQueryResponse extends ProxyMessageBase {\n  type: ProxyMessageKind.QueryResponse;\n  response: QueryResponse;\n}\n\nexport interface ProxyMessageCall extends ProxyMessageBase {\n  type: ProxyMessageKind.Call;\n  args: [string, CallOptions];\n}\n\nexport interface ProxyMessageCallResponse extends ProxyMessageBase {\n  type: ProxyMessageKind.CallResponse;\n  response: SubmitResponse;\n}\n\nexport interface ProxyMessageReadState extends ProxyMessageBase {\n  type: ProxyMessageKind.ReadState;\n  args: [string, ReadStateOptions];\n}\n\nexport interface ProxyMessageReadStateResponse extends ProxyMessageBase {\n  type: ProxyMessageKind.ReadStateResponse;\n  response: ReadStateResponse;\n}\n\nexport interface ProxyMessageStatus extends ProxyMessageBase {\n  type: ProxyMessageKind.Status;\n}\n\nexport interface ProxyMessageStatusResponse extends ProxyMessageBase {\n  type: ProxyMessageKind.StatusResponse;\n  response: JsonObject;\n}\n\nexport type ProxyMessage =\n  | ProxyMessageError\n  | ProxyMessageGetPrincipal\n  | ProxyMessageGetPrincipalResponse\n  | ProxyMessageQuery\n  | ProxyMessageQueryResponse\n  | ProxyMessageCall\n  | ProxyMessageReadState\n  | ProxyMessageReadStateResponse\n  | ProxyMessageCallResponse\n  | ProxyMessageStatus\n  | ProxyMessageStatusResponse;\n\n// A Stub Agent that forwards calls to another Agent implementation.\nexport class ProxyStubAgent {\n  constructor(private _frontend: (msg: ProxyMessage) => void, private _agent: Agent) {}\n\n  public onmessage(msg: ProxyMessage): void {\n    switch (msg.type) {\n      case ProxyMessageKind.GetPrincipal:\n        this._agent.getPrincipal().then(response => {\n          this._frontend({\n            id: msg.id,\n            type: ProxyMessageKind.GetPrincipalResponse,\n            response: response.toText(),\n          });\n        });\n        break;\n      case ProxyMessageKind.Query:\n        this._agent.query(...msg.args).then(response => {\n          this._frontend({\n            id: msg.id,\n            type: ProxyMessageKind.QueryResponse,\n            response,\n          });\n        });\n        break;\n      case ProxyMessageKind.Call:\n        this._agent.call(...msg.args).then(response => {\n          this._frontend({\n            id: msg.id,\n            type: ProxyMessageKind.CallResponse,\n            response,\n          });\n        });\n        break;\n      case ProxyMessageKind.ReadState:\n        this._agent.readState(...msg.args).then(response => {\n          this._frontend({\n            id: msg.id,\n            type: ProxyMessageKind.ReadStateResponse,\n            response,\n          });\n        });\n        break;\n      case ProxyMessageKind.Status:\n        this._agent.status().then(response => {\n          this._frontend({\n            id: msg.id,\n            type: ProxyMessageKind.StatusResponse,\n            response,\n          });\n        });\n        break;\n\n      default:\n        throw new Error(`Invalid message received: ${JSON.stringify(msg)}`);\n    }\n  }\n}\n\n// An Agent that forwards calls to a backend. The calls are serialized\nexport class ProxyAgent implements Agent {\n  private _nextId = 0;\n  private _pendingCalls = new Map<number, [(resolve: any) => void, (reject: any) => void]>();\n  public rootKey = null;\n\n  constructor(private _backend: (msg: ProxyMessage) => void) {}\n\n  public onmessage(msg: ProxyMessage): void {\n    const id = msg.id;\n\n    const maybePromise = this._pendingCalls.get(id);\n    if (!maybePromise) {\n      throw new Error('A proxy get the same message twice...');\n    }\n\n    this._pendingCalls.delete(id);\n    const [resolve, reject] = maybePromise;\n\n    switch (msg.type) {\n      case ProxyMessageKind.Error:\n        return reject(msg.error);\n      case ProxyMessageKind.GetPrincipalResponse:\n      case ProxyMessageKind.CallResponse:\n      case ProxyMessageKind.QueryResponse:\n      case ProxyMessageKind.ReadStateResponse:\n      case ProxyMessageKind.StatusResponse:\n        return resolve(msg.response);\n      default:\n        throw new Error(`Invalid message being sent to ProxyAgent: ${JSON.stringify(msg)}`);\n    }\n  }\n\n  public async getPrincipal(): Promise<Principal> {\n    return this._sendAndWait({\n      id: this._nextId++,\n      type: ProxyMessageKind.GetPrincipal,\n    }).then(principal => {\n      if (typeof principal !== 'string') {\n        throw new Error('Invalid principal received.');\n      }\n      return Principal.fromText(principal);\n    });\n  }\n\n  public readState(\n    canisterId: Principal | string,\n    fields: ReadStateOptions,\n  ): Promise<ReadStateResponse> {\n    return this._sendAndWait({\n      id: this._nextId++,\n      type: ProxyMessageKind.ReadState,\n      args: [canisterId.toString(), fields],\n    }) as Promise<ReadStateResponse>;\n  }\n\n  public call(canisterId: Principal | string, fields: CallOptions): Promise<SubmitResponse> {\n    return this._sendAndWait({\n      id: this._nextId++,\n      type: ProxyMessageKind.Call,\n      args: [canisterId.toString(), fields],\n    }) as Promise<SubmitResponse>;\n  }\n\n  public status(): Promise<JsonObject> {\n    return this._sendAndWait({\n      id: this._nextId++,\n      type: ProxyMessageKind.Status,\n    }) as Promise<JsonObject>;\n  }\n\n  public query(canisterId: Principal | string, fields: QueryFields): Promise<QueryResponse> {\n    return this._sendAndWait({\n      id: this._nextId++,\n      type: ProxyMessageKind.Query,\n      args: [canisterId.toString(), fields],\n    }) as Promise<QueryResponse>;\n  }\n\n  private async _sendAndWait(msg: ProxyMessage): Promise<unknown> {\n    return new Promise((resolve, reject) => {\n      this._pendingCalls.set(msg.id, [resolve, reject]);\n\n      this._backend(msg);\n    });\n  }\n\n  public async fetchRootKey(): Promise<ArrayBuffer> {\n    // Hex-encoded version of the replica root key\n    const rootKey = ((await this.status()) as any).root_key;\n    this.rootKey = rootKey;\n    return rootKey;\n  }\n}\n", "import { GlobalInternetComputer } from '../index';\nimport { Agent } from './api';\n\nexport * from './api';\nexport * from './http';\nexport * from './proxy';\n\ndeclare const window: GlobalInternetComputer;\ndeclare const global: GlobalInternetComputer;\ndeclare const self: GlobalInternetComputer;\n\nexport function getDefaultAgent(): Agent {\n  const agent =\n    typeof window === 'undefined'\n      ? typeof global === 'undefined'\n        ? typeof self === 'undefined'\n          ? undefined\n          : self.ic.agent\n        : global.ic.agent\n      : window.ic.agent;\n\n  if (!agent) {\n    throw new Error('No Agent could be found.');\n  }\n\n  return agent;\n}\n", "import { Principal } from '@dfinity/principal';\nimport { RequestStatusResponseStatus } from '../agent';\nimport { toHex } from '../utils/buffer';\nimport { PollStrategy } from './index';\nimport { RequestId } from '../request_id';\n\nexport type Predicate<T> = (\n  canisterId: Principal,\n  requestId: RequestId,\n  status: RequestStatusResponseStatus,\n) => Promise<T>;\n\nconst FIVE_MINUTES_IN_MSEC = 5 * 60 * 1000;\n\n/**\n * A best practices polling strategy: wait 2 seconds before the first poll, then 1 second\n * with an exponential backoff factor of 1.2. Timeout after 5 minutes.\n */\nexport function defaultStrategy(): PollStrategy {\n  return chain(conditionalDelay(once(), 1000), backoff(1000, 1.2), timeout(FIVE_MINUTES_IN_MSEC));\n}\n\n/**\n * Predicate that returns true once.\n */\nexport function once(): Predicate<boolean> {\n  let first = true;\n  return async () => {\n    if (first) {\n      first = false;\n      return true;\n    }\n    return false;\n  };\n}\n\n/**\n * Delay the polling once.\n * @param condition A predicate that indicates when to delay.\n * @param timeInMsec The amount of time to delay.\n */\nexport function conditionalDelay(condition: Predicate<boolean>, timeInMsec: number): PollStrategy {\n  return async (\n    canisterId: Principal,\n    requestId: RequestId,\n    status: RequestStatusResponseStatus,\n  ) => {\n    if (await condition(canisterId, requestId, status)) {\n      return new Promise(resolve => setTimeout(resolve, timeInMsec));\n    }\n  };\n}\n\n/**\n * Error out after a maximum number of polling has been done.\n * @param count The maximum attempts to poll.\n */\nexport function maxAttempts(count: number): PollStrategy {\n  let attempts = count;\n  return async (\n    canisterId: Principal,\n    requestId: RequestId,\n    status: RequestStatusResponseStatus,\n  ) => {\n    if (--attempts <= 0) {\n      throw new Error(\n        `Failed to retrieve a reply for request after ${count} attempts:\\n` +\n          `  Request ID: ${toHex(requestId)}\\n` +\n          `  Request status: ${status}\\n`,\n      );\n    }\n  };\n}\n\n/**\n * Throttle polling.\n * @param throttleInMsec Amount in millisecond to wait between each polling.\n */\nexport function throttle(throttleInMsec: number): PollStrategy {\n  return () => new Promise(resolve => setTimeout(resolve, throttleInMsec));\n}\n\n/**\n * Reject a call after a certain amount of time.\n * @param timeInMsec Time in milliseconds before the polling should be rejected.\n */\nexport function timeout(timeInMsec: number): PollStrategy {\n  const end = Date.now() + timeInMsec;\n  return async (\n    canisterId: Principal,\n    requestId: RequestId,\n    status: RequestStatusResponseStatus,\n  ) => {\n    if (Date.now() > end) {\n      throw new Error(\n        `Request timed out after ${timeInMsec} msec:\\n` +\n          `  Request ID: ${toHex(requestId)}\\n` +\n          `  Request status: ${status}\\n`,\n      );\n    }\n  };\n}\n\n/**\n * A strategy that throttle, but using an exponential backoff strategy.\n * @param startingThrottleInMsec The throttle in milliseconds to start with.\n * @param backoffFactor The factor to multiple the throttle time between every poll. For\n *   example if using 2, the throttle will double between every run.\n */\nexport function backoff(startingThrottleInMsec: number, backoffFactor: number): PollStrategy {\n  let currentThrottling = startingThrottleInMsec;\n\n  return () =>\n    new Promise(resolve =>\n      setTimeout(() => {\n        currentThrottling *= backoffFactor;\n        resolve();\n      }, currentThrottling),\n    );\n}\n\n/**\n * Chain multiple polling strategy. This _chains_ the strategies, so if you pass in,\n * say, two throttling strategy of 1 second, it will result in a throttle of 2 seconds.\n * @param strategies A strategy list to chain.\n */\nexport function chain(...strategies: PollStrategy[]): PollStrategy {\n  return async (\n    canisterId: Principal,\n    requestId: RequestId,\n    status: RequestStatusResponseStatus,\n  ) => {\n    for (const a of strategies) {\n      await a(canisterId, requestId, status);\n    }\n  };\n}\n", "import { Principal } from '@dfinity/principal';\nimport { Agent, RequestStatusResponseStatus } from '../agent';\nimport { Certificate, CreateCertificateOptions } from '../certificate';\nimport { RequestId } from '../request_id';\nimport { toHex } from '../utils/buffer';\n\nexport * as strategy from './strategy';\nexport { defaultStrategy } from './strategy';\nexport type PollStrategy = (\n  canisterId: Principal,\n  requestId: RequestId,\n  status: RequestStatusResponseStatus,\n) => Promise<void>;\nexport type PollStrategyFactory = () => PollStrategy;\n\n/**\n * Polls the IC to check the status of the given request then\n * returns the response bytes once the request has been processed.\n * @param agent The agent to use to poll read_state.\n * @param canisterId The effective canister ID.\n * @param requestId The Request ID to poll status for.\n * @param strategy A polling strategy.\n * @param request Request for the readState call.\n */\nexport async function pollForResponse(\n  agent: Agent,\n  canisterId: Principal,\n  requestId: RequestId,\n  strategy: PollStrategy,\n  // eslint-disable-next-line\n  request?: any,\n  blsVerify?: CreateCertificateOptions['blsVerify'],\n): Promise<ArrayBuffer> {\n  const path = [new TextEncoder().encode('request_status'), requestId];\n  const currentRequest = request ?? (await agent.createReadStateRequest?.({ paths: [path] }));\n  const state = await agent.readState(canisterId, { paths: [path] }, undefined, currentRequest);\n  if (agent.rootKey == null) throw new Error('Agent root key not initialized before polling');\n  const cert = await Certificate.create({\n    certificate: state.certificate,\n    rootKey: agent.rootKey,\n    canisterId: canisterId,\n    blsVerify,\n  });\n  const maybeBuf = cert.lookup([...path, new TextEncoder().encode('status')]);\n  let status;\n  if (typeof maybeBuf === 'undefined') {\n    // Missing requestId means we need to wait\n    status = RequestStatusResponseStatus.Unknown;\n  } else {\n    status = new TextDecoder().decode(maybeBuf);\n  }\n\n  switch (status) {\n    case RequestStatusResponseStatus.Replied: {\n      return cert.lookup([...path, 'reply'])!;\n    }\n\n    case RequestStatusResponseStatus.Received:\n    case RequestStatusResponseStatus.Unknown:\n    case RequestStatusResponseStatus.Processing:\n      // Execute the polling strategy, then retry.\n      await strategy(canisterId, requestId, status);\n      return pollForResponse(agent, canisterId, requestId, strategy, currentRequest);\n\n    case RequestStatusResponseStatus.Rejected: {\n      const rejectCode = new Uint8Array(cert.lookup([...path, 'reject_code'])!)[0];\n      const rejectMessage = new TextDecoder().decode(cert.lookup([...path, 'reject_message'])!);\n      throw new Error(\n        `Call was rejected:\\n` +\n          `  Request ID: ${toHex(requestId)}\\n` +\n          `  Reject code: ${rejectCode}\\n` +\n          `  Reject text: ${rejectMessage}\\n`,\n      );\n    }\n\n    case RequestStatusResponseStatus.Done:\n      // This is _technically_ not an error, but we still didn't see the `Replied` status so\n      // we don't know the result and cannot decode it.\n      throw new Error(\n        `Call was marked as done but we never saw the reply:\\n` +\n          `  Request ID: ${toHex(requestId)}\\n`,\n      );\n  }\n  throw new Error('unreachable');\n}\n", "/**\n * This file is generated from the candid for asset management.\n */\n/* tslint:disable */\n// @ts-ignore\nexport default ({ IDL }) => {\n  const canister_id = IDL.Principal;\n  const definite_canister_settings = IDL.Record({\n    controllers: IDL.Vec(IDL.Principal),\n    freezing_threshold: IDL.Nat,\n    memory_allocation: IDL.Nat,\n    compute_allocation: IDL.Nat,\n  });\n  const canister_settings = IDL.Record({\n    controllers: IDL.Opt(IDL.Vec(IDL.Principal)),\n    freezing_threshold: IDL.Opt(IDL.Nat),\n    memory_allocation: IDL.Opt(IDL.Nat),\n    compute_allocation: IDL.Opt(IDL.Nat),\n  });\n  const wasm_module = IDL.Vec(IDL.Nat8);\n  return IDL.Service({\n    canister_status: IDL.Func(\n      [IDL.Record({ canister_id: canister_id })],\n      [\n        IDL.Record({\n          status: IDL.Variant({\n            stopped: IDL.Null,\n            stopping: IDL.Null,\n            running: IDL.Null,\n          }),\n          memory_size: IDL.Nat,\n          cycles: IDL.Nat,\n          settings: definite_canister_settings,\n          module_hash: IDL.Opt(IDL.Vec(IDL.Nat8)),\n        }),\n      ],\n      [],\n    ),\n    create_canister: IDL.Func(\n      [IDL.Record({ settings: IDL.Opt(canister_settings) })],\n      [IDL.Record({ canister_id: canister_id })],\n      [],\n    ),\n    delete_canister: IDL.Func([IDL.Record({ canister_id: canister_id })], [], []),\n    deposit_cycles: IDL.Func([IDL.Record({ canister_id: canister_id })], [], []),\n    install_code: IDL.Func(\n      [\n        IDL.Record({\n          arg: IDL.Vec(IDL.Nat8),\n          wasm_module: wasm_module,\n          mode: IDL.Variant({\n            reinstall: IDL.Null,\n            upgrade: IDL.Null,\n            install: IDL.Null,\n          }),\n          canister_id: canister_id,\n        }),\n      ],\n      [],\n      [],\n    ),\n    provisional_create_canister_with_cycles: IDL.Func(\n      [\n        IDL.Record({\n          settings: IDL.Opt(canister_settings),\n          amount: IDL.Opt(IDL.Nat),\n        }),\n      ],\n      [IDL.Record({ canister_id: canister_id })],\n      [],\n    ),\n    provisional_top_up_canister: IDL.Func(\n      [IDL.Record({ canister_id: canister_id, amount: IDL.Nat })],\n      [],\n      [],\n    ),\n    raw_rand: IDL.Func([], [IDL.Vec(IDL.Nat8)], []),\n    start_canister: IDL.Func([IDL.Record({ canister_id: canister_id })], [], []),\n    stop_canister: IDL.Func([IDL.Record({ canister_id: canister_id })], [], []),\n    uninstall_code: IDL.Func([IDL.Record({ canister_id: canister_id })], [], []),\n    update_settings: IDL.Func(\n      [\n        IDL.Record({\n          canister_id: IDL.Principal,\n          settings: canister_settings,\n        }),\n      ],\n      [],\n      [],\n    ),\n  });\n};\n", "import { DerEncodedPublicKey, KeyPair, PublicKey, Signature, SignIdentity } from '@dfinity/agent';\nimport * as tweetnacl from 'tweetnacl';\nimport { fromHexString, toHexString } from '../buffer';\nimport { ED25519_OID, unwrapDER, wrapDER } from './der';\n\nexport class Ed25519PublicKey implements PublicKey {\n  public static from(key: PublicKey): Ed25519PublicKey {\n    return this.fromDer(key.toDer());\n  }\n\n  public static fromRaw(rawKey: ArrayBuffer): Ed25519PublicKey {\n    return new Ed25519PublicKey(rawKey);\n  }\n\n  public static fromDer(derKey: DerEncodedPublicKey): Ed25519PublicKey {\n    return new Ed25519PublicKey(this.derDecode(derKey));\n  }\n\n  // The length of Ed25519 public keys is always 32 bytes.\n  private static RAW_KEY_LENGTH = 32;\n\n  private static derEncode(publicKey: ArrayBuffer): DerEncodedPublicKey {\n    return wrapDER(publicKey, ED25519_OID).buffer as DerEncodedPublicKey;\n  }\n\n  private static derDecode(key: DerEncodedPublicKey): ArrayBuffer {\n    const unwrapped = unwrapDER(key, ED25519_OID);\n    if (unwrapped.length !== this.RAW_KEY_LENGTH) {\n      throw new Error('An Ed25519 public key must be exactly 32bytes long');\n    }\n    return unwrapped;\n  }\n\n  private readonly rawKey: ArrayBuffer;\n  private readonly derKey: DerEncodedPublicKey;\n\n  // `fromRaw` and `fromDer` should be used for instantiation, not this constructor.\n  private constructor(key: ArrayBuffer) {\n    this.rawKey = key;\n    this.derKey = Ed25519PublicKey.derEncode(key);\n  }\n\n  public toDer(): DerEncodedPublicKey {\n    return this.derKey;\n  }\n\n  public toRaw(): ArrayBuffer {\n    return this.rawKey;\n  }\n}\n\nexport class Ed25519KeyIdentity extends SignIdentity {\n  public static generate(seed?: Uint8Array): Ed25519KeyIdentity {\n    if (seed && seed.length !== 32) {\n      throw new Error('Ed25519 Seed needs to be 32 bytes long.');\n    }\n\n    const { publicKey, secretKey } =\n      seed === undefined ? tweetnacl.sign.keyPair() : tweetnacl.sign.keyPair.fromSeed(seed);\n    return new this(Ed25519PublicKey.fromRaw(publicKey), secretKey);\n  }\n\n  public static fromParsedJson(obj: JsonnableEd25519KeyIdentity): Ed25519KeyIdentity {\n    const [publicKeyDer, privateKeyRaw] = obj;\n    return new Ed25519KeyIdentity(\n      Ed25519PublicKey.fromDer(fromHexString(publicKeyDer) as DerEncodedPublicKey),\n      fromHexString(privateKeyRaw),\n    );\n  }\n\n  public static fromJSON(json: string): Ed25519KeyIdentity {\n    const parsed = JSON.parse(json);\n    if (Array.isArray(parsed)) {\n      if (typeof parsed[0] === 'string' && typeof parsed[1] === 'string') {\n        return this.fromParsedJson([parsed[0], parsed[1]]);\n      } else {\n        throw new Error('Deserialization error: JSON must have at least 2 items.');\n      }\n    }\n    throw new Error(`Deserialization error: Invalid JSON type for string: ${JSON.stringify(json)}`);\n  }\n\n  public static fromKeyPair(publicKey: ArrayBuffer, privateKey: ArrayBuffer): Ed25519KeyIdentity {\n    return new Ed25519KeyIdentity(Ed25519PublicKey.fromRaw(publicKey), privateKey);\n  }\n\n  public static fromSecretKey(secretKey: ArrayBuffer): Ed25519KeyIdentity {\n    const keyPair = tweetnacl.sign.keyPair.fromSecretKey(new Uint8Array(secretKey));\n    return Ed25519KeyIdentity.fromKeyPair(keyPair.publicKey, keyPair.secretKey);\n  }\n\n  protected _publicKey: Ed25519PublicKey;\n\n  // `fromRaw` and `fromDer` should be used for instantiation, not this constructor.\n  protected constructor(publicKey: PublicKey, protected _privateKey: ArrayBuffer) {\n    super();\n    this._publicKey = Ed25519PublicKey.from(publicKey);\n  }\n\n  /**\n   * Serialize this key to JSON.\n   */\n  public toJSON(): JsonnableEd25519KeyIdentity {\n    return [toHexString(this._publicKey.toDer()), toHexString(this._privateKey)];\n  }\n\n  /**\n   * Return a copy of the key pair.\n   */\n  public getKeyPair(): KeyPair {\n    return {\n      secretKey: this._privateKey,\n      publicKey: this._publicKey,\n    };\n  }\n\n  /**\n   * Return the public key.\n   */\n  public getPublicKey(): PublicKey {\n    return this._publicKey;\n  }\n\n  /**\n   * Signs a blob of data, with this identity's private key.\n   * @param challenge - challenge to sign with this identity's secretKey, producing a signature\n   */\n  public async sign(challenge: ArrayBuffer): Promise<Signature> {\n    const blob = new Uint8Array(challenge);\n    const signature = tweetnacl.sign.detached(blob, new Uint8Array(this._privateKey)).buffer;\n    return signature as Signature;\n  }\n}\n\ntype PublicKeyHex = string;\ntype SecretKeyHex = string;\nexport type JsonnableEd25519KeyIdentity = [PublicKeyHex, SecretKeyHex];\n", "/**\n * Return an array buffer from its hexadecimal representation.\n * @param hexString The hexadecimal string.\n */\nexport function fromHexString(hexString: string): ArrayBuffer {\n  return new Uint8Array((hexString.match(/.{1,2}/g) ?? []).map(byte => parseInt(byte, 16))).buffer;\n}\n\n/**\n * Returns an hexadecimal representation of an array buffer.\n * @param bytes The array buffer.\n */\nexport function toHexString(bytes: ArrayBuffer): string {\n  return new Uint8Array(bytes).reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), '');\n}\n", "export const bufEquals = (b1: ArrayBuffer, b2: ArrayBuffer): boolean => {\n  if (b1.byteLength !== b2.byteLength) return false;\n  const u1 = new Uint8Array(b1);\n  const u2 = new Uint8Array(b2);\n  for (let i = 0; i < u1.length; i++) {\n    if (u1[i] !== u2[i]) return false;\n  }\n  return true;\n};\n\nexport const encodeLenBytes = (len: number): number => {\n  if (len <= 0x7f) {\n    return 1;\n  } else if (len <= 0xff) {\n    return 2;\n  } else if (len <= 0xffff) {\n    return 3;\n  } else if (len <= 0xffffff) {\n    return 4;\n  } else {\n    throw new Error('Length too long (> 4 bytes)');\n  }\n};\n\nexport const encodeLen = (buf: Uint8Array, offset: number, len: number): number => {\n  if (len <= 0x7f) {\n    buf[offset] = len;\n    return 1;\n  } else if (len <= 0xff) {\n    buf[offset] = 0x81;\n    buf[offset + 1] = len;\n    return 2;\n  } else if (len <= 0xffff) {\n    buf[offset] = 0x82;\n    buf[offset + 1] = len >> 8;\n    buf[offset + 2] = len;\n    return 3;\n  } else if (len <= 0xffffff) {\n    buf[offset] = 0x83;\n    buf[offset + 1] = len >> 16;\n    buf[offset + 2] = len >> 8;\n    buf[offset + 3] = len;\n    return 4;\n  } else {\n    throw new Error('Length too long (> 4 bytes)');\n  }\n};\n\nexport const decodeLenBytes = (buf: Uint8Array, offset: number): number => {\n  if (buf[offset] < 0x80) return 1;\n  if (buf[offset] === 0x80) throw new Error('Invalid length 0');\n  if (buf[offset] === 0x81) return 2;\n  if (buf[offset] === 0x82) return 3;\n  if (buf[offset] === 0x83) return 4;\n  throw new Error('Length too long (> 4 bytes)');\n};\n\nexport const decodeLen = (buf: Uint8Array, offset: number): number => {\n  const lenBytes = decodeLenBytes(buf, offset);\n  if (lenBytes === 1) return buf[offset];\n  else if (lenBytes === 2) return buf[offset + 1];\n  else if (lenBytes === 3) return (buf[offset + 1] << 8) + buf[offset + 2];\n  else if (lenBytes === 4)\n    return (buf[offset + 1] << 16) + (buf[offset + 2] << 8) + buf[offset + 3];\n  throw new Error('Length too long (> 4 bytes)');\n};\n\n/**\n * A DER encoded `SEQUENCE(OID)` for DER-encoded-COSE\n */\nexport const DER_COSE_OID = Uint8Array.from([\n  ...[0x30, 0x0c], // SEQUENCE\n  ...[0x06, 0x0a], // OID with 10 bytes\n  ...[0x2b, 0x06, 0x01, 0x04, 0x01, 0x83, 0xb8, 0x43, 0x01, 0x01], // DER encoded COSE\n]);\n\n/**\n * A DER encoded `SEQUENCE(OID)` for the Ed25519 algorithm\n */\nexport const ED25519_OID = Uint8Array.from([\n  ...[0x30, 0x05], // SEQUENCE\n  ...[0x06, 0x03], // OID with 3 bytes\n  ...[0x2b, 0x65, 0x70], // id-Ed25519 OID\n]);\n\n/**\n * A DER encoded `SEQUENCE(OID)` for secp256k1 with the ECDSA algorithm\n */\nexport const SECP256K1_OID = Uint8Array.from([\n  ...[0x30, 0x10], // SEQUENCE\n  ...[0x06, 0x07], // OID with 7 bytes\n  ...[0x2a, 0x86, 0x48, 0xce, 0x3d, 0x02, 0x01], // OID ECDSA\n  ...[0x06, 0x05], // OID with 5 bytes\n  ...[0x2b, 0x81, 0x04, 0x00, 0x0a], // OID secp256k1\n]);\n\n/**\n * Wraps the given `payload` in a DER encoding tagged with the given encoded `oid` like so:\n * `SEQUENCE(oid, BITSTRING(payload))`\n *\n * @param payload The payload to encode as the bit string\n * @param oid The DER encoded (and SEQUENCE wrapped!) OID to tag the payload with\n */\nexport function wrapDER(payload: ArrayBuffer, oid: Uint8Array): Uint8Array {\n  // The Bit String header needs to include the unused bit count byte in its length\n  const bitStringHeaderLength = 2 + encodeLenBytes(payload.byteLength + 1);\n  const len = oid.byteLength + bitStringHeaderLength + payload.byteLength;\n  let offset = 0;\n  const buf = new Uint8Array(1 + encodeLenBytes(len) + len);\n  // Sequence\n  buf[offset++] = 0x30;\n  // Sequence Length\n  offset += encodeLen(buf, offset, len);\n\n  // OID\n  buf.set(oid, offset);\n  offset += oid.byteLength;\n\n  // Bit String Header\n  buf[offset++] = 0x03;\n  offset += encodeLen(buf, offset, payload.byteLength + 1);\n  // 0 padding\n  buf[offset++] = 0x00;\n  buf.set(new Uint8Array(payload), offset);\n\n  return buf;\n}\n\n/**\n * Extracts a payload from the given `derEncoded` data, and checks that it was tagged with the given `oid`.\n *\n * `derEncoded = SEQUENCE(oid, BITSTRING(payload))`\n *\n * @param derEncoded The DER encoded and tagged data\n * @param oid The DER encoded (and SEQUENCE wrapped!) expected OID\n * @returns The unwrapped payload\n */\nexport const unwrapDER = (derEncoded: ArrayBuffer, oid: Uint8Array): Uint8Array => {\n  let offset = 0;\n  const expect = (n: number, msg: string) => {\n    if (buf[offset++] !== n) {\n      throw new Error('Expected: ' + msg);\n    }\n  };\n\n  const buf = new Uint8Array(derEncoded);\n  expect(0x30, 'sequence');\n  offset += decodeLenBytes(buf, offset);\n\n  if (!bufEquals(buf.slice(offset, offset + oid.byteLength), oid)) {\n    throw new Error('Not the expected OID.');\n  }\n  offset += oid.byteLength;\n\n  expect(0x03, 'bit string');\n  const payloadLen = decodeLen(buf, offset) - 1; // Subtracting 1 to account for the 0 padding\n  offset += decodeLenBytes(buf, offset);\n  expect(0x00, '0 padding');\n  const result = buf.slice(offset);\n  if (payloadLen !== result.length) {\n    throw new Error(\n      `DER payload mismatch: Expected length ${payloadLen} actual length ${result.length}`,\n    );\n  }\n  return result;\n};\n", "import { DerEncodedPublicKey, PublicKey, Signature, SignIdentity } from '@dfinity/agent';\n\n/**\n * Options used in a {@link ECDSAKeyIdentity}\n */\nexport type CryptoKeyOptions = {\n  extractable?: boolean;\n  keyUsages?: KeyUsage[];\n  subtleCrypto?: SubtleCrypto;\n};\n\nexport class CryptoError extends Error {\n  constructor(public readonly message: string) {\n    super(message);\n    Object.setPrototypeOf(this, CryptoError.prototype);\n  }\n}\n\nexport interface DerCryptoKey extends CryptoKey {\n  toDer: () => DerEncodedPublicKey;\n}\n\n/**\n * Utility method to ensure that a subtleCrypto implementation is provided or is available in the global context\n * @param subtleCrypto SubtleCrypto implementation\n * @returns subleCrypto\n */\nfunction _getEffectiveCrypto(subtleCrypto: CryptoKeyOptions['subtleCrypto']): SubtleCrypto {\n  if (subtleCrypto) {\n    return subtleCrypto;\n  } else if (typeof crypto !== 'undefined' && crypto['subtle']) {\n    return crypto.subtle;\n  } else {\n    throw new CryptoError(\n      'Global crypto was not available and none was provided. Please inlcude a SubtleCrypto implementation. See https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto',\n    );\n  }\n}\n\n/**\n * An identity interface that wraps an ECDSA keypair using the P-256 named curve. Supports DER-encoding and decoding for agent calls\n */\nexport class ECDSAKeyIdentity extends SignIdentity {\n  /**\n   * Generates a randomly generated identity for use in calls to the Internet Computer.\n   * @param {CryptoKeyOptions} options optional settings\n   * @param {CryptoKeyOptions['extractable']} options.extractable - whether the key should allow itself to be used. Set to false for maximum security.\n   * @param {CryptoKeyOptions['keyUsages']} options.keyUsages - a list of key usages that the key can be used for\n   * @param {CryptoKeyOptions['subtleCrypto']} options.subtleCrypto interface\n   * @constructs ECDSAKeyIdentity\n   * @returns a {@link ECDSAKeyIdentity}\n   */\n  public static async generate(options?: CryptoKeyOptions): Promise<ECDSAKeyIdentity> {\n    const { extractable = false, keyUsages = ['sign', 'verify'], subtleCrypto } = options ?? {};\n    const effectiveCrypto = _getEffectiveCrypto(subtleCrypto);\n    const keyPair = await effectiveCrypto.generateKey(\n      {\n        name: 'ECDSA',\n        namedCurve: 'P-256',\n      },\n      extractable,\n      keyUsages,\n    );\n    const derKey = (await effectiveCrypto.exportKey(\n      'spki',\n      keyPair.publicKey,\n    )) as DerEncodedPublicKey;\n\n    return new this(keyPair, derKey, effectiveCrypto);\n  }\n\n  /**\n   * generates an identity from a public and private key. Please ensure that you are generating these keys securely and protect the user's private key\n   * @param keyPair a {@link CryptoKeyPair}\n   * @param subtleCrypto a {@link SubtleCrypto} interface in case one is not available globally\n   * @returns an {@link ECDSAKeyIdentity}\n   */\n  public static async fromKeyPair(\n    keyPair: CryptoKeyPair | { privateKey: CryptoKey; publicKey: CryptoKey },\n    subtleCrypto?: SubtleCrypto,\n  ): Promise<ECDSAKeyIdentity> {\n    const effectiveCrypto = _getEffectiveCrypto(subtleCrypto);\n    const derKey = (await effectiveCrypto.exportKey(\n      'spki',\n      keyPair.publicKey,\n    )) as DerEncodedPublicKey;\n    return new ECDSAKeyIdentity(keyPair, derKey, effectiveCrypto);\n  }\n\n  protected _derKey: DerEncodedPublicKey;\n  protected _keyPair: CryptoKeyPair;\n  protected _subtleCrypto: SubtleCrypto;\n\n  // `fromKeyPair` and `generate` should be used for instantiation, not this constructor.\n  protected constructor(\n    keyPair: CryptoKeyPair,\n    derKey: DerEncodedPublicKey,\n    subtleCrypto: SubtleCrypto,\n  ) {\n    super();\n    this._keyPair = keyPair;\n    this._derKey = derKey;\n    this._subtleCrypto = subtleCrypto;\n  }\n\n  /**\n   * Return the internally-used key pair.\n   * @returns a {@link CryptoKeyPair}\n   */\n  public getKeyPair(): CryptoKeyPair {\n    return this._keyPair;\n  }\n\n  /**\n   * Return the public key.\n   * @returns an {@link DerCryptoKey}\n   */\n  public getPublicKey(): DerCryptoKey {\n    const derKey = this._derKey;\n    const key: DerCryptoKey = Object.create(this._keyPair.publicKey);\n    key.toDer = function () {\n      return derKey;\n    };\n\n    return key;\n  }\n\n  /**\n   * Signs a blob of data, with this identity's private key.\n   * @param {ArrayBuffer} challenge - challenge to sign with this identity's secretKey, producing a signature\n   * @returns {Promise<Signature>} signature\n   */\n  public async sign(challenge: ArrayBuffer): Promise<Signature> {\n    const params: EcdsaParams = {\n      name: 'ECDSA',\n      hash: { name: 'SHA-256' },\n    };\n    this._keyPair.privateKey;\n    const signature = await this._subtleCrypto.sign(params, this._keyPair.privateKey, challenge);\n\n    return signature as Signature;\n  }\n}\n\nexport default ECDSAKeyIdentity;\n", "import {\n  DerEncodedPublicKey,\n  HttpAgentRequest,\n  PublicKey,\n  requestIdOf,\n  Signature,\n  SignIdentity,\n} from '@dfinity/agent';\nimport { Principal } from '@dfinity/principal';\nimport * as cbor from 'simple-cbor';\nimport { fromHexString, toHexString } from '../buffer';\n\nconst domainSeparator = new TextEncoder().encode('\\x1Aic-request-auth-delegation');\nconst requestDomainSeparator = new TextEncoder().encode('\\x0Aic-request');\n\nfunction _parseBlob(value: unknown): ArrayBuffer {\n  if (typeof value !== 'string' || value.length < 64) {\n    throw new Error('Invalid public key.');\n  }\n\n  return fromHexString(value);\n}\n\n/**\n * A single delegation object that is signed by a private key. This is constructed by\n * `DelegationChain.create()`.\n *\n * {@see DelegationChain}\n */\nexport class Delegation {\n  constructor(\n    public readonly pubkey: ArrayBuffer,\n    public readonly expiration: bigint,\n    public readonly targets?: Principal[],\n  ) {}\n\n  public toCBOR(): cbor.CborValue {\n    // Expiration field needs to be encoded as a u64 specifically.\n    return cbor.value.map({\n      pubkey: cbor.value.bytes(this.pubkey),\n      expiration: cbor.value.u64(this.expiration.toString(16), 16),\n      ...(this.targets && {\n        targets: cbor.value.array(this.targets.map(t => cbor.value.bytes(t.toUint8Array()))),\n      }),\n    });\n  }\n\n  public toJSON(): JsonnableDelegation {\n    // every string should be hex and once-de-hexed,\n    // discoverable what it is (e.g. de-hex to get JSON with a 'type' property, or de-hex to DER\n    // with an OID). After de-hex, if it's not obvious what it is, it's an ArrayBuffer.\n    return {\n      expiration: this.expiration.toString(16),\n      pubkey: toHexString(this.pubkey),\n      ...(this.targets && { targets: this.targets.map(p => p.toHex()) }),\n    };\n  }\n}\n\n/**\n * Type of ReturnType<Delegation.toJSON>.\n * The goal here is to stringify all non-JSON-compatible types to some bytes representation we can\n * stringify as hex.\n * (Hex shouldn't be ambiguous ever, because you can encode as DER with semantic OIDs).\n */\ninterface JsonnableDelegation {\n  // A BigInt of Nanoseconds since epoch as hex\n  expiration: string;\n  // Hexadecimal representation of the DER public key.\n  pubkey: string;\n  // Array of strings, where each string is hex of principal blob (*NOT* textual representation).\n  targets?: string[];\n}\n\n/**\n * A signed delegation, which lends its identity to the public key in the delegation\n * object. This is constructed by `DelegationChain.create()`.\n *\n * {@see DelegationChain}\n */\nexport interface SignedDelegation {\n  delegation: Delegation;\n  signature: Signature;\n}\n\n/**\n * Sign a single delegation object for a period of time.\n *\n * @param from The identity that lends its delegation.\n * @param to The identity that receives the delegation.\n * @param expiration An expiration date for this delegation.\n * @param targets Limit this delegation to the target principals.\n */\nasync function _createSingleDelegation(\n  from: SignIdentity,\n  to: PublicKey,\n  expiration: Date,\n  targets?: Principal[],\n): Promise<SignedDelegation> {\n  const delegation: Delegation = new Delegation(\n    to.toDer(),\n    BigInt(+expiration) * BigInt(1000000), // In nanoseconds.\n    targets,\n  );\n  // The signature is calculated by signing the concatenation of the domain separator\n  // and the message.\n  // Note: To ensure Safari treats this as a user gesture, ensure to not use async methods\n  // besides the actualy webauthn functionality (such as `sign`). Safari will de-register\n  // a user gesture if you await an async call thats not fetch, xhr, or setTimeout.\n  const challenge = new Uint8Array([\n    ...domainSeparator,\n    ...new Uint8Array(requestIdOf(delegation)),\n  ]);\n  const signature = await from.sign(challenge);\n\n  return {\n    delegation,\n    signature,\n  };\n}\n\nexport interface JsonnableDelegationChain {\n  publicKey: string;\n  delegations: Array<{\n    signature: string;\n    delegation: {\n      pubkey: string;\n      expiration: string;\n      targets?: string[];\n    };\n  }>;\n}\n\n/**\n * A chain of delegations. This is JSON Serializable.\n * This is the object to serialize and pass to a DelegationIdentity. It does not keep any\n * private keys.\n */\nexport class DelegationChain {\n  /**\n   * Create a delegation chain between two (or more) keys. By default, the expiration time\n   * will be very short (15 minutes).\n   *\n   * To build a chain of more than 2 identities, this function needs to be called multiple times,\n   * passing the previous delegation chain into the options argument. For example:\n   *\n   * @example\n   * const rootKey = createKey();\n   * const middleKey = createKey();\n   * const bottomeKey = createKey();\n   *\n   * const rootToMiddle = await DelegationChain.create(\n   *   root, middle.getPublicKey(), Date.parse('2100-01-01'),\n   * );\n   * const middleToBottom = await DelegationChain.create(\n   *   middle, bottom.getPublicKey(), Date.parse('2100-01-01'), { previous: rootToMiddle },\n   * );\n   *\n   * // We can now use a delegation identity that uses the delegation above:\n   * const identity = DelegationIdentity.fromDelegation(bottomKey, middleToBottom);\n   *\n   * @param from The identity that will delegate.\n   * @param to The identity that gets delegated. It can now sign messages as if it was the\n   *           identity above.\n   * @param expiration The length the delegation is valid. By default, 15 minutes from calling\n   *                   this function.\n   * @param options A set of options for this delegation. expiration and previous\n   * @param options.previous - Another DelegationChain that this chain should start with.\n   * @param options.targets - targets that scope the delegation (e.g. Canister Principals)\n   */\n  public static async create(\n    from: SignIdentity,\n    to: PublicKey,\n    expiration: Date = new Date(Date.now() + 15 * 60 * 1000),\n    options: {\n      previous?: DelegationChain;\n      targets?: Principal[];\n    } = {},\n  ): Promise<DelegationChain> {\n    const delegation = await _createSingleDelegation(from, to, expiration, options.targets);\n    return new DelegationChain(\n      [...(options.previous?.delegations || []), delegation],\n      options.previous?.publicKey || from.getPublicKey().toDer(),\n    );\n  }\n\n  /**\n   * Creates a DelegationChain object from a JSON string.\n   *\n   * @param json The JSON string to parse.\n   */\n  public static fromJSON(json: string | JsonnableDelegationChain): DelegationChain {\n    const { publicKey, delegations } = typeof json === 'string' ? JSON.parse(json) : json;\n    if (!Array.isArray(delegations)) {\n      throw new Error('Invalid delegations.');\n    }\n\n    const parsedDelegations: SignedDelegation[] = delegations.map(signedDelegation => {\n      const { delegation, signature } = signedDelegation;\n      const { pubkey, expiration, targets } = delegation;\n      if (targets !== undefined && !Array.isArray(targets)) {\n        throw new Error('Invalid targets.');\n      }\n\n      return {\n        delegation: new Delegation(\n          _parseBlob(pubkey),\n          BigInt(`0x${expiration}`), // expiration in JSON is an hexa string (See toJSON() below).\n          targets &&\n            targets.map((t: unknown) => {\n              if (typeof t !== 'string') {\n                throw new Error('Invalid target.');\n              }\n              return Principal.fromHex(t);\n            }),\n        ),\n        signature: _parseBlob(signature) as Signature,\n      };\n    });\n\n    return new this(parsedDelegations, _parseBlob(publicKey) as DerEncodedPublicKey);\n  }\n\n  /**\n   * Creates a DelegationChain object from a list of delegations and a DER-encoded public key.\n   *\n   * @param delegations The list of delegations.\n   * @param publicKey The DER-encoded public key of the key-pair signing the first delegation.\n   */\n  public static fromDelegations(\n    delegations: SignedDelegation[],\n    publicKey: DerEncodedPublicKey,\n  ): DelegationChain {\n    return new this(delegations, publicKey);\n  }\n\n  protected constructor(\n    public readonly delegations: SignedDelegation[],\n    public readonly publicKey: DerEncodedPublicKey,\n  ) {}\n\n  public toJSON(): JsonnableDelegationChain {\n    return {\n      delegations: this.delegations.map(signedDelegation => {\n        const { delegation, signature } = signedDelegation;\n        const { targets } = delegation;\n        return {\n          delegation: {\n            expiration: delegation.expiration.toString(16),\n            pubkey: toHexString(delegation.pubkey),\n            ...(targets && {\n              targets: targets.map(t => t.toHex()),\n            }),\n          },\n          signature: toHexString(signature),\n        };\n      }),\n      publicKey: toHexString(this.publicKey),\n    };\n  }\n}\n\n/**\n * An Identity that adds delegation to a request. Everywhere in this class, the name\n * innerKey refers to the SignIdentity that is being used to sign the requests, while\n * originalKey is the identity that is being borrowed. More identities can be used\n * in the middle to delegate.\n */\nexport class DelegationIdentity extends SignIdentity {\n  /**\n   * Create a delegation without having access to delegateKey.\n   *\n   * @param key The key used to sign the reqyests.\n   * @param delegation A delegation object created using `createDelegation`.\n   */\n  public static fromDelegation(\n    key: Pick<SignIdentity, 'sign'>,\n    delegation: DelegationChain,\n  ): DelegationIdentity {\n    return new this(key, delegation);\n  }\n\n  protected constructor(\n    private _inner: Pick<SignIdentity, 'sign'>,\n    private _delegation: DelegationChain,\n  ) {\n    super();\n  }\n\n  public getDelegation(): DelegationChain {\n    return this._delegation;\n  }\n\n  public getPublicKey(): PublicKey {\n    return {\n      toDer: () => this._delegation.publicKey,\n    };\n  }\n  public sign(blob: ArrayBuffer): Promise<Signature> {\n    return this._inner.sign(blob);\n  }\n\n  public async transformRequest(request: HttpAgentRequest): Promise<unknown> {\n    const { body, ...fields } = request;\n    const requestId = await requestIdOf(body);\n    return {\n      ...fields,\n      body: {\n        content: body,\n        sender_sig: await this.sign(\n          new Uint8Array([...requestDomainSeparator, ...new Uint8Array(requestId)]),\n        ),\n        sender_delegation: this._delegation.delegations,\n        sender_pubkey: this._delegation.publicKey,\n      },\n    };\n  }\n}\n\n/**\n * List of things to check for a delegation chain validity.\n */\nexport interface DelegationValidChecks {\n  /**\n   * Check that the scope is amongst the scopes that this delegation has access to.\n   */\n  scope?: Principal | string | Array<Principal | string>;\n}\n\n/**\n * Analyze a DelegationChain and validate that it's valid, ie. not expired and apply to the\n * scope.\n * @param chain The chain to validate.\n * @param checks Various checks to validate on the chain.\n */\nexport function isDelegationValid(chain: DelegationChain, checks?: DelegationValidChecks): boolean {\n  // Verify that the no delegation is expired. If any are in the chain, returns false.\n  for (const { delegation } of chain.delegations) {\n    // prettier-ignore\n    if (+new Date(Number(delegation.expiration / BigInt(1000000))) <= +Date.now()) {\n      return false;\n    }\n  }\n\n  // Check the scopes.\n  const scopes: Principal[] = [];\n  const maybeScope = checks?.scope;\n  if (maybeScope) {\n    if (Array.isArray(maybeScope)) {\n      scopes.push(...maybeScope.map(s => (typeof s === 'string' ? Principal.fromText(s) : s)));\n    } else {\n      scopes.push(typeof maybeScope === 'string' ? Principal.fromText(maybeScope) : maybeScope);\n    }\n  }\n\n  for (const s of scopes) {\n    const scope = s.toText();\n    for (const { delegation } of chain.delegations) {\n      if (delegation.targets === undefined) {\n        continue;\n      }\n\n      let none = true;\n      for (const target of delegation.targets) {\n        if (target.toText() === scope) {\n          none = false;\n          break;\n        }\n      }\n      if (none) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n", "import { DerEncodedPublicKey, PublicKey, Signature, SignIdentity } from '@dfinity/agent';\nimport borc from 'borc';\nimport * as tweetnacl from 'tweetnacl';\nimport { fromHexString, toHexString } from '../buffer';\nimport { DER_COSE_OID, wrapDER } from './der';\n\nfunction _coseToDerEncodedBlob(cose: ArrayBuffer): DerEncodedPublicKey {\n  return wrapDER(cose, DER_COSE_OID).buffer as DerEncodedPublicKey;\n}\n\ntype PublicKeyCredentialWithAttachment = PublicKeyCredential & {\n  // Extends `PublicKeyCredential` with an optional field introduced in the WebAuthn level 3 spec:\n  // https://w3c.github.io/webauthn/#dom-publickeycredential-authenticatorattachment\n  // Already supported by Chrome, Safari and Edge\n  // Note: `null` is included here as a possible value because Edge set this value to null in the\n  // past.\n  authenticatorAttachment: AuthenticatorAttachment | undefined | null;\n};\n\n/**\n * From the documentation;\n * The authData is a byte array described in the spec. Parsing it will involve slicing bytes from\n * the array and converting them into usable objects.\n *\n * See https://webauthn.guide/#registration (subsection \"Example: Parsing the authenticator data\").\n *\n * @param authData The authData field of the attestation response.\n * @returns The COSE key of the authData.\n */\nfunction _authDataToCose(authData: ArrayBuffer): ArrayBuffer {\n  const dataView = new DataView(new ArrayBuffer(2));\n  const idLenBytes = authData.slice(53, 55);\n  [...new Uint8Array(idLenBytes)].forEach((v, i) => dataView.setUint8(i, v));\n  const credentialIdLength = dataView.getUint16(0);\n\n  // Get the public key object.\n  return authData.slice(55 + credentialIdLength);\n}\n\nexport class CosePublicKey implements PublicKey {\n  protected _encodedKey: DerEncodedPublicKey;\n\n  public constructor(protected _cose: ArrayBuffer) {\n    this._encodedKey = _coseToDerEncodedBlob(_cose);\n  }\n\n  public toDer(): DerEncodedPublicKey {\n    return this._encodedKey;\n  }\n\n  public getCose(): ArrayBuffer {\n    return this._cose;\n  }\n}\n\n/**\n * Create a challenge from a string or array. The default challenge is always the same\n * because we don't need to verify the authenticity of the key on the server (we don't\n * register our keys with the IC). Any challenge would do, even one per key, randomly\n * generated.\n *\n * @param challenge The challenge to transform into a byte array. By default a hard\n *        coded string.\n */\nfunction _createChallengeBuffer(challenge: string | Uint8Array = '<ic0.app>'): Uint8Array {\n  if (typeof challenge === 'string') {\n    return Uint8Array.from(challenge, c => c.charCodeAt(0));\n  } else {\n    return challenge;\n  }\n}\n\n/**\n * Create a credentials to authenticate with a server. This is necessary in order in\n * WebAuthn to get credentials IDs (which give us the public key and allow us to\n * sign), but in the case of the Internet Computer, we don't actually need to register\n * it, so we don't.\n * @param credentialCreationOptions an optional CredentialCreationOptions object\n */\nasync function _createCredential(\n  credentialCreationOptions?: CredentialCreationOptions,\n): Promise<PublicKeyCredentialWithAttachment | null> {\n  const creds = (await navigator.credentials.create(\n    credentialCreationOptions ?? {\n      publicKey: {\n        authenticatorSelection: {\n          userVerification: 'preferred',\n        },\n        attestation: 'direct',\n        challenge: _createChallengeBuffer(),\n        pubKeyCredParams: [{ type: 'public-key', alg: PubKeyCoseAlgo.ECDSA_WITH_SHA256 }],\n        rp: {\n          name: 'Internet Identity Service',\n        },\n        user: {\n          id: tweetnacl.randomBytes(16),\n          name: 'Internet Identity',\n          displayName: 'Internet Identity',\n        },\n      },\n    },\n  )) as PublicKeyCredentialWithAttachment;\n\n  // Validate that it's the correct type at runtime, since WebAuthn does not HAVE to\n  // reply with a PublicKeyCredential.\n  if (creds.response === undefined || !(creds.rawId instanceof ArrayBuffer)) {\n    return null;\n  } else {\n    return creds;\n  }\n}\n\n// See https://www.iana.org/assignments/cose/cose.xhtml#algorithms for a complete\n// list of these algorithms. We only list the ones we support here.\nenum PubKeyCoseAlgo {\n  ECDSA_WITH_SHA256 = -7,\n}\n\n/**\n * A SignIdentity that uses `navigator.credentials`. See https://webauthn.guide/ for\n * more information about WebAuthentication.\n */\nexport class WebAuthnIdentity extends SignIdentity {\n  /**\n   * Create an identity from a JSON serialization.\n   * @param json - json to parse\n   */\n  public static fromJSON(json: string): WebAuthnIdentity {\n    const { publicKey, rawId } = JSON.parse(json);\n\n    if (typeof publicKey !== 'string' || typeof rawId !== 'string') {\n      throw new Error('Invalid JSON string.');\n    }\n\n    return new this(fromHexString(rawId), fromHexString(publicKey), undefined);\n  }\n\n  /**\n   * Create an identity.\n   * @param credentialCreationOptions an optional CredentialCreationOptions Challenge\n   */\n  public static async create(\n    credentialCreationOptions?: CredentialCreationOptions,\n  ): Promise<WebAuthnIdentity> {\n    const creds = await _createCredential(credentialCreationOptions);\n\n    if (!creds || creds.type !== 'public-key') {\n      throw new Error('Could not create credentials.');\n    }\n\n    const response = creds.response as AuthenticatorAttestationResponse;\n    if (!(response.attestationObject instanceof ArrayBuffer)) {\n      throw new Error('Was expecting an attestation response.');\n    }\n\n    // Parse the attestationObject as CBOR.\n    const attObject = borc.decodeFirst(new Uint8Array(response.attestationObject));\n\n    return new this(\n      creds.rawId,\n      _authDataToCose(attObject.authData),\n      creds.authenticatorAttachment ?? undefined,\n    );\n  }\n\n  protected _publicKey: CosePublicKey;\n\n  public constructor(\n    public readonly rawId: ArrayBuffer,\n    cose: ArrayBuffer,\n    protected authenticatorAttachment: AuthenticatorAttachment | undefined,\n  ) {\n    super();\n    this._publicKey = new CosePublicKey(cose);\n  }\n\n  public getPublicKey(): PublicKey {\n    return this._publicKey;\n  }\n\n  /**\n   * WebAuthn level 3 spec introduces a new attribute on successful WebAuthn interactions,\n   * see https://w3c.github.io/webauthn/#dom-publickeycredential-authenticatorattachment.\n   * This attribute is already implemented for Chrome, Safari and Edge.\n   *\n   * Given the attribute is only available after a successful interaction, the information is\n   * provided opportunistically and might also be `undefined`.\n   */\n  public getAuthenticatorAttachment(): AuthenticatorAttachment | undefined {\n    return this.authenticatorAttachment;\n  }\n\n  public async sign(blob: ArrayBuffer): Promise<Signature> {\n    const result = (await navigator.credentials.get({\n      publicKey: {\n        allowCredentials: [\n          {\n            type: 'public-key',\n            id: this.rawId,\n          },\n        ],\n        challenge: blob,\n        userVerification: 'preferred',\n      },\n    })) as PublicKeyCredentialWithAttachment;\n\n    if (result.authenticatorAttachment !== null) {\n      this.authenticatorAttachment = result.authenticatorAttachment;\n    }\n\n    const response = result.response as AuthenticatorAssertionResponse;\n    if (\n      response.signature instanceof ArrayBuffer &&\n      response.authenticatorData instanceof ArrayBuffer\n    ) {\n      const cbor = borc.encode(\n        new borc.Tagged(55799, {\n          authenticator_data: new Uint8Array(response.authenticatorData),\n          client_data_json: new TextDecoder().decode(response.clientDataJSON),\n          signature: new Uint8Array(response.signature),\n        }),\n      );\n      if (!cbor) {\n        throw new Error('failed to encode cbor');\n      }\n      return cbor.buffer as Signature;\n    } else {\n      throw new Error('Invalid response from WebAuthn.');\n    }\n  }\n\n  /**\n   * Allow for JSON serialization of all information needed to reuse this identity.\n   */\n  public toJSON(): JsonnableWebAuthnIdentitiy {\n    return {\n      publicKey: toHexString(this._publicKey.getCose()),\n      rawId: toHexString(this.rawId),\n    };\n  }\n}\n\n/**\n * ReturnType<WebAuthnIdentity.toJSON>\n */\nexport interface JsonnableWebAuthnIdentitiy {\n  // The hexadecimal representation of the DER encoded public key.\n  publicKey: string;\n  // The string representation of the local WebAuthn Credential.id (base64url encoded).\n  rawId: string;\n}\n", "/** @module IdleManager */\ntype IdleCB = () => unknown;\nexport type IdleManagerOptions = {\n  /**\n   * Callback after the user has gone idle\n   */\n  onIdle?: IdleCB;\n  /**\n   * timeout in ms\n   * @default 30 minutes [600_000]\n   */\n  idleTimeout?: number;\n  /**\n   * capture scroll events\n   * @default false\n   */\n  captureScroll?: boolean;\n  /**\n   * scroll debounce time in ms\n   * @default 100\n   */\n  scrollDebounce?: number;\n};\n\nconst events = ['mousedown', 'mousemove', 'keydown', 'touchstart', 'wheel'];\n\n/**\n * Detects if the user has been idle for a duration of `idleTimeout` ms, and calls `onIdle` and registered callbacks.\n * By default, the IdleManager will log a user out after 10 minutes of inactivity.\n * To override these defaults, you can pass an `onIdle` callback, or configure a custom `idleTimeout` in milliseconds\n */\nexport class IdleManager {\n  callbacks: IdleCB[] = [];\n  idleTimeout: IdleManagerOptions['idleTimeout'] = 10 * 60 * 1000;\n  timeoutID?: number = undefined;\n\n  /**\n   * Creates an {@link IdleManager}\n   * @param {IdleManagerOptions} options Optional configuration\n   * @see {@link IdleManagerOptions}\n   * @param options.onIdle Callback once user has been idle. Use to prompt for fresh login, and use `Actor.agentOf(your_actor).invalidateIdentity()` to protect the user\n   * @param options.idleTimeout timeout in ms\n   * @param options.captureScroll capture scroll events\n   * @param options.scrollDebounce scroll debounce time in ms\n   */\n  public static create(\n    options: {\n      /**\n       * Callback after the user has gone idle\n       * @see {@link IdleCB}\n       */\n      onIdle?: () => unknown;\n      /**\n       * timeout in ms\n       * @default 10 minutes [600_000]\n       */\n      idleTimeout?: number;\n      /**\n       * capture scroll events\n       * @default false\n       */\n      captureScroll?: boolean;\n      /**\n       * scroll debounce time in ms\n       * @default 100\n       */\n      scrollDebounce?: number;\n    } = {},\n  ): IdleManager {\n    return new this(options);\n  }\n\n  /**\n   * @protected\n   * @param options {@link IdleManagerOptions}\n   */\n  protected constructor(options: IdleManagerOptions = {}) {\n    const { onIdle, idleTimeout = 10 * 60 * 1000 } = options || {};\n\n    this.callbacks = onIdle ? [onIdle] : [];\n    this.idleTimeout = idleTimeout;\n\n    const _resetTimer = this._resetTimer.bind(this);\n\n    window.addEventListener('load', _resetTimer, true);\n\n    events.forEach(function (name) {\n      document.addEventListener(name, _resetTimer, true);\n    });\n\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    const debounce = (func: Function, wait: number) => {\n      let timeout: number | undefined;\n      return (...args: unknown[]) => {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const context = this;\n        const later = function () {\n          timeout = undefined;\n          func.apply(context, args);\n        };\n        clearTimeout(timeout);\n        timeout = window.setTimeout(later, wait);\n      };\n    };\n\n    if (options?.captureScroll) {\n      // debounce scroll events\n      const scroll = debounce(_resetTimer, options?.scrollDebounce ?? 100);\n      window.addEventListener('scroll', scroll, true);\n    }\n\n    _resetTimer();\n  }\n\n  /**\n   * @param {IdleCB} callback function to be called when user goes idle\n   */\n  public registerCallback(callback: IdleCB): void {\n    this.callbacks.push(callback);\n  }\n\n  /**\n   * Cleans up the idle manager and its listeners\n   */\n  public exit(): void {\n    clearTimeout(this.timeoutID);\n    window.removeEventListener('load', this._resetTimer, true);\n\n    const _resetTimer = this._resetTimer.bind(this);\n    events.forEach(function (name) {\n      document.removeEventListener(name, _resetTimer, true);\n    });\n    this.callbacks.forEach(cb => cb());\n  }\n\n  /**\n   * Resets the timeouts during cleanup\n   */\n  _resetTimer(): void {\n    const exit = this.exit.bind(this);\n    window.clearTimeout(this.timeoutID);\n    this.timeoutID = window.setTimeout(exit, this.idleTimeout);\n  }\n}\n", "const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n", "import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n", "import { openDB, IDBPDatabase } from 'idb';\nimport { isBrowser, KEY_STORAGE_DELEGATION, KEY_STORAGE_KEY } from './storage';\n\ntype Database = IDBPDatabase<unknown>;\ntype IDBValidKey = string | number | Date | BufferSource | IDBValidKey[];\nconst AUTH_DB_NAME = 'auth-client-db';\nconst OBJECT_STORE_NAME = 'ic-keyval';\n\nconst _openDbStore = async (\n  dbName = AUTH_DB_NAME,\n  storeName = OBJECT_STORE_NAME,\n  version: number,\n) => {\n  // Clear legacy stored delegations\n  if (isBrowser && localStorage?.getItem(KEY_STORAGE_DELEGATION)) {\n    localStorage.removeItem(KEY_STORAGE_DELEGATION);\n    localStorage.removeItem(KEY_STORAGE_KEY);\n  }\n  return await openDB(dbName, version, {\n    upgrade: database => {\n      database.objectStoreNames;\n      if (database.objectStoreNames.contains(storeName)) {\n        database.clear(storeName);\n      }\n      database.createObjectStore(storeName);\n    },\n  });\n};\n\nasync function _getValue<T>(\n  db: Database,\n  storeName: string,\n  key: IDBValidKey,\n): Promise<T | undefined> {\n  return await db.get(storeName, key);\n}\n\nasync function _setValue<T>(\n  db: Database,\n  storeName: string,\n  key: IDBValidKey,\n  value: T,\n): Promise<IDBValidKey> {\n  return await db.put(storeName, value, key);\n}\n\nasync function _removeValue(db: Database, storeName: string, key: IDBValidKey): Promise<void> {\n  return await db.delete(storeName, key);\n}\n\nexport type DBCreateOptions = {\n  dbName?: string;\n  storeName?: string;\n  version?: number;\n};\n\n/**\n * Simple Key Value store\n * Defaults to `'auth-client-db'` with an object store of `'ic-keyval'`\n */\nexport class IdbKeyVal {\n  /**\n   *\n   * @param {DBCreateOptions} options {@link DbCreateOptions}\n   * @param {DBCreateOptions['dbName']} options.dbName name for the indexeddb database\n   * @default 'auth-client-db'\n   * @param {DBCreateOptions['storeName']} options.storeName name for the indexeddb Data Store\n   * @default 'ic-keyval'\n   * @param {DBCreateOptions['version']} options.version version of the database. Increment to safely upgrade\n   * @constructs an {@link IdbKeyVal}\n   */\n  public static async create(options?: DBCreateOptions): Promise<IdbKeyVal> {\n    const { dbName = AUTH_DB_NAME, storeName = OBJECT_STORE_NAME, version = 1 } = options ?? {};\n    const db = await _openDbStore(dbName, storeName, version);\n    return new IdbKeyVal(db, storeName);\n  }\n\n  // Do not use - instead prefer create\n  private constructor(private _db: Database, private _storeName: string) {}\n\n  /**\n   * Basic setter\n   * @param {IDBValidKey} key string | number | Date | BufferSource | IDBValidKey[]\n   * @param value value to set\n   * @returns void\n   */\n  public async set<T>(key: IDBValidKey, value: T) {\n    return await _setValue<T>(this._db, this._storeName, key, value);\n  }\n  /**\n   * Basic getter\n   * Pass in a type T for type safety if you know the type the value will have if it is found\n   * @param {IDBValidKey} key string | number | Date | BufferSource | IDBValidKey[]\n   * @returns `Promise<T | null>`\n   * @example\n   * await get<string>('exampleKey') -> 'exampleValue'\n   */\n  public async get<T>(key: IDBValidKey): Promise<T | null> {\n    return (await _getValue<T>(this._db, this._storeName, key)) ?? null;\n  }\n\n  /**\n   * Remove a key\n   * @param key {@link IDBValidKey}\n   * @returns void\n   */\n  public async remove(key: IDBValidKey) {\n    return await _removeValue(this._db, this._storeName, key);\n  }\n}\n", "import { IdbKeyVal } from './db';\n\nexport const KEY_STORAGE_KEY = 'identity';\nexport const KEY_STORAGE_DELEGATION = 'delegation';\nexport const KEY_VECTOR = 'iv';\n// Increment if any fields are modified\nexport const DB_VERSION = 1;\n\nexport const isBrowser = typeof window !== 'undefined';\n\nexport type StoredKey = string | CryptoKeyPair;\n\n/**\n * Interface for persisting user authentication data\n */\nexport interface AuthClientStorage {\n  get(key: string): Promise<StoredKey | null>;\n\n  set(key: string, value: StoredKey): Promise<void>;\n\n  remove(key: string): Promise<void>;\n}\n\n/**\n * Legacy implementation of AuthClientStorage, for use where IndexedDb is not available\n */\nexport class LocalStorage implements AuthClientStorage {\n  constructor(public readonly prefix = 'ic-', private readonly _localStorage?: Storage) {}\n\n  public get(key: string): Promise<string | null> {\n    return Promise.resolve(this._getLocalStorage().getItem(this.prefix + key));\n  }\n\n  public set(key: string, value: string): Promise<void> {\n    this._getLocalStorage().setItem(this.prefix + key, value);\n    return Promise.resolve();\n  }\n\n  public remove(key: string): Promise<void> {\n    this._getLocalStorage().removeItem(this.prefix + key);\n    return Promise.resolve();\n  }\n\n  private _getLocalStorage() {\n    if (this._localStorage) {\n      return this._localStorage;\n    }\n\n    const ls =\n      typeof window === 'undefined'\n        ? typeof global === 'undefined'\n          ? typeof self === 'undefined'\n            ? undefined\n            : self.localStorage\n          : global.localStorage\n        : window.localStorage;\n\n    if (!ls) {\n      throw new Error('Could not find local storage.');\n    }\n\n    return ls;\n  }\n}\n\n/**\n * IdbStorage is an interface for simple storage of string key-value pairs built on {@link IdbKeyVal}\n *\n * It replaces {@link LocalStorage}\n * @see implements {@link AuthClientStorage}\n */\nexport class IdbStorage implements AuthClientStorage {\n  // Initializes a KeyVal on first request\n  private initializedDb: IdbKeyVal | undefined;\n  get _db(): Promise<IdbKeyVal> {\n    return new Promise(resolve => {\n      if (this.initializedDb) {\n        resolve(this.initializedDb);\n        return;\n      }\n      IdbKeyVal.create({ version: DB_VERSION }).then(db => {\n        this.initializedDb = db;\n        resolve(db);\n      });\n    });\n  }\n\n  public async get(key: string): Promise<string | null> {\n    const db = await this._db;\n    return await db.get<string>(key);\n    // return (await db.get<string>(key)) ?? null;\n  }\n\n  public async set(key: string, value: string): Promise<void> {\n    const db = await this._db;\n    await db.set(key, value);\n  }\n\n  public async remove(key: string): Promise<void> {\n    const db = await this._db;\n    await db.remove(key);\n  }\n}\n", "/** @module AuthClient */\nimport {\n  AnonymousIdentity,\n  DerEncodedPublicKey,\n  Identity,\n  Signature,\n  SignIdentity,\n} from '@dfinity/agent';\nimport {\n  Delegation,\n  DelegationChain,\n  isDelegationValid,\n  DelegationIdentity,\n  Ed25519KeyIdentity,\n  ECDSAKeyIdentity,\n} from '@dfinity/identity';\nimport { Principal } from '@dfinity/principal';\nimport { IdleManager, IdleManagerOptions } from './idleManager';\nimport {\n  AuthClientStorage,\n  IdbStorage,\n  isBrowser,\n  KEY_STORAGE_DELEGATION,\n  KEY_STORAGE_KEY,\n  KEY_VECTOR,\n  LocalStorage,\n} from './storage';\n\nexport { IdbStorage, LocalStorage, KEY_STORAGE_DELEGATION, KEY_STORAGE_KEY } from './storage';\nexport { IdbKeyVal, DBCreateOptions } from './db';\n\nconst IDENTITY_PROVIDER_DEFAULT = 'https://identity.ic0.app';\nconst IDENTITY_PROVIDER_ENDPOINT = '#authorize';\n\nconst ECDSA_KEY_LABEL = 'ECDSA';\nconst ED25519_KEY_LABEL = 'Ed25519';\ntype BaseKeyType = typeof ECDSA_KEY_LABEL | typeof ED25519_KEY_LABEL;\n\nconst INTERRUPT_CHECK_INTERVAL = 500;\n\nexport const ERROR_USER_INTERRUPT = 'UserInterrupt';\n\n/**\n * List of options for creating an {@link AuthClient}.\n */\nexport interface AuthClientCreateOptions {\n  /**\n   * An identity to use as the base\n   */\n  identity?: SignIdentity | ECDSAKeyIdentity;\n  /**\n   * Optional storage with get, set, and remove. Uses {@link IdbStorage} by default\n   */\n  storage?: AuthClientStorage;\n  /**\n   * type to use for the base key\n   * @default 'ECDSA'\n   * If you are using a custom storage provider that does not support CryptoKey storage,\n   * you should use 'Ed25519' as the key type, as it can serialize to a string\n   */\n  keyType?: BaseKeyType;\n\n  /**\n   * Options to handle idle timeouts\n   * @default after 30 minutes, invalidates the identity\n   */\n  idleOptions?: IdleOptions;\n}\n\nexport interface IdleOptions extends IdleManagerOptions {\n  /**\n   * Disables idle functionality for {@link IdleManager}\n   * @default false\n   */\n  disableIdle?: boolean;\n\n  /**\n   * Disables default idle behavior - call logout & reload window\n   * @default false\n   */\n  disableDefaultIdleCallback?: boolean;\n}\n\nexport * from './idleManager';\n\nexport interface AuthClientLoginOptions {\n  /**\n   * Identity provider\n   * @default \"https://identity.ic0.app\"\n   */\n  identityProvider?: string | URL;\n  /**\n   * Expiration of the authentication in nanoseconds\n   * @default  BigInt(8) hours * BigInt(3_600_000_000_000) nanoseconds\n   */\n  maxTimeToLive?: bigint;\n  /**\n   * Origin for Identity Provider to use while generating the delegated identity. For II, the derivation origin must authorize this origin by setting a record at `<derivation-origin>/.well-known/ii-alternative-origins`.\n   * @see https://github.com/dfinity/internet-identity/blob/main/docs/internet-identity-spec.adoc\n   */\n  derivationOrigin?: string | URL;\n  /**\n   * Auth Window feature config string\n   * @example \"toolbar=0,location=0,menubar=0,width=500,height=500,left=100,top=100\"\n   */\n  windowOpenerFeatures?: string;\n  /**\n   * Callback once login has completed\n   */\n  onSuccess?: (() => void) | (() => Promise<void>);\n  /**\n   * Callback in case authentication fails\n   */\n  onError?: ((error?: string) => void) | ((error?: string) => Promise<void>);\n}\n\ninterface InternetIdentityAuthRequest {\n  kind: 'authorize-client';\n  sessionPublicKey: Uint8Array;\n  maxTimeToLive?: bigint;\n  derivationOrigin?: string;\n}\n\ninterface InternetIdentityAuthResponseSuccess {\n  kind: 'authorize-client-success';\n  delegations: {\n    delegation: {\n      pubkey: Uint8Array;\n      expiration: bigint;\n      targets?: Principal[];\n    };\n    signature: Uint8Array;\n  }[];\n  userPublicKey: Uint8Array;\n}\n\ninterface AuthReadyMessage {\n  kind: 'authorize-ready';\n}\n\ninterface AuthResponseSuccess {\n  kind: 'authorize-client-success';\n  delegations: {\n    delegation: {\n      pubkey: Uint8Array;\n      expiration: bigint;\n      targets?: Principal[];\n    };\n    signature: Uint8Array;\n  }[];\n  userPublicKey: Uint8Array;\n}\n\ninterface AuthResponseFailure {\n  kind: 'authorize-client-failure';\n  text: string;\n}\n\ntype IdentityServiceResponseMessage = AuthReadyMessage | AuthResponse;\ntype AuthResponse = AuthResponseSuccess | AuthResponseFailure;\n\n/**\n * Tool to manage authentication and identity\n * @see {@link AuthClient}\n */\nexport class AuthClient {\n  /**\n   * Create an AuthClient to manage authentication and identity\n   * @constructs {@link AuthClient}\n   * @param {AuthClientCreateOptions} options\n   * @see {@link AuthClientCreateOptions}\n   * @param options.identity Optional Identity to use as the base\n   * @see {@link SignIdentity}\n   * @param options.storage Storage mechanism for delegration credentials\n   * @see {@link AuthClientStorage}\n   * @param options.keyType Type of key to use for the base key\n   * @param {IdleOptions} options.idleOptions Configures an {@link IdleManager}\n   * @see {@link IdleOptions}\n   * Default behavior is to clear stored identity and reload the page when a user goes idle, unless you set the disableDefaultIdleCallback flag or pass in a custom idle callback.\n   * @example\n   * const authClient = await AuthClient.create({\n   *   idleOptions: {\n   *     disableIdle: true\n   *   }\n   * })\n   */\n  public static async create(\n    options: {\n      /**\n       * An {@link Identity} to use as the base.\n       *  By default, a new {@link AnonymousIdentity}\n       */\n      identity?: SignIdentity;\n      /**\n       * {@link AuthClientStorage}\n       * @description Optional storage with get, set, and remove. Uses {@link IdbStorage} by default\n       */\n      storage?: AuthClientStorage;\n      /**\n       * type to use for the base key\n       * @default 'ECDSA'\n       * If you are using a custom storage provider that does not support CryptoKey storage,\n       * you should use 'Ed25519' as the key type, as it can serialize to a string\n       */\n      keyType?: BaseKeyType;\n      /**\n       * Options to handle idle timeouts\n       * @default after 10 minutes, invalidates the identity\n       */\n      idleOptions?: IdleOptions;\n    } = {},\n  ): Promise<AuthClient> {\n    const storage = options.storage ?? new IdbStorage();\n    const keyType = options.keyType ?? ECDSA_KEY_LABEL;\n\n    let key: null | SignIdentity | ECDSAKeyIdentity = null;\n    if (options.identity) {\n      key = options.identity;\n    } else {\n      let maybeIdentityStorage = await storage.get(KEY_STORAGE_KEY);\n      if (!maybeIdentityStorage && isBrowser) {\n        // Attempt to migrate from localstorage\n        try {\n          const fallbackLocalStorage = new LocalStorage();\n          const localChain = await fallbackLocalStorage.get(KEY_STORAGE_DELEGATION);\n          const localKey = await fallbackLocalStorage.get(KEY_STORAGE_KEY);\n          // not relevant for Ed25519\n          if (localChain && localKey && keyType === ECDSA_KEY_LABEL) {\n            console.log('Discovered an identity stored in localstorage. Migrating to IndexedDB');\n            await storage.set(KEY_STORAGE_DELEGATION, localChain);\n            await storage.set(KEY_STORAGE_KEY, localKey);\n\n            maybeIdentityStorage = localChain;\n            // clean up\n            await fallbackLocalStorage.remove(KEY_STORAGE_DELEGATION);\n            await fallbackLocalStorage.remove(KEY_STORAGE_KEY);\n          }\n        } catch (error) {\n          console.error('error while attempting to recover localstorage: ' + error);\n        }\n      }\n      if (maybeIdentityStorage) {\n        try {\n          if (typeof maybeIdentityStorage === 'object') {\n            if (keyType === ED25519_KEY_LABEL && typeof maybeIdentityStorage === 'string') {\n              key = await Ed25519KeyIdentity.fromJSON(maybeIdentityStorage);\n            } else {\n              key = await ECDSAKeyIdentity.fromKeyPair(maybeIdentityStorage);\n            }\n          } else if (typeof maybeIdentityStorage === 'string') {\n            // This is a legacy identity, which is a serialized Ed25519KeyIdentity.\n            key = Ed25519KeyIdentity.fromJSON(maybeIdentityStorage);\n          }\n        } catch (e) {\n          // Ignore this, this means that the localStorage value isn't a valid Ed25519KeyIdentity or ECDSAKeyIdentity\n          // serialization.\n        }\n      }\n    }\n\n    let identity = new AnonymousIdentity();\n    let chain: null | DelegationChain = null;\n    if (key) {\n      try {\n        const chainStorage = await storage.get(KEY_STORAGE_DELEGATION);\n        if (typeof chainStorage === 'object' && chainStorage !== null) {\n          throw new Error(\n            'Delegation chain is incorrectly stored. A delegation chain should be stored as a string.',\n          );\n        }\n\n        if (options.identity) {\n          identity = options.identity;\n        } else if (chainStorage) {\n          chain = DelegationChain.fromJSON(chainStorage);\n\n          // Verify that the delegation isn't expired.\n          if (!isDelegationValid(chain)) {\n            await _deleteStorage(storage);\n            key = null;\n          } else {\n            identity = DelegationIdentity.fromDelegation(key, chain);\n          }\n        }\n      } catch (e) {\n        console.error(e);\n        // If there was a problem loading the chain, delete the key.\n        await _deleteStorage(storage);\n        key = null;\n      }\n    }\n    let idleManager: IdleManager | undefined = undefined;\n    if (options.idleOptions?.disableIdle) {\n      idleManager = undefined;\n    }\n    // if there is a delegation chain or provided identity, setup idleManager\n    else if (chain || options.identity) {\n      idleManager = IdleManager.create(options.idleOptions);\n    }\n\n    if (!key) {\n      // Create a new key (whether or not one was in storage).\n      if (keyType === ED25519_KEY_LABEL) {\n        key = await Ed25519KeyIdentity.generate();\n        await storage.set(KEY_STORAGE_KEY, JSON.stringify((key as Ed25519KeyIdentity).toJSON()));\n      } else {\n        if (options.storage && keyType === ECDSA_KEY_LABEL) {\n          console.warn(\n            `You are using a custom storage provider that may not support CryptoKey storage. If you are using a custom storage provider that does not support CryptoKey storage, you should use '${ED25519_KEY_LABEL}' as the key type, as it can serialize to a string`,\n          );\n        }\n        key = await ECDSAKeyIdentity.generate();\n        await storage.set(KEY_STORAGE_KEY, (key as ECDSAKeyIdentity).getKeyPair());\n      }\n    }\n\n    return new this(identity, key, chain, storage, idleManager, options);\n  }\n\n  protected constructor(\n    private _identity: Identity,\n    private _key: SignIdentity,\n    private _chain: DelegationChain | null,\n    private _storage: AuthClientStorage,\n    public idleManager: IdleManager | undefined,\n    private _createOptions: AuthClientCreateOptions | undefined,\n    // A handle on the IdP window.\n    private _idpWindow?: Window,\n    // The event handler for processing events from the IdP.\n    private _eventHandler?: (event: MessageEvent) => void,\n  ) {\n    const logout = this.logout.bind(this);\n    const idleOptions = _createOptions?.idleOptions;\n    /**\n     * Default behavior is to clear stored identity and reload the page.\n     * By either setting the disableDefaultIdleCallback flag or passing in a custom idle callback, we will ignore this config\n     */\n    if (!idleOptions?.onIdle && !idleOptions?.disableDefaultIdleCallback) {\n      this.idleManager?.registerCallback(() => {\n        logout();\n        location.reload();\n      });\n    }\n  }\n\n  private _handleSuccess(message: InternetIdentityAuthResponseSuccess, onSuccess?: () => void) {\n    const delegations = message.delegations.map(signedDelegation => {\n      return {\n        delegation: new Delegation(\n          signedDelegation.delegation.pubkey,\n          signedDelegation.delegation.expiration,\n          signedDelegation.delegation.targets,\n        ),\n        signature: signedDelegation.signature.buffer as Signature,\n      };\n    });\n\n    const delegationChain = DelegationChain.fromDelegations(\n      delegations,\n      message.userPublicKey.buffer as DerEncodedPublicKey,\n    );\n\n    const key = this._key;\n    if (!key) {\n      return;\n    }\n\n    this._chain = delegationChain;\n    this._identity = DelegationIdentity.fromDelegation(key, this._chain);\n\n    this._idpWindow?.close();\n    if (!this.idleManager) {\n      const idleOptions = this._createOptions?.idleOptions;\n      this.idleManager = IdleManager.create(idleOptions);\n\n      if (!idleOptions?.onIdle && !idleOptions?.disableDefaultIdleCallback) {\n        this.idleManager?.registerCallback(() => {\n          this.logout();\n          location.reload();\n        });\n      }\n    }\n    onSuccess?.();\n    this._removeEventListener();\n    delete this._idpWindow;\n  }\n\n  public getIdentity(): Identity {\n    return this._identity;\n  }\n\n  public async isAuthenticated(): Promise<boolean> {\n    return !this.getIdentity().getPrincipal().isAnonymous() && this._chain !== null;\n  }\n\n  /**\n   * AuthClient Login -\n   * Opens up a new window to authenticate with Internet Identity\n   * @param {AuthClientLoginOptions} options\n   * @param options.identityProvider Identity provider\n   * @param options.maxTimeToLive Expiration of the authentication in nanoseconds\n   * @param options.derivationOrigin Origin for Identity Provider to use while generating the delegated identity\n   * @param options.windowOpenerFeatures Configures the opened authentication window\n   * @param options.onSuccess Callback once login has completed\n   * @param options.onError Callback in case authentication fails\n   * @example\n   * const authClient = await AuthClient.create();\n   * authClient.login({\n   *  identityProvider: 'http://<canisterID>.localhost:8000',\n   *  maxTimeToLive: BigInt (7) * BigInt(24) * BigInt(3_600_000_000_000), // 1 week\n   *  windowOpenerFeatures: \"toolbar=0,location=0,menubar=0,width=500,height=500,left=100,top=100\",\n   *  onSuccess: () => {\n   *    console.log('Login Successful!');\n   *  },\n   *  onError: (error) => {\n   *    console.error('Login Failed: ', error);\n   *  }\n   * });\n   */\n  public async login(options?: {\n    /**\n     * Identity provider\n     * @default \"https://identity.ic0.app\"\n     */\n    identityProvider?: string | URL;\n    /**\n     * Expiration of the authentication in nanoseconds\n     * @default  BigInt(8) hours * BigInt(3_600_000_000_000) nanoseconds\n     */\n    maxTimeToLive?: bigint;\n    /**\n     * Auth Window feature config string\n     * @example \"toolbar=0,location=0,menubar=0,width=500,height=500,left=100,top=100\"\n     */\n    /**\n     * Origin for Identity Provider to use while generating the delegated identity. For II, the derivation origin must authorize this origin by setting a record at `<derivation-origin>/.well-known/ii-alternative-origins`.\n     * @see https://github.com/dfinity/internet-identity/blob/main/docs/internet-identity-spec.adoc\n     */\n    derivationOrigin?: string | URL;\n    windowOpenerFeatures?: string;\n    /**\n     * Callback once login has completed\n     */\n    onSuccess?: (() => void) | (() => Promise<void>);\n    /**\n     * Callback in case authentication fails\n     */\n    onError?: ((error?: string) => void) | ((error?: string) => Promise<void>);\n  }): Promise<void> {\n    // Set default maxTimeToLive to 8 hours\n    const defaultTimeToLive = /* hours */ BigInt(8) * /* nanoseconds */ BigInt(3_600_000_000_000);\n\n    // Create the URL of the IDP. (e.g. https://XXXX/#authorize)\n    const identityProviderUrl = new URL(\n      options?.identityProvider?.toString() || IDENTITY_PROVIDER_DEFAULT,\n    );\n    // Set the correct hash if it isn't already set.\n    identityProviderUrl.hash = IDENTITY_PROVIDER_ENDPOINT;\n\n    // If `login` has been called previously, then close/remove any previous windows\n    // and event listeners.\n    this._idpWindow?.close();\n    this._removeEventListener();\n\n    // Add an event listener to handle responses.\n    this._eventHandler = this._getEventHandler(identityProviderUrl, {\n      maxTimeToLive: options?.maxTimeToLive ?? defaultTimeToLive,\n      ...options,\n    });\n    window.addEventListener('message', this._eventHandler);\n\n    // Open a new window with the IDP provider.\n    this._idpWindow =\n      window.open(identityProviderUrl.toString(), 'idpWindow', options?.windowOpenerFeatures) ??\n      undefined;\n\n    // Check if the _idpWindow is closed by user.\n    const checkInterruption = (): void => {\n      // The _idpWindow is opened and not yet closed by the client\n      if (this._idpWindow) {\n        if (this._idpWindow.closed) {\n          this._handleFailure(ERROR_USER_INTERRUPT, options?.onError);\n        } else {\n          setTimeout(checkInterruption, INTERRUPT_CHECK_INTERVAL);\n        }\n      }\n    };\n    checkInterruption();\n  }\n\n  private _getEventHandler(identityProviderUrl: URL, options?: AuthClientLoginOptions) {\n    return async (event: MessageEvent) => {\n      if (event.origin !== identityProviderUrl.origin) {\n        console.warn(\n          `WARNING: expected origin '${identityProviderUrl.origin}', got '${event.origin}' (ignoring)`,\n        );\n        return;\n      }\n\n      const message = event.data as IdentityServiceResponseMessage;\n\n      switch (message.kind) {\n        case 'authorize-ready': {\n          // IDP is ready. Send a message to request authorization.\n          const request: InternetIdentityAuthRequest = {\n            kind: 'authorize-client',\n            sessionPublicKey: new Uint8Array(this._key?.getPublicKey().toDer() as ArrayBuffer),\n            maxTimeToLive: options?.maxTimeToLive,\n            derivationOrigin: options?.derivationOrigin?.toString(),\n          };\n          this._idpWindow?.postMessage(request, identityProviderUrl.origin);\n          break;\n        }\n        case 'authorize-client-success':\n          // Create the delegation chain and store it.\n          try {\n            this._handleSuccess(message, options?.onSuccess);\n\n            // Setting the storage is moved out of _handleSuccess to make\n            // it a sync function. Having _handleSuccess as an async function\n            // messes up the jest tests for some reason.\n            if (this._chain) {\n              await this._storage.set(KEY_STORAGE_DELEGATION, JSON.stringify(this._chain.toJSON()));\n            }\n          } catch (err) {\n            this._handleFailure((err as Error).message, options?.onError);\n          }\n          break;\n        case 'authorize-client-failure':\n          this._handleFailure(message.text, options?.onError);\n          break;\n        default:\n          break;\n      }\n    };\n  }\n\n  private _handleFailure(errorMessage?: string, onError?: (error?: string) => void): void {\n    this._idpWindow?.close();\n    onError?.(errorMessage);\n    this._removeEventListener();\n    delete this._idpWindow;\n  }\n\n  private _removeEventListener() {\n    if (this._eventHandler) {\n      window.removeEventListener('message', this._eventHandler);\n    }\n    this._eventHandler = undefined;\n  }\n\n  public async logout(options: { returnTo?: string } = {}): Promise<void> {\n    await _deleteStorage(this._storage);\n\n    // Reset this auth client to a non-authenticated state.\n    this._identity = new AnonymousIdentity();\n    this._chain = null;\n\n    if (options.returnTo) {\n      try {\n        window.history.pushState({}, '', options.returnTo);\n      } catch (e) {\n        window.location.href = options.returnTo;\n      }\n    }\n  }\n}\n\nasync function _deleteStorage(storage: AuthClientStorage) {\n  await storage.remove(KEY_STORAGE_KEY);\n  await storage.remove(KEY_STORAGE_DELEGATION);\n  await storage.remove(KEY_VECTOR);\n}\n", "import {AuthClient} from '@dfinity/auth-client';\n\nexport const createAuthClient = (): Promise<AuthClient> =>\n  AuthClient.create({\n    idleOptions: {\n      disableIdle: true,\n      disableDefaultIdleCallback: true\n    }\n  });\n", "import {fromArray} from '@junobuild/utils';\nimport type {Doc} from '../../declarations/satellite/satellite.did';\n\nexport const mapData = async <D>({data}: Pick<Doc, 'data'>): Promise<D> => {\n  try {\n    return await fromArray<D>(data);\n  } catch (err: unknown) {\n    console.error('The data parsing has failed, mapping to undefined as a fallback.', err);\n    return undefined as D;\n  }\n};\n", "import {Principal} from '@dfinity/principal';\nimport {isNullish, toNullable} from '@junobuild/utils';\nimport type {ListParams as ListParamsApi} from '../../declarations/satellite/satellite.did';\nimport type {ListParams} from '../types/list.types';\n\nexport const toListParams = ({matcher, paginate, order, owner}: ListParams): ListParamsApi => ({\n  matcher: isNullish(matcher)\n    ? []\n    : [\n        {\n          key: toNullable(matcher.key),\n          description: toNullable(matcher.description)\n        }\n      ],\n  paginate: toNullable(\n    isNullish(paginate)\n      ? undefined\n      : {\n          start_after: toNullable(paginate.startAfter),\n          limit: toNullable(isNullish(paginate.limit) ? undefined : BigInt(paginate.limit))\n        }\n  ),\n  order: toNullable(\n    isNullish(order)\n      ? undefined\n      : {\n          desc: order.desc,\n          field:\n            order.field === 'created_at'\n              ? {CreatedAt: null}\n              : order.field === 'updated_at'\n              ? {UpdatedAt: null}\n              : {Keys: null}\n        }\n  ),\n  owner: toNullable(\n    isNullish(owner) ? undefined : typeof owner === 'string' ? Principal.fromText(owner) : owner\n  )\n});\n", "// @ts-ignore\nexport const idlFactory = ({IDL}) => {\n  const CommitBatch = IDL.Record({\n    batch_id: IDL.Nat,\n    headers: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text)),\n    chunk_ids: IDL.Vec(IDL.Nat)\n  });\n  const DeleteControllersArgs = IDL.Record({\n    controllers: IDL.Vec(IDL.Principal)\n  });\n  const ControllerScope = IDL.Variant({\n    Write: IDL.Null,\n    Admin: IDL.Null\n  });\n  const Controller = IDL.Record({\n    updated_at: IDL.Nat64,\n    metadata: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text)),\n    created_at: IDL.Nat64,\n    scope: ControllerScope,\n    expires_at: IDL.Opt(IDL.Nat64)\n  });\n  const DelDoc = IDL.Record({updated_at: IDL.Opt(IDL.Nat64)});\n  const RulesType = IDL.Variant({Db: IDL.Null, Storage: IDL.Null});\n  const StorageConfig = IDL.Record({\n    rewrites: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text)),\n    headers: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text))))\n  });\n  const Config = IDL.Record({storage: StorageConfig});\n  const Doc = IDL.Record({\n    updated_at: IDL.Nat64,\n    owner: IDL.Principal,\n    data: IDL.Vec(IDL.Nat8),\n    description: IDL.Opt(IDL.Text),\n    created_at: IDL.Nat64\n  });\n  const HttpRequest = IDL.Record({\n    url: IDL.Text,\n    method: IDL.Text,\n    body: IDL.Vec(IDL.Nat8),\n    headers: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text))\n  });\n  const StreamingCallbackToken = IDL.Record({\n    token: IDL.Opt(IDL.Text),\n    sha256: IDL.Opt(IDL.Vec(IDL.Nat8)),\n    headers: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text)),\n    index: IDL.Nat64,\n    encoding_type: IDL.Text,\n    full_path: IDL.Text\n  });\n  const StreamingStrategy = IDL.Variant({\n    Callback: IDL.Record({\n      token: StreamingCallbackToken,\n      callback: IDL.Func([], [], [])\n    })\n  });\n  const HttpResponse = IDL.Record({\n    body: IDL.Vec(IDL.Nat8),\n    headers: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text)),\n    streaming_strategy: IDL.Opt(StreamingStrategy),\n    status_code: IDL.Nat16\n  });\n  const StreamingCallbackHttpResponse = IDL.Record({\n    token: IDL.Opt(StreamingCallbackToken),\n    body: IDL.Vec(IDL.Nat8)\n  });\n  const InitAssetKey = IDL.Record({\n    token: IDL.Opt(IDL.Text),\n    collection: IDL.Text,\n    name: IDL.Text,\n    description: IDL.Opt(IDL.Text),\n    encoding_type: IDL.Opt(IDL.Text),\n    full_path: IDL.Text\n  });\n  const InitUploadResult = IDL.Record({batch_id: IDL.Nat});\n  const ListOrderField = IDL.Variant({\n    UpdatedAt: IDL.Null,\n    Keys: IDL.Null,\n    CreatedAt: IDL.Null\n  });\n  const ListOrder = IDL.Record({field: ListOrderField, desc: IDL.Bool});\n  const ListMatcher = IDL.Record({\n    key: IDL.Opt(IDL.Text),\n    description: IDL.Opt(IDL.Text)\n  });\n  const ListPaginate = IDL.Record({\n    start_after: IDL.Opt(IDL.Text),\n    limit: IDL.Opt(IDL.Nat64)\n  });\n  const ListParams = IDL.Record({\n    order: IDL.Opt(ListOrder),\n    owner: IDL.Opt(IDL.Principal),\n    matcher: IDL.Opt(ListMatcher),\n    paginate: IDL.Opt(ListPaginate)\n  });\n  const AssetKey = IDL.Record({\n    token: IDL.Opt(IDL.Text),\n    collection: IDL.Text,\n    owner: IDL.Principal,\n    name: IDL.Text,\n    description: IDL.Opt(IDL.Text),\n    full_path: IDL.Text\n  });\n  const AssetEncodingNoContent = IDL.Record({\n    modified: IDL.Nat64,\n    sha256: IDL.Vec(IDL.Nat8),\n    total_length: IDL.Nat\n  });\n  const AssetNoContent = IDL.Record({\n    key: AssetKey,\n    updated_at: IDL.Nat64,\n    encodings: IDL.Vec(IDL.Tuple(IDL.Text, AssetEncodingNoContent)),\n    headers: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text)),\n    created_at: IDL.Nat64\n  });\n  const ListResults = IDL.Record({\n    matches_pages: IDL.Opt(IDL.Nat64),\n    matches_length: IDL.Nat64,\n    items_page: IDL.Opt(IDL.Nat64),\n    items: IDL.Vec(IDL.Tuple(IDL.Text, AssetNoContent)),\n    items_length: IDL.Nat64\n  });\n  const CustomDomain = IDL.Record({\n    updated_at: IDL.Nat64,\n    created_at: IDL.Nat64,\n    bn_id: IDL.Opt(IDL.Text)\n  });\n  const ListResults_1 = IDL.Record({\n    matches_pages: IDL.Opt(IDL.Nat64),\n    matches_length: IDL.Nat64,\n    items_page: IDL.Opt(IDL.Nat64),\n    items: IDL.Vec(IDL.Tuple(IDL.Text, Doc)),\n    items_length: IDL.Nat64\n  });\n  const Permission = IDL.Variant({\n    Controllers: IDL.Null,\n    Private: IDL.Null,\n    Public: IDL.Null,\n    Managed: IDL.Null\n  });\n  const Rule = IDL.Record({\n    updated_at: IDL.Nat64,\n    max_size: IDL.Opt(IDL.Nat),\n    read: Permission,\n    created_at: IDL.Nat64,\n    write: Permission\n  });\n  const SetController = IDL.Record({\n    metadata: IDL.Vec(IDL.Tuple(IDL.Text, IDL.Text)),\n    scope: ControllerScope,\n    expires_at: IDL.Opt(IDL.Nat64)\n  });\n  const SetControllersArgs = IDL.Record({\n    controller: SetController,\n    controllers: IDL.Vec(IDL.Principal)\n  });\n  const SetDoc = IDL.Record({\n    updated_at: IDL.Opt(IDL.Nat64),\n    data: IDL.Vec(IDL.Nat8),\n    description: IDL.Opt(IDL.Text)\n  });\n  const SetRule = IDL.Record({\n    updated_at: IDL.Opt(IDL.Nat64),\n    max_size: IDL.Opt(IDL.Nat),\n    read: Permission,\n    write: Permission\n  });\n  const UploadChunk = IDL.Record({\n    content: IDL.Vec(IDL.Nat8),\n    batch_id: IDL.Nat,\n    order_id: IDL.Opt(IDL.Nat)\n  });\n  const UploadChunkResult = IDL.Record({chunk_id: IDL.Nat});\n  return IDL.Service({\n    commit_asset_upload: IDL.Func([CommitBatch], [], []),\n    del_asset: IDL.Func([IDL.Text, IDL.Text], [], []),\n    del_assets: IDL.Func([IDL.Text], [], []),\n    del_controllers: IDL.Func(\n      [DeleteControllersArgs],\n      [IDL.Vec(IDL.Tuple(IDL.Principal, Controller))],\n      []\n    ),\n    del_custom_domain: IDL.Func([IDL.Text], [], []),\n    del_doc: IDL.Func([IDL.Text, IDL.Text, DelDoc], [], []),\n    del_rule: IDL.Func([RulesType, IDL.Text, DelDoc], [], []),\n    get_config: IDL.Func([], [Config], []),\n    get_doc: IDL.Func([IDL.Text, IDL.Text], [IDL.Opt(Doc)], ['query']),\n    http_request: IDL.Func([HttpRequest], [HttpResponse], ['query']),\n    http_request_streaming_callback: IDL.Func(\n      [StreamingCallbackToken],\n      [StreamingCallbackHttpResponse],\n      ['query']\n    ),\n    init_asset_upload: IDL.Func([InitAssetKey], [InitUploadResult], []),\n    list_assets: IDL.Func([IDL.Text, ListParams], [ListResults], ['query']),\n    list_controllers: IDL.Func([], [IDL.Vec(IDL.Tuple(IDL.Principal, Controller))], ['query']),\n    list_custom_domains: IDL.Func([], [IDL.Vec(IDL.Tuple(IDL.Text, CustomDomain))], ['query']),\n    list_docs: IDL.Func([IDL.Text, ListParams], [ListResults_1], ['query']),\n    list_rules: IDL.Func([RulesType], [IDL.Vec(IDL.Tuple(IDL.Text, Rule))], ['query']),\n    set_config: IDL.Func([Config], [], []),\n    set_controllers: IDL.Func(\n      [SetControllersArgs],\n      [IDL.Vec(IDL.Tuple(IDL.Principal, Controller))],\n      []\n    ),\n    set_custom_domain: IDL.Func([IDL.Text, IDL.Opt(IDL.Text)], [], []),\n    set_doc: IDL.Func([IDL.Text, IDL.Text, SetDoc], [Doc], []),\n    set_rule: IDL.Func([RulesType, IDL.Text, SetRule], [], []),\n    upload_asset_chunk: IDL.Func([UploadChunk], [UploadChunkResult], []),\n    version: IDL.Func([], [IDL.Text], ['query'])\n  });\n};\n// @ts-ignore\nexport const init = ({IDL}) => {\n  return [];\n};\n", "import type {ActorMethod, ActorSubclass} from '@dfinity/agent';\nimport {Actor, HttpAgent} from '@dfinity/agent';\nimport type {IDL} from '@dfinity/candid';\nimport {EnvStore} from '../stores/env.store';\nimport type {Satellite} from '../types/satellite.types';\n\nexport const createActor = async <T = Record<string, ActorMethod>>({\n  satelliteId: canisterId,\n  idlFactory,\n  identity,\n  fetch,\n  env = 'prod'\n}: {\n  idlFactory: IDL.InterfaceFactory;\n} & Required<Pick<Satellite, 'satelliteId' | 'identity'>> &\n  Pick<Satellite, 'fetch' | 'env'>): Promise<ActorSubclass<T>> => {\n  const localActor = env === 'dev' || EnvStore.getInstance().localIdentity();\n\n  const host: string = localActor ? 'http://127.0.0.1:8000/' : 'https://icp0.io';\n\n  const agent: HttpAgent = new HttpAgent({identity, ...(host && {host}), ...(fetch && {fetch})});\n\n  if (localActor) {\n    // Fetch root key for certificate validation during development\n    await agent.fetchRootKey();\n  }\n\n  // Creates an actor with using the candid interface and the HttpAgent\n  return Actor.createActor(idlFactory, {\n    agent,\n    canisterId\n  });\n};\n", "import type {_SERVICE as SatelliteActor} from '../../declarations/satellite/satellite.did';\nimport {idlFactory} from '../../declarations/satellite/satellite.factory.did.js';\nimport {EnvStore} from '../stores/env.store';\nimport type {Satellite} from '../types/satellite.types';\nimport {createActor} from '../utils/actor.utils';\n\nexport const getSatelliteActor = async ({\n  satelliteId,\n  ...rest\n}: Satellite): Promise<SatelliteActor> => {\n  const {satelliteId: canisterId} =\n    satelliteId !== undefined\n      ? {satelliteId}\n      : EnvStore.getInstance().get() ?? {satelliteId: undefined};\n\n  if (!canisterId) {\n    throw new Error('No satellite principal defined.');\n  }\n\n  return createActor({\n    satelliteId: canisterId,\n    idlFactory,\n    ...rest\n  });\n};\n", "import {fromNullable, isNullish, toArray, toNullable} from '@junobuild/utils';\nimport type {\n  Doc as DocApi,\n  ListResults_1 as ListDocsApi,\n  _SERVICE as SatelliteActor\n} from '../../declarations/satellite/satellite.did';\nimport type {Doc} from '../types/doc.types';\nimport type {ListParams, ListResults} from '../types/list.types';\nimport type {Satellite} from '../types/satellite.types';\nimport {mapData} from '../utils/data.utils';\nimport {toListParams} from '../utils/list.utils';\nimport {getSatelliteActor} from './actor.api';\n\nexport const getDoc = async <D>({\n  collection,\n  key,\n  satellite\n}: {\n  collection: string;\n  satellite: Satellite;\n} & Pick<Doc<D>, 'key'>): Promise<Doc<D> | undefined> => {\n  const actor: SatelliteActor = await getSatelliteActor(satellite);\n\n  const entry: DocApi | undefined = fromNullable(await actor.get_doc(collection, key));\n\n  if (isNullish(entry)) {\n    return undefined;\n  }\n\n  const {data: dataArray, owner, description, ...rest} = entry;\n\n  const data: D = await mapData<D>({data: dataArray});\n\n  return {\n    key,\n    description: fromNullable(description),\n    owner: owner.toText(),\n    data,\n    ...rest\n  };\n};\n\nexport const setDoc = async <D>({\n  collection,\n  doc,\n  satellite\n}: {\n  collection: string;\n  doc: Doc<D>;\n  satellite: Satellite;\n}): Promise<Doc<D>> => {\n  const actor: SatelliteActor = await getSatelliteActor(satellite);\n\n  const {key, data, updated_at, description} = doc;\n\n  const updatedDoc: DocApi = await actor.set_doc(collection, key, {\n    description: toNullable(description),\n    data: await toArray<D>(data),\n    updated_at: toNullable(updated_at)\n  });\n\n  const {owner, updated_at: updatedAt, created_at, description: updatedDescription} = updatedDoc;\n\n  // We update the data with the updated_at timestamp generated in the backend.\n  // The canister checks if the updated_at date is equals to the entity timestamp otherwise it rejects the update to prevent overwrite of data if user uses multiple devices.\n  // In other words: to update a data, the current updated_at information need to be provided.\n  return {\n    key,\n    description: fromNullable(updatedDescription),\n    owner: owner.toText(),\n    data,\n    created_at,\n    updated_at: updatedAt\n  };\n};\n\nexport const deleteDoc = async <D>({\n  collection,\n  doc,\n  satellite\n}: {\n  collection: string;\n  doc: Doc<D>;\n  satellite: Satellite;\n}): Promise<void> => {\n  const actor: SatelliteActor = await getSatelliteActor(satellite);\n\n  const {key, updated_at} = doc;\n\n  return actor.del_doc(collection, key, {\n    updated_at: toNullable(updated_at)\n  });\n};\n\nexport const listDocs = async <D>({\n  collection,\n  filter,\n  satellite\n}: {\n  collection: string;\n  filter: ListParams;\n  satellite: Satellite;\n}): Promise<ListResults<Doc<D>>> => {\n  const actor: SatelliteActor = await getSatelliteActor(satellite);\n\n  const {items, items_page, items_length, matches_length, matches_pages}: ListDocsApi =\n    await actor.list_docs(collection, toListParams(filter));\n\n  const docs: Doc<D>[] = [];\n\n  for (const [key, item] of items) {\n    const {data: dataArray, owner, description, ...rest} = item;\n\n    docs.push({\n      key,\n      description: fromNullable(description),\n      owner: owner.toText(),\n      data: await mapData<D>({data: dataArray}),\n      ...rest\n    });\n  }\n\n  return {\n    items: docs,\n    items_length,\n    items_page: fromNullable(items_page),\n    matches_length,\n    matches_pages: fromNullable(matches_pages)\n  };\n};\n", "import type {Identity} from '@dfinity/agent';\nimport {AnonymousIdentity} from '@dfinity/agent';\nimport {getIdentity as getAuthIdentity} from './auth.services';\n\nexport const getIdentity = (identity?: Identity): Identity => {\n  if (identity !== undefined) {\n    return identity;\n  }\n\n  const authIdentity: Identity | undefined = getAuthIdentity();\n\n  return authIdentity ?? new AnonymousIdentity();\n};\n", "import {\n  deleteDoc as deleteDocApi,\n  getDoc as getDocApi,\n  listDocs as listDocsApi,\n  setDoc as setDocApi\n} from '../api/doc.api';\nimport type {Doc} from '../types/doc.types';\nimport type {ListParams, ListResults} from '../types/list.types';\nimport type {SatelliteOptions} from '../types/satellite.types';\nimport {getIdentity} from './identity.services';\n\nexport const getDoc = async <D>({\n  satellite,\n  ...rest\n}: {\n  collection: string;\n  satellite?: SatelliteOptions;\n} & Pick<Doc<D>, 'key'>): Promise<Doc<D> | undefined> => {\n  const identity = getIdentity(satellite?.identity);\n\n  return getDocApi({...rest, satellite: {...satellite, identity}});\n};\n\nexport const setDoc = async <D>({\n  satellite,\n  ...rest\n}: {\n  collection: string;\n  doc: Doc<D>;\n  satellite?: SatelliteOptions;\n}): Promise<Doc<D>> => {\n  const identity = getIdentity(satellite?.identity);\n\n  return setDocApi({...rest, satellite: {...satellite, identity}});\n};\n\nexport const deleteDoc = async <D>({\n  satellite,\n  ...rest\n}: {\n  collection: string;\n  doc: Doc<D>;\n  satellite?: SatelliteOptions;\n}): Promise<void> => {\n  const identity = getIdentity(satellite?.identity);\n\n  return deleteDocApi({...rest, satellite: {...satellite, identity}});\n};\n\nexport const listDocs = async <D>({\n  satellite,\n  filter,\n  ...rest\n}: {\n  collection: string;\n  filter?: ListParams;\n  satellite?: SatelliteOptions;\n}): Promise<ListResults<Doc<D>>> => {\n  const identity = getIdentity(satellite?.identity);\n\n  return listDocsApi<D>({...rest, filter: filter ?? {}, satellite: {...satellite, identity}});\n};\n", "import type {Identity} from '@dfinity/agent';\nimport {isNullish} from '@junobuild/utils';\nimport type {Provider, User, UserData} from '../types/auth.types';\nimport {getIdentity} from './auth.services';\nimport {getDoc, setDoc} from './doc.services';\n\nexport const initUser = async (provider?: Provider): Promise<User> => {\n  const identity: Identity | undefined = getIdentity();\n\n  if (isNullish(identity)) {\n    throw new Error('No identity to initialize the user. Have you initialized Juno?');\n  }\n\n  const userId = identity.getPrincipal().toText();\n\n  const user: User | undefined = await getDoc<UserData>({\n    collection: `#user`,\n    key: userId\n  });\n\n  if (isNullish(user)) {\n    const newUser: User = await createUser({userId, provider});\n    return newUser;\n  }\n\n  return user;\n};\n\nconst createUser = async ({\n  userId,\n  ...rest\n}: {\n  userId: string;\n} & UserData): Promise<User> =>\n  setDoc<UserData>({\n    collection: `#user`,\n    doc: {\n      key: userId,\n      data: rest\n    }\n  });\n", "import type {Identity} from '@dfinity/agent';\nimport type {AuthClient} from '@dfinity/auth-client';\nimport {DELEGATION_IDENTITY_EXPIRATION} from '../constants/auth.constants';\nimport {InternetIdentityProvider} from '../providers/auth.providers';\nimport {AuthStore} from '../stores/auth.store';\nimport type {Provider, SignInOptions} from '../types/auth.types';\nimport {createAuthClient} from '../utils/auth.utils';\nimport {initUser} from './user.services';\n\nlet authClient: AuthClient | undefined;\n\nexport const initAuth = async (provider?: Provider) => {\n  authClient = authClient ?? (await createAuthClient());\n\n  const isAuthenticated: boolean = (await authClient?.isAuthenticated()) ?? false;\n\n  if (!isAuthenticated) {\n    return;\n  }\n\n  const user = await initUser(provider);\n  AuthStore.getInstance().set(user);\n};\n\nexport const signIn = async (options?: SignInOptions) =>\n  /* eslint-disable no-async-promise-executor */\n  new Promise<void>(async (resolve, reject) => {\n    authClient = authClient ?? (await createAuthClient());\n\n    const provider = options?.provider ?? new InternetIdentityProvider({});\n\n    await authClient.login({\n      onSuccess: async () => {\n        await initAuth(provider.id);\n        resolve();\n      },\n      onError: (error?: string) => reject(error),\n      maxTimeToLive: options?.maxTimeToLive ?? DELEGATION_IDENTITY_EXPIRATION,\n      ...(options?.derivationOrigin !== undefined && {derivationOrigin: options.derivationOrigin}),\n      ...provider.signInOptions({\n        windowed: options?.windowed\n      })\n    });\n  });\n\nexport const signOut = async (): Promise<void> => {\n  await authClient?.logout();\n\n  // Reset local object otherwise next sign in (sign in - sign out - sign in) might not work out - i.e. agent-js might not recreate the delegation or identity if not resetted\n  authClient = undefined;\n\n  AuthStore.getInstance().reset();\n};\n\nexport const getIdentity = (): Identity | undefined => {\n  return authClient?.getIdentity();\n};\n\n/**\n * Return what can be the identity of a sign-in user or an anonymous identity.\n * Useful to load an identity in web workers.\n */\nexport const unsafeIdentity = async (): Promise<Identity> =>\n  (authClient ?? (await createAuthClient())).getIdentity();\n", "import {isNullish} from '@junobuild/utils';\nimport {AuthStore} from '../stores/auth.store';\nimport type {User} from '../types/auth.types';\nimport type {EnvironmentWorker} from '../types/env.types';\nimport type {PostMessage} from '../types/post-message';\nimport type {Unsubscribe} from '../types/subscription.types';\nimport {emit} from '../utils/events.utils';\nimport {signOut} from './auth.services';\n\nexport const initAuthTimeoutWorker = (auth: EnvironmentWorker): Unsubscribe => {\n  const workerUrl = auth === true ? './workers/auth.worker.js' : auth;\n  const worker = new Worker(workerUrl);\n\n  const timeoutSignOut = async () => {\n    emit({message: 'junoSignOutAuthTimer'});\n    await signOut();\n  };\n\n  worker.onmessage = async ({data}: MessageEvent<PostMessage>) => {\n    const {msg} = data;\n\n    switch (msg) {\n      case 'junoSignOutAuthTimer':\n        await timeoutSignOut();\n        return;\n    }\n  };\n\n  return AuthStore.getInstance().subscribe((user: User | null) => {\n    if (isNullish(user)) {\n      worker.postMessage({msg: 'junoStopAuthTimer'});\n      return;\n    }\n\n    worker.postMessage({msg: 'junoStartAuthTimer'});\n  });\n};\n", "import {fromNullable, toNullable} from '@junobuild/utils';\nimport type {\n  AssetNoContent,\n  ListResults as ListAssetsApi,\n  _SERVICE as SatelliteActor\n} from '../../declarations/satellite/satellite.did';\nimport type {ListParams, ListResults} from '../types/list.types';\nimport type {Satellite} from '../types/satellite.types';\nimport type {AssetKey, ENCODING_TYPE, Storage} from '../types/storage.types';\nimport {isBrowser} from '../utils/env.utils';\nimport {toListParams} from '../utils/list.utils';\nimport {getSatelliteActor} from './actor.api';\n\nexport const uploadAsset = async ({\n  data,\n  filename,\n  collection,\n  headers,\n  token,\n  fullPath,\n  encoding,\n  description,\n  satellite\n}: Required<Omit<Storage, 'token' | 'encoding' | 'description'>> &\n  Pick<Storage, 'token' | 'encoding' | 'description'> & {satellite: Satellite}): Promise<void> => {\n  const actor: SatelliteActor = await getSatelliteActor(satellite);\n\n  const {batch_id: batchId} = await actor.init_asset_upload({\n    collection,\n    full_path: fullPath,\n    name: filename,\n    token: toNullable<string>(token),\n    encoding_type: toNullable<ENCODING_TYPE>(encoding),\n    description: toNullable(description)\n  });\n\n  // https://forum.dfinity.org/t/optimal-upload-chunk-size/20444/23?u=peterparker\n  const chunkSize = 1900000;\n\n  const uploadChunks: UploadChunkParams[] = [];\n\n  // Prevent transforming chunk to arrayBuffer error: The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.\n  const clone: Blob = isBrowser() ? new Blob([await data.arrayBuffer()]) : data;\n\n  // Split data into chunks\n  let orderId = 0n;\n  for (let start = 0; start < clone.size; start += chunkSize) {\n    const chunk: Blob = clone.slice(start, start + chunkSize);\n\n    uploadChunks.push({\n      batchId,\n      chunk,\n      actor,\n      orderId\n    });\n\n    orderId++;\n  }\n\n  // Upload chunks to the IC in batch - i.e. 12 chunks uploaded at a time.\n  let chunkIds: UploadChunkResult[] = [];\n  for await (const results of batchUploadChunks({uploadChunks})) {\n    chunkIds = [...chunkIds, ...results];\n  }\n\n  const contentType: [[string, string]] | undefined =\n    headers.find(([type, _]) => type.toLowerCase() === 'content-type') === undefined &&\n    data.type !== undefined &&\n    data.type !== ''\n      ? [['Content-Type', data.type]]\n      : undefined;\n\n  await actor.commit_asset_upload({\n    batch_id: batchId,\n    chunk_ids: chunkIds.map(({chunk_id}: UploadChunkResult) => chunk_id),\n    headers: [...headers, ...(contentType ? contentType : [])]\n  });\n};\n\nasync function* batchUploadChunks({\n  uploadChunks,\n  limit = 12\n}: {\n  uploadChunks: UploadChunkParams[];\n  limit?: number;\n}): AsyncGenerator<UploadChunkResult[], void> {\n  for (let i = 0; i < uploadChunks.length; i = i + limit) {\n    const batch = uploadChunks.slice(i, i + limit);\n    const result = await Promise.all(batch.map((params) => uploadChunk(params)));\n    yield result;\n  }\n}\n\ntype UploadChunkResult = {chunk_id: bigint};\n\ntype UploadChunkParams = {\n  batchId: bigint;\n  chunk: Blob;\n  actor: SatelliteActor;\n  orderId: bigint;\n};\n\nconst uploadChunk = async ({\n  batchId,\n  chunk,\n  actor,\n  orderId\n}: UploadChunkParams): Promise<UploadChunkResult> =>\n  actor.upload_asset_chunk({\n    batch_id: batchId,\n    content: new Uint8Array(await chunk.arrayBuffer()),\n    order_id: toNullable(orderId)\n  });\n\nexport const listAssets = async ({\n  collection,\n  satellite,\n  filter\n}: {\n  collection: string;\n  satellite: Satellite;\n  filter: ListParams;\n}): Promise<ListResults<AssetNoContent>> => {\n  const actor: SatelliteActor = await getSatelliteActor(satellite);\n\n  const {\n    items: assets,\n    items_length,\n    items_page,\n    matches_length,\n    matches_pages\n  }: ListAssetsApi = await actor.list_assets(collection, toListParams(filter));\n\n  return {\n    items: assets.map(([_, asset]) => asset),\n    items_length,\n    items_page: fromNullable(items_page),\n    matches_length,\n    matches_pages: fromNullable(matches_pages)\n  };\n};\n\nexport const deleteAsset = async ({\n  collection,\n  fullPath,\n  satellite\n}: {\n  collection: string;\n  satellite: Satellite;\n} & Pick<AssetKey, 'fullPath'>): Promise<void> => {\n  const actor: SatelliteActor = await getSatelliteActor(satellite);\n\n  return actor.del_asset(collection, fullPath);\n};\n\nexport const deleteAssets = async ({\n  collection,\n  satellite\n}: {\n  collection: string;\n  satellite: Satellite;\n}): Promise<void> => {\n  const actor: SatelliteActor = await getSatelliteActor(satellite);\n\n  return actor.del_assets(collection);\n};\n", "export const sha256ToBase64String = (sha256: Iterable<number>): string =>\n  btoa([...sha256].map((c) => String.fromCharCode(c)).join(''));\n", "export const encodeFilename = (filename: string): string =>\n  encodeURI(filename.toLowerCase().replace(/\\s/g, '-'));\n", "import {fromNullable} from '@junobuild/utils';\nimport type {AssetNoContent} from '../../declarations/satellite/satellite.did';\nimport {\n  deleteAsset as deleteAssetApi,\n  deleteAssets as deleteAssetsApi,\n  listAssets as listAssetsApi,\n  uploadAsset as uploadAssetApi\n} from '../api/storage.api';\nimport type {ListParams, ListResults} from '../types/list.types';\nimport type {SatelliteOptions} from '../types/satellite.types';\nimport type {Asset, AssetEncoding, AssetKey, Assets, Storage} from '../types/storage.types';\nimport {sha256ToBase64String} from '../utils/crypto.utils';\nimport {satelliteUrl} from '../utils/env.utils';\nimport {encodeFilename} from '../utils/storage.utils';\nimport {getIdentity} from './identity.services';\n\nexport const uploadBlob = async (\n  params: Storage & {satellite?: SatelliteOptions}\n): Promise<AssetKey> => uploadAssetIC(params);\n\nexport const uploadFile = async (\n  params: Partial<Pick<Storage, 'filename'>> &\n    Omit<Storage, 'filename' | 'data'> & {data: File} & {satellite?: SatelliteOptions}\n): Promise<AssetKey> =>\n  uploadAssetIC({\n    filename: params.data.name,\n    ...params\n  });\n\nconst uploadAssetIC = async ({\n  filename: storageFilename,\n  data,\n  collection,\n  headers = [],\n  fullPath: storagePath,\n  token,\n  satellite,\n  encoding,\n  description\n}: Storage & {satellite?: SatelliteOptions}): Promise<AssetKey> => {\n  const identity = getIdentity(satellite?.identity);\n\n  const filename: string = encodeFilename(storageFilename);\n  const fullPath: string = storagePath || `/${collection}/${filename}`;\n\n  await uploadAssetApi({\n    data,\n    filename: encodeFilename(filename),\n    collection,\n    token,\n    headers,\n    fullPath,\n    encoding,\n    satellite: {...satellite, identity},\n    description\n  });\n\n  return {\n    downloadUrl: `${satelliteUrl()}${fullPath}${token !== undefined ? `?token=${token}` : ''}`,\n    fullPath,\n    name: filename\n  };\n};\n\nexport const listAssets = async ({\n  collection,\n  satellite,\n  filter\n}: {\n  collection: string;\n  satellite?: SatelliteOptions;\n  filter?: ListParams;\n}): Promise<Assets> => {\n  const {items, ...rest}: ListResults<AssetNoContent> = await listAssetsApi({\n    collection,\n    satellite: {...satellite, identity: getIdentity(satellite?.identity)},\n    filter: filter ?? {}\n  });\n\n  const host: string = satelliteUrl();\n\n  return {\n    assets: items.map(\n      ({\n        key: {full_path, token: t, name, owner, description},\n        headers,\n        encodings,\n        created_at,\n        updated_at\n      }: AssetNoContent) => {\n        const token = fromNullable(t);\n\n        return {\n          fullPath: full_path,\n          description: fromNullable(description),\n          name,\n          downloadUrl: `${host}${full_path}${token !== undefined ? `?token=${token}` : ''}`,\n          token,\n          headers,\n          encodings: encodings.reduce(\n            (acc, [type, {modified, sha256, total_length}]) => ({\n              ...acc,\n              [type]: {\n                modified,\n                sha256: sha256ToBase64String(sha256),\n                total_length\n              }\n            }),\n            {} as Record<string, AssetEncoding>\n          ),\n          owner: owner.toText(),\n          created_at,\n          updated_at\n        } as Asset;\n      }\n    ),\n    ...rest\n  };\n};\n\nexport const deleteAsset = async ({\n  collection,\n  fullPath,\n  satellite\n}: {\n  collection: string;\n  satellite?: SatelliteOptions;\n} & Pick<AssetKey, 'fullPath'>): Promise<void> =>\n  deleteAssetApi({\n    collection,\n    fullPath,\n    satellite: {...satellite, identity: getIdentity(satellite?.identity)}\n  });\n\nexport const deleteAssets = async ({\n  collection,\n  satellite\n}: {\n  collection: string;\n  satellite?: SatelliteOptions;\n}): Promise<void> =>\n  deleteAssetsApi({\n    collection,\n    satellite: {...satellite, identity: getIdentity(satellite?.identity)}\n  });\n", "import {initAuthTimeoutWorker} from './services/auth-timout.services';\nimport {initAuth} from './services/auth.services';\nimport {AuthStore} from './stores/auth.store';\nimport {EnvStore} from './stores/env.store';\nimport type {User} from './types/auth.types';\nimport type {Environment} from './types/env.types';\nimport type {Unsubscribe} from './types/subscription.types';\n\nexport * from './providers/auth.providers';\nexport {signIn, signOut, unsafeIdentity} from './services/auth.services';\nexport * from './services/doc.services';\nexport * from './services/storage.services';\nexport * from './types/auth.types';\nexport * from './types/doc.types';\nexport * from './types/env.types';\nexport {ListOrder, ListPaginate, ListParams, ListResults} from './types/list.types';\nexport * from './types/satellite.types';\nexport * from './types/storage.types';\nexport * from './types/subscription.types';\n\nexport const initJuno = async (env: Environment): Promise<Unsubscribe[]> => {\n  EnvStore.getInstance().set(env);\n\n  await initAuth();\n\n  const authSubscribe =\n    env.workers?.auth !== undefined ? initAuthTimeoutWorker(env.workers.auth) : undefined;\n\n  return [...(authSubscribe ? [authSubscribe] : [])];\n};\n\nexport const authSubscribe = (callback: (authUser: User | null) => void): Unsubscribe =>\n  AuthStore.getInstance().subscribe(callback);\n"],
  "mappings": "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",
  "names": ["require_base64_js", "__commonJSMin", "exports", "byteLength", "toByteArray", "fromByteArray", "lookup", "revLookup", "Arr", "code", "i", "len", "getLens", "b64", "validLen", "placeHoldersLen", "lens", "_byteLength", "tmp", "arr", "curByte", "tripletToBase64", "num", "encodeChunk", "uint8", "start", "end", "output", "extraBytes", "parts", "maxChunkLength", "len2", "require_buffer", "base64", "ieee754", "customInspectSymbol", "Buffer", "SlowBuffer", "K_MAX_LENGTH", "typedArraySupport", "proto", "createBuffer", "length", "buf", "arg", "encodingOrOffset", "allocUnsafe", "from", "value", "fromString", "fromArrayView", "isInstance", "fromArrayBuffer", "valueOf", "b", "fromObject", "assertSize", "size", "alloc", "fill", "encoding", "checked", "string", "actual", "fromArrayLike", "array", "arrayView", "copy", "byteOffset", "obj", "numberIsNaN", "a", "x", "y", "list", "buffer", "pos", "mustMatch", "loweredCase", "utf8ToBytes", "base64ToBytes", "slowToString", "hexSlice", "utf8Slice", "asciiSlice", "latin1Slice", "base64Slice", "utf16leSlice", "swap", "n", "m", "str", "max", "target", "thisStart", "thisEnd", "thisCopy", "targetCopy", "bidirectionalIndexOf", "val", "dir", "arrayIndexOf", "indexSize", "arrLength", "valLength", "read", "foundIndex", "found", "j", "hexWrite", "offset", "remaining", "strLen", "parsed", "utf8Write", "blitBuffer", "asciiWrite", "asciiToBytes", "base64Write", "ucs2Write", "utf16leToBytes", "res", "firstByte", "codePoint", "bytesPerSequence", "secondByte", "thirdByte", "fourthByte", "tempCodePoint", "decodeCodePointsArray", "MAX_ARGUMENTS_LENGTH", "codePoints", "ret", "out", "hexSliceLookupTable", "bytes", "newBuf", "checkOffset", "ext", "noAssert", "mul", "checkInt", "min", "maxBytes", "limit", "sub", "checkIEEE754", "writeFloat", "littleEndian", "writeDouble", "targetStart", "INVALID_BASE64_RE", "base64clean", "units", "leadSurrogate", "byteArray", "c", "hi", "lo", "src", "dst", "type", "alphabet", "table", "i16", "crypto_exports", "__export", "crypto_default", "init_crypto", "__esmMin", "require_crypto", "module", "polyfill", "k", "require_nacl_fast", "nacl", "gf", "init", "r", "randombytes", "_0", "_9", "gf0", "gf1", "_121665", "D", "D2", "X", "Y", "I", "ts64", "h", "l", "vn", "xi", "yi", "d", "crypto_verify_16", "crypto_verify_32", "core_salsa20", "p", "j0", "j1", "j2", "j3", "j4", "j5", "j6", "j7", "j8", "j9", "j10", "j11", "j12", "j13", "j14", "j15", "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8", "x9", "x10", "x11", "x12", "x13", "x14", "x15", "u", "core_hsalsa20", "crypto_core_salsa20", "inp", "crypto_core_hsalsa20", "sigma", "crypto_stream_salsa20_xor", "cpos", "mpos", "z", "crypto_stream_salsa20", "crypto_stream", "s", "sn", "crypto_stream_xor", "poly1305", "key", "t0", "t1", "t2", "t3", "t4", "t5", "t6", "t7", "hibit", "d0", "d1", "d2", "d3", "d4", "d5", "d6", "d7", "d8", "d9", "h0", "h1", "h2", "h3", "h4", "h5", "h6", "h7", "h8", "h9", "r0", "r1", "r2", "r3", "r4", "r5", "r6", "r7", "r8", "r9", "mac", "macpos", "g", "mask", "f", "want", "crypto_onetimeauth", "outpos", "crypto_onetimeauth_verify", "hpos", "crypto_secretbox", "crypto_secretbox_open", "set25519", "car25519", "v", "sel25519", "q", "t", "pack25519", "neq25519", "par25519", "unpack25519", "A", "Z", "M", "t8", "t9", "t10", "t11", "t12", "t13", "t14", "t15", "t16", "t17", "t18", "t19", "t20", "t21", "t22", "t23", "t24", "t25", "t26", "t27", "t28", "t29", "t30", "b0", "b1", "b2", "b3", "b4", "b5", "b6", "b7", "b8", "b9", "b10", "b11", "b12", "b13", "b14", "b15", "S", "inv25519", "pow2523", "crypto_scalarmult", "e", "x32", "x16", "crypto_scalarmult_base", "crypto_box_keypair", "crypto_box_beforenm", "crypto_box_afternm", "crypto_box_open_afternm", "crypto_box", "crypto_box_open", "K", "crypto_hashblocks_hl", "hh", "hl", "wh", "wl", "bh0", "bh1", "bh2", "bh3", "bh4", "bh5", "bh6", "bh7", "bl0", "bl1", "bl2", "bl3", "bl4", "bl5", "bl6", "bl7", "th", "tl", "ah0", "ah1", "ah2", "ah3", "ah4", "ah5", "ah6", "ah7", "al0", "al1", "al2", "al3", "al4", "al5", "al6", "al7", "crypto_hash", "add", "cswap", "pack", "tx", "ty", "zi", "scalarmult", "scalarbase", "crypto_sign_keypair", "pk", "sk", "seeded", "L", "modL", "carry", "reduce", "crypto_sign", "sm", "smlen", "unpackneg", "chk", "den", "den2", "den4", "den6", "crypto_sign_open", "crypto_secretbox_KEYBYTES", "crypto_secretbox_NONCEBYTES", "crypto_secretbox_ZEROBYTES", "crypto_secretbox_BOXZEROBYTES", "crypto_scalarmult_BYTES", "crypto_scalarmult_SCALARBYTES", "crypto_box_PUBLICKEYBYTES", "crypto_box_SECRETKEYBYTES", "crypto_box_BEFORENMBYTES", "crypto_box_NONCEBYTES", "crypto_box_ZEROBYTES", "crypto_box_BOXZEROBYTES", "crypto_sign_BYTES", "crypto_sign_PUBLICKEYBYTES", "crypto_sign_SECRETKEYBYTES", "crypto_sign_SEEDBYTES", "crypto_hash_BYTES", "checkLengths", "checkBoxLengths", "checkArrayTypes", "cleanup", "msg", "nonce", "box", "publicKey", "secretKey", "signedMsg", "mlen", "sig", "seed", "fn", "crypto", "QUOTA", "__require", "isNullish", "argument", "nonNullish", "toNullable", "fromNullable", "toArray", "data", "blob", "fromArray", "Store", "callback", "callbackId", "id", "_AuthStore", "authUser", "unsubscribe", "AuthStore", "__publicField", "emit", "message", "detail", "$event", "DELEGATION_IDENTITY_EXPIRATION", "II_POPUP", "NFID_POPUP", "INTERNET_COMPUTER_ORG", "_EnvStore", "env", "_a", "EnvStore", "isBrowser", "satelliteUrl", "satelliteId", "popupCenter", "width", "height", "innerWidth", "innerHeight", "InternetIdentityProvider", "domain", "#domain", "windowed", "identityProvider", "NFIDProvider", "appName", "logoUrl", "#appName", "#logoUrl", "import_buffer", "ReplicaRejectCode", "domainSeparator", "SignIdentity", "Principal", "request", "body", "fields", "__rest", "requestId", "requestIdOf", "concat", "AnonymousIdentity", "cbor", "SubmitRequestType", "makeNonce", "view", "now", "randHi", "randLo", "TWO_TO_THE_32", "NANOSECONDS_PER_MILLISECONDS", "REPLICA_PERMITTED_DRIFT_MILLISECONDS", "Expiry", "deltaInMSec", "lebEncode", "makeNonceTransform", "nonceFn", "headers", "RequestStatusResponseStatus", "DEFAULT_INGRESS_EXPIRY_DELTA_IN_MSECS", "IC_ROOT_KEY", "IC0_DOMAIN", "IC0_SUB_DOMAIN", "ICP0_DOMAIN", "ICP0_SUB_DOMAIN", "ICP_API_DOMAIN", "ICP_API_SUB_DOMAIN", "HttpDefaultFetchError", "AgentError", "IdentityInvalidError", "getDefaultFetch", "defaultFetch", "HttpAgent", "options", "fromHex", "location", "name", "password", "hostname", "priority", "canisterId", "identity", "canister", "ecid", "sender", "ingress_expiry", "submit", "transformedRequest", "encode", "response", "tries", "responseText", "errorMessage", "decode", "CanisterStatus", "callTime", "replicaTime", "error", "ProxyMessageKind", "getDefaultAgent", "agent", "strategy_exports", "backoff", "chain", "conditionalDelay", "defaultStrategy", "maxAttempts", "once", "throttle", "timeout", "FIVE_MINUTES_IN_MSEC", "first", "condition", "timeInMsec", "status", "resolve", "count", "attempts", "toHex", "throttleInMsec", "startingThrottleInMsec", "backoffFactor", "currentThrottling", "strategies", "pollForResponse", "strategy", "blsVerify", "path", "currentRequest", "state", "cert", "Certificate", "maybeBuf", "rejectCode", "rejectMessage", "management_idl_default", "IDL", "canister_id", "definite_canister_settings", "canister_settings", "wasm_module", "ActorCallError", "methodName", "props", "QueryCallRejectedError", "result", "UpdateCallRejectedError", "CanisterInstallMode", "metadataSymbol", "Actor", "metadata", "actor", "config", "mode", "wasmModule", "getManagementCanister", "interfaceFactory", "service", "idl_exports", "CanisterActor", "DEFAULT_ACTOR_CONFIG", "func", "_createActorMethod", "configuration", "decodeReturnValue", "types", "returnValues", "caller", "args", "_b", "cid", "effectiveCanisterId", "pollingStrategyFactory", "pollStrategy", "responseBytes", "handler", "transform", "_methodName", "_callConfig", "tweetnacl", "fromHexString", "hexString", "byte", "toHexString", "bufEquals", "u1", "u2", "encodeLenBytes", "encodeLen", "decodeLenBytes", "decodeLen", "lenBytes", "DER_COSE_OID", "ED25519_OID", "SECP256K1_OID", "wrapDER", "payload", "oid", "bitStringHeaderLength", "unwrapDER", "derEncoded", "expect", "payloadLen", "Ed25519PublicKey", "rawKey", "derKey", "unwrapped", "Ed25519KeyIdentity", "_privateKey", "publicKeyDer", "privateKeyRaw", "json", "privateKey", "keyPair", "challenge", "CryptoError", "_getEffectiveCrypto", "subtleCrypto", "ECDSAKeyIdentity", "extractable", "keyUsages", "effectiveCrypto", "params", "requestDomainSeparator", "_parseBlob", "Delegation", "pubkey", "expiration", "targets", "_createSingleDelegation", "to", "delegation", "signature", "DelegationChain", "delegations", "parsedDelegations", "signedDelegation", "DelegationIdentity", "_inner", "_delegation", "isDelegationValid", "checks", "scopes", "maybeScope", "scope", "none", "import_borc", "PubKeyCoseAlgo", "events", "IdleManager", "onIdle", "idleTimeout", "_resetTimer", "debounce", "wait", "context", "later", "scroll", "cb", "exit", "instanceOfAny", "object", "constructors", "idbProxyableTypes", "cursorAdvanceMethods", "getIdbProxyableTypes", "getCursorAdvanceMethods", "cursorRequestMap", "transactionDoneMap", "transactionStoreNamesMap", "transformCache", "reverseTransformCache", "promisifyRequest", "promise", "reject", "unlisten", "success", "wrap", "cacheDonePromiseForTransaction", "done", "complete", "idbProxyTraps", "prop", "receiver", "replaceTraps", "wrapFunction", "storeNames", "unwrap", "transformCachableValue", "newValue", "openDB", "version", "blocked", "upgrade", "blocking", "terminated", "openPromise", "event", "db", "readMethods", "writeMethods", "cachedMethods", "getMethod", "targetFuncName", "useIndex", "isWrite", "method", "storeName", "oldTraps", "AUTH_DB_NAME", "OBJECT_STORE_NAME", "_openDbStore", "dbName", "KEY_STORAGE_DELEGATION", "KEY_STORAGE_KEY", "database", "_getValue", "_setValue", "_removeValue", "IdbKeyVal", "_db", "_storeName", "KEY_VECTOR", "DB_VERSION", "LocalStorage", "prefix", "_localStorage", "ls", "IdbStorage", "IDENTITY_PROVIDER_DEFAULT", "IDENTITY_PROVIDER_ENDPOINT", "ECDSA_KEY_LABEL", "ED25519_KEY_LABEL", "INTERRUPT_CHECK_INTERVAL", "ERROR_USER_INTERRUPT", "AuthClient", "_identity", "_key", "_chain", "_storage", "idleManager", "_createOptions", "_idpWindow", "_eventHandler", "logout", "idleOptions", "storage", "keyType", "maybeIdentityStorage", "fallbackLocalStorage", "localChain", "localKey", "chainStorage", "_deleteStorage", "_c", "onSuccess", "delegationChain", "defaultTimeToLive", "identityProviderUrl", "_d", "checkInterruption", "err", "onError", "createAuthClient", "mapData", "toListParams", "matcher", "paginate", "order", "owner", "idlFactory", "CommitBatch", "DeleteControllersArgs", "ControllerScope", "Controller", "DelDoc", "RulesType", "StorageConfig", "Config", "Doc", "HttpRequest", "StreamingCallbackToken", "StreamingStrategy", "HttpResponse", "StreamingCallbackHttpResponse", "InitAssetKey", "InitUploadResult", "ListOrderField", "ListOrder", "ListMatcher", "ListPaginate", "ListParams", "AssetKey", "AssetEncodingNoContent", "AssetNoContent", "ListResults", "CustomDomain", "ListResults_1", "Permission", "Rule", "SetController", "SetControllersArgs", "SetDoc", "SetRule", "UploadChunk", "UploadChunkResult", "createActor", "fetch", "localActor", "host", "getSatelliteActor", "rest", "getDoc", "collection", "satellite", "entry", "dataArray", "description", "setDoc", "doc", "updated_at", "updatedDoc", "T", "updatedAt", "created_at", "updatedDescription", "deleteDoc", "listDocs", "filter", "items", "items_page", "items_length", "matches_length", "matches_pages", "docs", "item", "getIdentity", "initUser", "provider", "userId", "user", "createUser", "authClient", "initAuth", "signIn", "signOut", "unsafeIdentity", "initAuthTimeoutWorker", "auth", "workerUrl", "worker", "timeoutSignOut", "uploadAsset", "filename", "token", "fullPath", "batchId", "chunkSize", "uploadChunks", "clone", "orderId", "chunk", "chunkIds", "results", "batchUploadChunks", "contentType", "_", "chunk_id", "batch", "uploadChunk", "listAssets", "assets", "asset", "deleteAsset", "deleteAssets", "sha256ToBase64String", "sha256", "encodeFilename", "uploadBlob", "uploadAssetIC", "uploadFile", "storageFilename", "storagePath", "full_path", "encodings", "acc", "modified", "total_length", "initJuno", "authSubscribe"]
}
